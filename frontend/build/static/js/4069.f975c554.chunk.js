"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[4069],{34069:(e,t,i)=>{i.r(t),i.d(t,{default:()=>l});var n=i(65043);class r{constructor(){this._buf=[]}initialize(){return this._buf.push(27,64),this}newline(){return this._buf.push(10),this}align(){const e={lt:0,ct:1,rt:2}[arguments.length>0&&void 0!==arguments[0]?arguments[0]:"lt"]||0;return this._buf.push(27,97,e),this}line(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";for(let t=0;t<e.length;t++)this._buf.push(e.charCodeAt(t));return this}leftRight(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const i=32-e.length-t.length,n=e+" ".repeat(i<0?1:i)+t;return this.line(n)}cut(){return this._buf.push(29,86,1),this}encode(){return new Uint8Array(this._buf)}}var o=i(70579);function l(e){let{rows:t=[],storeInfo:i={}}=e;const[l,a]=(0,n.useState)(null),[c,s]=(0,n.useState)(!1);return(0,o.jsxs)("div",{className:"flex gap-4",children:[(0,o.jsx)("button",{onClick:async function(){if(navigator.bluetooth)try{const e=await navigator.bluetooth.requestDevice({acceptAllDevices:!0}),t=await e.gatt.connect(),i=await t.getPrimaryServices();let n=null;for(const r of i){const e=await r.getCharacteristics();for(const t of e)if(t.properties.write||t.properties.writeWithoutResponse){n=t;break}if(n)break}if(!n)throw new Error("No writable characteristic found");a(n),s(!0),alert("Connected via Web Bluetooth")}catch(e){console.error(e),alert("BLE connection failed: "+e.message)}else window.bluetoothSerial?window.bluetoothSerial.list((e=>{const t=e[0];window.bluetoothSerial.connect(t.id,(()=>{s(!1),alert("Connected via Bluetooth Serial")}),(e=>alert("SPP connect failed: "+e)))}),(e=>alert("Device list failed: "+e))):alert("Bluetooth API not supported")},className:"px-4 py-2 bg-blue-600 text-white rounded",children:"Connect"}),(0,o.jsx)("button",{onClick:async function(){if(!l&&!window.bluetoothSerial)return void alert("Printer not connected");let e=(new r).initialize().align("ct").line(i.storeName||"Receipt").newline();if(t.forEach((t=>{const i=`${t.itemName}`,n=(t.quantity*t.salesPrice).toFixed(2);e=e.leftRight(i,n).newline()})),e=e.cut().encode(),c&&l)try{await l.writeValue(e),alert("Printed via BLE")}catch(n){console.error(n),alert("BLE write failed: "+n.message)}else try{await new Promise(((t,i)=>{window.bluetoothSerial.write(e.buffer,(()=>t()),(e=>i(e)))})),alert("Printed via SPP")}catch(n){console.error(n),alert("SPP write failed: "+n)}},className:"px-4 py-2 bg-green-600 text-white rounded",disabled:!l&&!window.bluetoothSerial,children:"Print"}),(0,o.jsx)("button",{onClick:function(){c&&l&&l.service.device.gatt.connected?(l.service.device.gatt.disconnect(),alert("BLE printer disconnected")):window.bluetoothSerial&&(window.bluetoothSerial.disconnect(),alert("Bluetooth Serial disconnected")),a(null),s(!1)},className:"px-4 py-2 bg-red-600 text-white rounded",disabled:!l&&!window.bluetoothSerial,children:"Disconnect"})]})}}}]);
//# sourceMappingURL=4069.f975c554.chunk.js.map