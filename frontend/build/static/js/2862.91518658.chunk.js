"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[2862],{14840:(e,t,a)=>{a.d(t,{A:()=>d});var s=a(65043),r=a(21197),n=a(59255),i=a(70579);function d(){const[e,t]=(0,s.useState)(!1);return(0,i.jsxs)("div",{className:"flex flex-col h-screen",children:[(0,i.jsx)(r.A,{isSidebarOpen:e,setSidebarOpen:t}),(0,i.jsxs)("div",{className:"flex flex-grow mt-20",children:[(0,i.jsx)("div",{children:(0,i.jsx)(n.A,{isSidebarOpen:e})}),(0,i.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-white/80 backdrop-blur-sm",children:(0,i.jsxs)("div",{className:"flex flex-col items-center",children:[(0,i.jsx)("div",{className:"w-12 h-12 border-4 rounded-full border-cyan-500 border-t-transparent animate-spin"}),(0,i.jsx)("p",{className:"mt-3 text-lg font-semibold text-gray-700",children:"Loading..."})]})})]})]})}},72862:(e,t,a)=>{a.r(t),a.d(t,{default:()=>u});var s=a(65043),r=a(66727),n=a(86213),i=a(21197),d=a(59255),o=a(14840),l=a(49804),c=a(60184),m=a(70579);const u=function(){const e=(0,r.Zp)(),[t]=(0,r.ok)(),a=t.get("id"),[u,h]=(0,s.useState)(!0),[x,f]=(0,s.useState)(!1),[g,b]=(0,s.useState)([]),[j,p]=(0,s.useState)([]),[v,N]=(0,s.useState)([]),[y,w]=(0,s.useState)(""),[k,S]=(0,s.useState)([]),[A,I]=(0,s.useState)({warehouse:"",adjustmentDate:(new Date).toLocaleDateString("en-CA"),referenceNo:"",note:"",totalQuantity:0}),C=k.reduce(((e,t)=>e+(t.quantity||0)),0);(0,s.useEffect)((()=>{D(),a||q()}),[]),(0,s.useEffect)((()=>{A.warehouse?_(A.warehouse):(p([]),N([]),a||S([]))}),[A.warehouse,a]),(0,s.useEffect)((()=>{a&&A.warehouse&&j.length>0&&$(a)}),[a,A.warehouse,j]);const D=async()=>{f(!0);try{const e=localStorage.getItem("token"),t=((await n.A.get("api/warehouses",{headers:{Authorization:`Bearer ${e}`}})).data.data||[]).filter((e=>"Active"===e.status)).map((e=>({...e,label:e.warehouseName,value:e._id})));if(b(t),!a&&t.length>0){const e=t.find((e=>e.isRestricted)),a=e?e._id:t[0]._id;I((e=>({...e,warehouse:a})))}}catch(e){console.error("Error fetching warehouses:",e.message)}finally{f(!1)}},_=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;f(!0);try{const t=localStorage.getItem("token"),a=e?{warehouse:e}:{},s=await n.A.get("api/items",{headers:{Authorization:`Bearer ${t}`},params:a}),r=(s.data.data||[]).map((e=>{var t;const a=Boolean(e.parentItemId);return{...e,parentId:a?e.parentItemId:e._id,variantId:a?e._id:null,displayName:a?`${e.itemName} / ${e.variantName||"Variant"}`:e.itemName,itemCode:e.itemCode||"",barcode:(null===(t=e.barcodes)||void 0===t?void 0:t[0])||"",barcodes:e.barcodes||[],isVariant:a}}));p(r),N(r)}catch(t){console.error("Error fetching items:",t.message),p([]),N([])}finally{f(!1)}},$=async e=>{f(!0);try{var t,a,s;const r=localStorage.getItem("token"),i=(await n.A.get(`api/stock-adjustments/${e}`,{headers:{Authorization:`Bearer ${r}`}})).data.data;I({warehouse:(null===(t=i.warehouse)||void 0===t?void 0:t._id)||i.warehouse||"",adjustmentDate:i.adjustmentDate?i.adjustmentDate.split("T")[0]:"",referenceNo:i.referenceNo||"",note:i.note||"",totalQuantity:i.totalQuantity||0}),null!==(a=i.warehouse)&&void 0!==a&&a._id&&A.warehouse!==(null===(s=i.warehouse)||void 0===s?void 0:s._id)&&await _(i.warehouse._id);const d=(i.items||[]).map((e=>{var t,a;const s=j.find((t=>{var a;return t._id===((null===(a=e.item)||void 0===a?void 0:a._id)||e.item)}))||{};return{itemId:(null===(t=e.item)||void 0===t?void 0:t._id)||e.item,itemName:s.displayName||(null===(a=e.item)||void 0===a?void 0:a.itemName)||"Unknown Item",quantity:e.quantity||0,isVariant:s.isVariant||!1,variantName:s.variantName||""}}));S(d)}catch(r){console.error("Error loading stock adjustment:",r.message),alert("Error loading stock adjustment")}finally{f(!1)}},q=async()=>{try{const e=localStorage.getItem("token"),t=(await n.A.get("api/stock-adjustments",{headers:{Authorization:`Bearer ${e}`}})).data.data||[],a=(new Date).getFullYear();let s=`ADJ/${a}/01`;if(t.length>0){const e=t.filter((e=>!e.isReturn&&!!e.referenceNo)).sort(((e,t)=>new Date(t.createdAt)-new Date(e.createdAt)));if(e.length>0){const t=e[0].referenceNo,[r,n,i]=t.split("/");if("ADJ"===r&&n===a.toString()&&!isNaN(i)){const e=parseInt(i,10)+1;s=`ADJ/${a}/${e.toString().padStart(2,"0")}`}}}I((e=>({...e,referenceNo:s})))}catch(e){console.error("Error generating next reference number:",e.message),I((e=>({...e,referenceNo:`ADJ/${(new Date).getFullYear()}/01`})))}},E=y?v.filter((e=>{var t,a;const s=y.toLowerCase();return(null===(t=e.displayName)||void 0===t?void 0:t.toLowerCase().includes(s))||(null===(a=e.itemCode)||void 0===a?void 0:a.toLowerCase().includes(s))||e.barcodes&&e.barcodes.some((e=>e.toLowerCase().includes(s)))})):[],B=e=>{if(!e)return;const t=k.find((t=>t.itemId===e._id));S(t?k.map((t=>t.itemId===e._id?{...t,quantity:t.quantity+1}:t)):[...k,{itemId:e._id,itemName:e.displayName,quantity:1,isVariant:e.isVariant,variantName:e.variantName}]),w("")},z=e=>{I({...A,[e.target.name]:e.target.value})};return x?(0,m.jsx)(o.A,{}):(0,m.jsxs)("div",{className:"flex flex-col h-screen bg-gray-100",children:[(0,m.jsx)(i.A,{isSidebarOpen:u,setSidebarOpen:h}),(0,m.jsxs)("div",{className:"flex flex-grow",children:[(0,m.jsx)(d.A,{isSidebarOpen:u}),(0,m.jsxs)("div",{className:"flex-grow p-4 transition-all duration-300 w-full",children:[(0,m.jsxs)("header",{className:"flex flex-col items-center justify-between p-4 mb-2 bg-white rounded-md shadow sm:flex-row",children:[(0,m.jsxs)("div",{className:"flex items-baseline gap-2 text-sm sm:flex-row",children:[(0,m.jsx)("h1",{className:"text-sm font-semibold text-gray-800 md:text-xl",children:a?"Edit Stock Adjustment":"Add Stock Adjustment"}),(0,m.jsx)("span",{className:"text-sm text-gray-600",children:a?"Update Stock Adjustment":"Create Stock Adjustment"})]}),(0,m.jsxs)("nav",{className:"flex items-center text-sm text-gray-500",children:[(0,m.jsxs)("a",{href:"/dashboard",className:"flex items-center text-gray-700 no-underline hover:text-cyan-600",children:[(0,m.jsx)(c.$BV,{className:"mr-2"}),"Home"]}),(0,m.jsx)(l.XWt,{className:"mx-2"}),(0,m.jsx)("a",{href:"/adjustment-list",className:"text-gray-700 no-underline hover:text-cyan-600",children:"Stock Adjustment List"})]})]}),(0,m.jsx)("div",{className:"p-4 bg-white border-t-4 rounded-md shadow-md border-cyan-500",children:(0,m.jsxs)("form",{onSubmit:async t=>{if(t.preventDefault(),A.warehouse)if(0!==k.length){f(!0);try{const t=k.map((e=>({item:e.itemId,quantity:e.quantity}))),s={warehouse:A.warehouse,adjustmentDate:A.adjustmentDate,referenceNo:A.referenceNo,items:t,totalQuantity:C,note:A.note},r=localStorage.getItem("token");a?(await n.A.put(`api/stock-adjustments/${a}`,s,{headers:{Authorization:`Bearer ${r}`}}),alert("Stock Adjustment updated successfully!")):(await n.A.post("api/stock-adjustments",s,{headers:{Authorization:`Bearer ${r}`}}),alert("Stock Adjustment created successfully!")),e("/stock-adjustment")}catch(s){console.error("Error submitting stock adjustment:",s.message),alert("Error submitting stock adjustment")}finally{f(!1)}}else alert("Please add at least one item.");else alert("Please select a warehouse.")},children:[(0,m.jsxs)("div",{className:"grid grid-cols-1 gap-4 mb-4 md:grid-cols-3",children:[(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"block mb-1 font-semibold",children:"Warehouse"}),(0,m.jsxs)("select",{name:"warehouse",value:A.warehouse,onChange:z,className:"w-full px-3 py-2 border border-gray-300 rounded-md",required:!0,children:[(0,m.jsx)("option",{value:"",children:"Select Warehouse"}),g.map((e=>(0,m.jsx)("option",{value:e._id,children:e.warehouseName},e._id)))]})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"block mb-1 font-semibold",children:"Date"}),(0,m.jsx)("input",{type:"date",name:"adjustmentDate",value:A.adjustmentDate,onChange:z,className:"w-full px-3 py-2 border border-gray-300 rounded-md",required:!0})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"block mb-1 font-semibold",children:"Reference No."}),(0,m.jsx)("input",{type:"text",name:"referenceNo",value:A.referenceNo,onChange:z,className:"w-full px-3 py-2 border border-gray-300 rounded-md",readOnly:!0})]})]}),(0,m.jsxs)("div",{className:"relative w-full mb-4",children:[(0,m.jsx)("label",{className:"block mb-1 font-semibold",children:"Search Item"}),(0,m.jsx)("input",{type:"text",placeholder:"Item name / Barcode / Itemcode",className:"w-full px-4 py-2 border border-gray-300 rounded-md",value:y,onChange:e=>{const t=e.target.value.trim();w(t);const a=j.find((e=>{var a;return(null===(a=e.barcodes)||void 0===a?void 0:a.includes(t))||e.itemCode===t}));a&&(B(a),w(""))},disabled:!A.warehouse,onKeyPress:e=>{"Enter"===e.key&&E[0]&&(B(E[0]),w(""))}}),y&&E.length>0&&(0,m.jsx)("div",{className:"absolute z-50 w-full overflow-y-auto bg-white border rounded-lg shadow-lg top-14 sm:w-96 max-h-60 touch-auto",style:{WebkitOverflowScrolling:"touch"},children:(0,m.jsx)("ul",{children:E.map((e=>{var t;return(0,m.jsxs)("li",{onClick:()=>{B(e),w("")},className:"p-2 cursor-pointer hover:bg-gray-100",children:[(0,m.jsx)("strong",{children:e.itemCode})," -"," ",e.displayName," ",e.isVariant?`(${e.variantName})`:"",(null===(t=e.barcodes)||void 0===t?void 0:t[0])&&(0,m.jsxs)("span",{className:"text-gray-500",children:[" ","- ",e.barcodes[0]]})]},e._id)}))})})]}),(0,m.jsxs)("div",{className:"p-4 mb-4 bg-white rounded-md shadow-md",children:[(0,m.jsxs)("div",{className:"flex justify-center gap-2 py-2 text-sm font-semibold text-white bg-cyan-600",children:[(0,m.jsx)("div",{className:"w-64 text-center",children:"Item Name"}),(0,m.jsx)("div",{className:"w-32 text-center",children:"Quantity (Negative to Decrease)"}),(0,m.jsx)("div",{className:"w-24 text-center",children:"Action"})]}),0===k.length?(0,m.jsx)("div",{className:"py-4 text-center text-gray-500",children:"No items selected."}):k.map((e=>(0,m.jsxs)("div",{className:"flex items-center justify-center gap-2 py-2 border-t",children:[(0,m.jsx)("div",{className:"w-64 text-center",children:e.itemName}),(0,m.jsx)("div",{className:"w-32 text-center",children:(0,m.jsx)("input",{type:"number",className:"w-16 text-center border border-gray-300 rounded",value:e.quantity,onChange:t=>((e,t)=>{const a=k.map((a=>a.itemId===e?{...a,quantity:parseInt(t)||0}:a));S(a)})(e.itemId,t.target.value),min:"-9999",max:"9999"})}),(0,m.jsx)("div",{className:"w-24 text-center",children:(0,m.jsx)("button",{type:"button",className:"px-2 py-1 text-white bg-red-500 rounded",onClick:()=>{return t=e.itemId,void S(k.filter((e=>e.itemId!==t)));var t},children:"Remove"})})]},e.itemId)))]}),(0,m.jsxs)("div",{className:"flex items-center mb-4",children:[(0,m.jsx)("label",{className:"mr-2 font-semibold text-gray-700",children:"Total Quantity:"}),(0,m.jsx)("span",{className:"text-gray-600",children:C}),(0,m.jsx)("span",{className:"ml-2 text-sm text-gray-500",children:"(Negative indicates decrease)"})]}),(0,m.jsxs)("div",{className:"mb-4",children:[(0,m.jsx)("label",{className:"block mb-1 font-semibold",children:"Note"}),(0,m.jsx)("textarea",{name:"note",rows:"2",value:A.note,onChange:z,className:"w-full px-3 py-2 border border-gray-300 rounded-md"})]}),(0,m.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,m.jsx)("button",{type:"submit",className:"px-6 py-2 font-semibold text-white bg-green-500 rounded-md shadow hover:bg-green-600",children:a?"Update":"Save"}),(0,m.jsx)("button",{type:"button",onClick:()=>{e("/stock-adjustment")},className:"px-6 py-2 font-semibold text-white bg-orange-500 rounded-md shadow hover:bg-orange-600",children:"Close"})]})]})})]})]})]})}}}]);
//# sourceMappingURL=2862.91518658.chunk.js.map