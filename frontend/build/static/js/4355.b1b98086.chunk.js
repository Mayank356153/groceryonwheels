"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[4355],{54355:(e,s,t)=>{t.r(s),t.d(s,{default:()=>m});var a=t(65043),l=t(86213),r=t(60184),d=t(21197),i=t(59255),n=t(66727),o=t(70579);const c=l.A.create({baseURL:"/vps/api"});function m(){const[e,s]=(0,a.useState)(!0),[t,l]=(0,a.useState)("active"),[m,u]=(0,a.useState)([]),[x,p]=(0,a.useState)(!1),[h,g]=(0,a.useState)(null),[j,b]=(0,a.useState)({}),v=(0,n.Zp)();(0,a.useEffect)((()=>{p(!0),g(null);const e="completed"===t?"/bookings/my-completed-jobs":"/bookings/my-jobs";c.get(e).then((e=>u(e.data.data))).catch((()=>g("Failed to load jobs"))).finally((()=>p(!1)))}),[t]);return(0,o.jsxs)("div",{className:"flex flex-col h-screen",children:[(0,o.jsx)(d.A,{isSidebarOpen:e,setSidebarOpen:s}),(0,o.jsxs)("div",{className:"flex flex-1",children:[(0,o.jsx)(i.A,{isSidebarOpen:e}),(0,o.jsxs)("main",{className:"flex-1 p-6 bg-gray-100 overflow-auto",children:[(0,o.jsxs)("div",{className:"mb-4 space-x-2",children:[(0,o.jsx)("button",{onClick:()=>l("active"),className:"px-4 py-2 rounded "+("active"===t?"bg-blue-600 text-white":"bg-gray-200 text-gray-700"),children:"In-Progress"}),(0,o.jsx)("button",{onClick:()=>l("completed"),className:"px-4 py-2 rounded "+("completed"===t?"bg-green-600 text-white":"bg-gray-200 text-gray-700"),children:"Completed"})]}),(0,o.jsx)("h1",{className:"text-2xl font-semibold mb-4",children:"completed"===t?"My Completed Jobs":"My Claimed Jobs"}),h&&(0,o.jsx)("div",{className:"mb-4 p-2 bg-red-100 text-red-700 rounded",children:h}),x?(0,o.jsx)("div",{children:"Loading\u2026"}):0===m.length?(0,o.jsx)("div",{className:"text-gray-600",children:"completed"===t?"You have no completed jobs yet.":"You have no claimed jobs."}):(0,o.jsx)("div",{className:"space-y-6",children:m.map((e=>{const s=[e.pickupAddress.street,e.pickupAddress.area,e.pickupAddress.city,e.pickupAddress.state,e.pickupAddress.postalCode].filter(Boolean).join(", "),a=`https://maps.google.com/maps?q=${encodeURIComponent(s)}&t=&z=15&ie=UTF8&iwloc=&output=embed`;return(0,o.jsxs)("div",{className:"bg-white p-4 rounded shadow flex flex-col md:flex-row gap-4",children:[(0,o.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,o.jsxs)("div",{className:"text-gray-800",children:[(0,o.jsx)("strong",{children:"Customer:"})," ",e.customer.name," (",e.customer.phone,")"]}),(0,o.jsxs)("div",{className:"text-gray-700 flex items-center",children:[(0,o.jsx)(r.vq8,{className:"mr-1 text-red-500"}),(0,o.jsx)("span",{children:s})]}),(0,o.jsxs)("div",{className:"text-gray-700",children:[(0,o.jsx)("strong",{children:"When:"})," ","scheduled"===e.type?new Date(e.scheduledFor).toLocaleString():"ASAP"]}),(0,o.jsxs)("div",{className:"text-gray-700",children:[(0,o.jsx)("strong",{children:"Remark:"})," ",e.remark||(0,o.jsx)("em",{children:"none"})]}),"active"===t?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:"text-sm text-green-600 mb-2",children:[(0,o.jsx)("strong",{children:"Current Status:"})," ",e.status]}),(0,o.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,o.jsxs)("select",{className:"p-1 border border-gray-300 rounded flex-1",value:j[e._id]||"",onChange:s=>{return t=e._id,a=s.target.value,void b((e=>({...e,[t]:a})));var t,a},children:[(0,o.jsx)("option",{value:"",disabled:!0,children:"Change status\u2026"}),(0,o.jsx)("option",{value:"in_transit",children:"In Transit"}),(0,o.jsx)("option",{value:"completed",children:"Completed"}),(0,o.jsx)("option",{value:"cancelled",children:"Cancelled"})]}),(0,o.jsx)("button",{onClick:()=>(async e=>{const s=j[e];if(!s)return alert("Please select a status first.");try{await c.patch(`/bookings/${e}/status`,{status:s}),u(m.map((t=>t._id===e?{...t,status:s}:t))),alert("Status updated!")}catch(l){var t,a;alert("Update failed: "+((null===(t=l.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||l.message))}})(e._id),className:"px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600",children:"Update"})]}),(0,o.jsx)("button",{onClick:()=>v(`/pos?customer=${e.customer._id}&bookingId=${e._id}&customerModel=Customer`),className:"inline-block px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700",children:"Start Sale"})]}):e.order?(0,o.jsxs)("div",{className:"mt-4 border-t pt-4",children:[(0,o.jsx)("strong",{children:"Items Sold:"}),(0,o.jsx)("ul",{className:"list-disc ml-6",children:e.order.items.map(((e,s)=>(0,o.jsxs)("li",{children:[e.quantity,"\xd7 ",e.item.itemName," @ \u20b9",e.price.toFixed(2)," = \u20b9",e.subtotal.toFixed(2)]},s)))}),(0,o.jsxs)("div",{className:"mt-2",children:[(0,o.jsx)("strong",{children:"Total Paid:"})," ","\u20b9",e.order.payments.reduce(((e,s)=>e+s.amount),0).toFixed(2)]})]}):(0,o.jsx)("div",{className:"text-gray-500 mt-2",children:"No sale information available."})]}),(0,o.jsx)("div",{className:"w-full md:w-64 h-48 rounded overflow-hidden border",children:(0,o.jsx)("iframe",{title:`map-${e._id}`,src:a,className:"w-full h-full",frameBorder:"0",loading:"lazy"})})]},e._id)}))})]})]})]})}c.interceptors.request.use((e=>{const s=localStorage.getItem("token");return s&&(e.headers.Authorization=`Bearer ${s}`),e}))}}]);
//# sourceMappingURL=4355.b1b98086.chunk.js.map