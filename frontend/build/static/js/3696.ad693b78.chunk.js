"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[3696],{20221:(e,a,t)=>{t.r(a),t.d(a,{default:()=>m});var s=t(65043),l=t(49804),r=t(60184),n=t(21197),i=t(59255),o=t(86213),d=t(26873),c=t(66727),u=t(70579);function m(){var e;const a=(0,c.Zp)(),{id:t}=(0,c.g)(),m=Boolean(t),[x,h]=(0,s.useState)([]);(0,s.useEffect)((()=>{const e=localStorage.getItem("permissions");e&&h(JSON.parse(e))}),[]);const[v,p]=(0,s.useState)(""),[f,g]=(0,s.useState)([]),[y,N]=(0,s.useState)(null),[b,j]=(0,s.useState)(""),[C,S]=(0,s.useState)(""),[w,A]=(0,s.useState)((new Date).toISOString().split("T")[0]),[_,P]=(0,s.useState)("Return"),[R,I]=(0,s.useState)(""),[k,E]=(0,s.useState)([]),[$,F]=(0,s.useState)([]),[L,O]=(0,s.useState)([]),[V,D]=(0,s.useState)([]),[q,T]=(0,s.useState)([]),[Q,B]=(0,s.useState)(null),[z,U]=(0,s.useState)(null),[W,Y]=(0,s.useState)(null),[M,G]=(0,s.useState)(null),[H,J]=(0,s.useState)(null),[K,X]=(0,s.useState)([]),[Z,ee]=(0,s.useState)([]),[ae,te]=(0,s.useState)([]),[se,le]=(0,s.useState)(""),[re,ne]=(0,s.useState)([]),[ie,oe]=(0,s.useState)(""),[de,ce]=(0,s.useState)(0),[ue,me]=(0,s.useState)(""),[xe,he]=(0,s.useState)(""),[ve,pe]=(0,s.useState)(0),[fe,ge]=(0,s.useState)(0),[ye,Ne]=(0,s.useState)("Per%"),[be,je]=(0,s.useState)(""),[Ce,Se]=(0,s.useState)(!1),[we,Ae]=(0,s.useState)(!1),[_e,Pe]=(0,s.useState)(0),[Re,Ie]=(0,s.useState)(""),[ke,Ee]=(0,s.useState)(!1);(0,s.useEffect)((()=>{window.innerWidth<768&&Ee(!1)}),[]);const $e=()=>({headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});(0,s.useEffect)((()=>{(async()=>{try{const[e,a,t,s,l,r]=await Promise.all([o.A.get("api/warehouses",$e()),o.A.get("api/customer-data/all",$e()),o.A.get("api/payment-types",$e()),o.A.get("api/accounts",$e()),o.A.get("api/terminals",$e()),o.A.get("api/sales-return",$e())]);E((e.data.data||[]).map((e=>({label:e.warehouseName,value:e._id,cashAccount:e.cashAccount&&e.cashAccount._id?e.cashAccount._id:e.cashAccount}))));const n=Array.isArray(a.data)?a.data:a.data.data||[];if(F(n.map((e=>({label:e.customerName,value:e._id})))),O((t.data.data||t.data).map((e=>({label:e.paymentTypeName,value:e._id,name:e.paymentTypeName.toLowerCase()})))),D((s.data.data||s.data).map((e=>({label:e.accountName||"Unnamed",value:e._id})))),T((l.data.data||l.data).map((e=>({label:e.tid,value:e._id,warehouse:e.warehouse})))),!m){const e=r.data.returns||[];j(e.length?function(e){if(!e)return`SR/${(new Date).getFullYear()}/01`;const a=e.split("/"),t=parseInt(a[2],10);return`SR/${a[1]}/${String(t+1).padStart(2,"0")}`}(e[e.length-1].returnCode):`SR/${(new Date).getFullYear()}/01`)}}catch(e){console.error("Fetch error:",e),alert("Failed to load data: "+e.message)}})()}),[m]),(0,s.useEffect)((()=>{(async()=>{if(!Q)return X([]),ee([]),void oe("Please select a warehouse to search for items.");try{const e=await o.A.get("api/items",{...$e(),params:{warehouse:Q.value}}),a=(e.data.data||[]).map((e=>{const a=Boolean(e.parentItemId);return{...e,parentId:a?e.parentItemId:e._id,variantId:a?e._id:null,itemName:a?`${e.itemName} / ${e.variantName||"Variant"}`:e.itemName}}));X(a)}catch(e){console.error("Fetch items error:",e),X([]),ee([]),oe("Failed to fetch items: "+e.message)}})()}),[Q]),(0,s.useEffect)((()=>{if(!Q)return ee([]),void oe("Please select a warehouse to search for items.");oe("");const e=[];if(y){const a=(y.items||[]).map((e=>{var a,t,s,l;return null===(a=(null===(t=e.variant)||void 0===t?void 0:t._id)||e.variant||(null===(s=e.item)||void 0===s?void 0:s._id)||e.item||(null===(l=e.product)||void 0===l?void 0:l._id)||e.product)||void 0===a?void 0:a.toString()})).filter((e=>e));K.forEach((t=>{var s;const l=(null===(s=t.warehouse)||void 0===s?void 0:s._id)===Q.value,r=a.includes(t._id.toString());var n;l&&r&&e.push({...t,itemName:t.itemName,itemCode:t.itemCode,salesPrice:t.salesPrice||0,barcode:(null===(n=t.barcodes)||void 0===n?void 0:n[0])||""});t.variants&&Array.isArray(t.variants)&&t.variants.forEach((s=>{const r=a.includes(s._id.toString());var n,i;l&&r&&e.push({...t,_id:s._id,itemName:`${t.itemName} / ${s.name||"Variant"}`,itemCode:s.itemCode||t.itemCode,salesPrice:s.salesPrice||t.salesPrice||0,barcode:(null===(n=s.barcodes)||void 0===n?void 0:n[0])||(null===(i=t.barcodes)||void 0===i?void 0:i[0])||"",parentId:t._id,variantId:s._id})}))}))}else K.forEach((a=>{var t;var s;(null===(t=a.warehouse)||void 0===t?void 0:t._id)===Q.value&&(e.push({...a,itemName:a.itemName,itemCode:a.itemCode,salesPrice:a.salesPrice||0,barcode:(null===(s=a.barcodes)||void 0===s?void 0:s[0])||""}),a.variants&&Array.isArray(a.variants)&&a.variants.forEach((t=>{var s,l;e.push({...a,_id:t._id,itemName:`${a.itemName} / ${t.name||"Variant"}`,itemCode:t.itemCode||a.itemCode,salesPrice:t.salesPrice||a.salesPrice||0,barcode:(null===(s=t.barcodes)||void 0===s?void 0:s[0])||(null===(l=a.barcodes)||void 0===l?void 0:l[0])||"",parentId:a._id,variantId:t._id})})))}));ee(e)}),[Q,K,y]),(0,s.useEffect)((()=>{t&&o.A.get(`api/sales-return/${t}`,$e()).then((e=>{var a;let{data:t}=e;const s=t.return||t;if(p(s.originalSaleRef||""),j(s.returnCode||""),S(s.referenceNo||""),A(s.returnDate?s.returnDate.split("T")[0]:""),B(k.find((e=>e.value===s.warehouse))||null),U($.find((e=>e.value===s.customer))||null),P(s.status||"Return"),te((s.items||[]).map((e=>({item:e.item,itemName:e.itemName||"Unknown Item",itemCode:e.itemCode||"",quantity:e.quantity||1,reason:e.reason||"",price:e.price||0,maxQuantity:e.maxQuantity||e.quantity,isVariant:!!e.isVariant})))),ce(s.otherCharges||0),me(s.discountCouponCode||""),he(s.couponType||""),pe(s.couponValue||0),ge(s.discountOnAll||0),Ne(s.discountOnAllType||"Per%"),je(s.note||""),null!==(a=s.payments)&&void 0!==a&&a.length){const e=s.payments[0];Y(L.find((a=>a.value===e.paymentType))||null),Pe(e.amount||0),Ie(e.paymentNote||""),e.account&&G(V.find((a=>a.value===e.account))||null),e.terminal&&J(q.find((a=>a.value===e.terminal))||null)}if(s.originalSaleRef){(async()=>{try{const[e,a]=await Promise.all([o.A.get("api/sales",$e()),o.A.get("api/pos",$e())]),t=e.data.sales||e.data||[],l=a.data.data||a.data||[],r=t.find((e=>e.referenceNo===s.originalSaleRef))||l.find((e=>e.saleCode===s.originalSaleRef));r&&N(r)}catch(e){console.error("Fetch original sale error:",e)}})()}})).catch((e=>{console.error(e),alert("Failed to load return: "+e.message)}))}),[t,k,$,L,V,q]);const Fe=k.find((e=>e.value===(null===Q||void 0===Q?void 0:Q.value))),Le=Fe&&Fe.cashAccount?V.filter((e=>e.value===Fe.cashAccount)):[],Oe=null===(e=L.find((e=>e.value===(null===W||void 0===W?void 0:W.value))))||void 0===e?void 0:e.name,Ve="cash"===Oe,De="bank"===Oe;(0,s.useEffect)((()=>{if(Ve&&Le.length>0)G(Le[0]);else if(De&&Q){const e=q.filter((e=>e.warehouse===Q.value));e.length>0?J(e[0]):J(null)}else G(null),J(null)}),[Ve,De,Le,Q,q]),(0,s.useEffect)((()=>{(async()=>{if(!v.trim()||m)return g([]),void I("");try{const[e,a]=await Promise.all([o.A.get("api/sales",$e()),o.A.get("api/pos",$e())]),t=(e.data.sales||e.data||[]).filter((e=>{var a;return null===(a=e.referenceNo)||void 0===a?void 0:a.toLowerCase().includes(v.toLowerCase())})),s=(a.data.data||a.data||[]).filter((e=>{var a;return null===(a=e.saleCode)||void 0===a?void 0:a.toLowerCase().includes(v.toLowerCase())})),l=[...t.map((e=>({label:`Sale: ${e.referenceNo}`,value:e.referenceNo,type:"Sales",data:e}))),...s.map((e=>({label:`POS: ${e.saleCode}`,value:e.saleCode,type:"PosOrder",data:e})))].slice(0,10);g(l),0===l.length?I(`No matching sale or POS order found for "${v}".`):I("")}catch(e){console.error("Search sales error:",e),I("Error searching for sales: "+e.message)}})()}),[v,m]);(0,s.useEffect)((()=>{const e=se.trim().toLowerCase();if(!e||!Q)return void ne([]);const a=Z.filter((a=>a.itemName.toLowerCase().includes(e)||a.itemCode.toLowerCase().includes(e)||a.barcode&&a.barcode.toLowerCase().includes(e)));ne(a.slice(0,20))}),[se,Z,Q]);const qe=e=>{te((a=>a.find((a=>a.item===e._id))?a.map((a=>a.item===e._id?{...a,quantity:a.quantity+1}:a)):[...a,{item:e._id,itemName:e.itemName,itemCode:e.itemCode,quantity:1,reason:"",price:e.salesPrice||0,maxQuantity:e.maxQuantity||9999,isVariant:!!e.variantId}])),le(""),ne([])},Te=(e,a,t)=>{te((s=>{const l=[...s];return"quantity"===a&&+t>l[e].maxQuantity&&(t=l[e].maxQuantity),l[e]={...l[e],[a]:"quantity"===a?+t:t},l}))},{subtotal:Qe,oc:Be,cDisc:ze,doAllVal:Ue,grand:We}=(()=>{let e=0;ae.forEach((a=>{e+=a.quantity*a.price}));const a=+de||0,t="percentage"===xe?e*ve/100:+ve||0;let s=+fe||0;"Per%"===ye&&(s=e*s/100);const l=e+a-t-s;return{subtotal:e,oc:a,cDisc:t,doAllVal:s,grand:l<0?0:l}})();(0,s.useEffect)((()=>{Pe(We)}),[We]);return(0,u.jsxs)("div",{className:"flex flex-col h-screen",children:[(0,u.jsx)(n.A,{isSidebarOpen:ke,setSidebarOpen:Ee}),(0,u.jsxs)("div",{className:"flex flex-grow",children:[(0,u.jsx)(i.A,{isSidebarOpen:ke}),(0,u.jsxs)("div",{className:"flex-grow p-4 overflow-y-auto",children:[(0,u.jsxs)("header",{className:"flex flex-col md:flex-row items-center justify-between mb-4",children:[(0,u.jsx)("div",{className:"text-xl font-bold",children:m?"Edit Sales Return":"Add Sales Return"}),(0,u.jsxs)("nav",{className:"flex items-center space-x-2 text-gray-600",children:[(0,u.jsx)(c.k2,{to:"/dashboard",className:"hover:underline",children:"Home"}),(0,u.jsx)(l.XWt,{}),(0,u.jsx)(c.k2,{to:"/sales-payment-list",className:"hover:underline",children:"Return List"})]})]}),(0,u.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[(0,u.jsxs)("div",{className:"flex flex-col relative",children:[(0,u.jsx)("label",{className:"font-semibold text-gray-700",children:"Original Sale Ref"}),(0,u.jsx)("input",{type:"text",className:"p-2 border rounded",value:v,onChange:e=>p(e.target.value),placeholder:"Enter Sale Reference or POS Sale Code (optional)",disabled:m}),f.length>0&&(0,u.jsx)("ul",{className:"absolute z-50 w-full max-h-60 overflow-y-auto bg-white border rounded shadow mt-1 top-full",children:f.map(((e,a)=>(0,u.jsx)("li",{className:"px-3 py-2 cursor-pointer hover:bg-gray-100",onClick:()=>(async e=>{try{const{type:i,value:o,data:d}=e;p(o),N(d);const c=k.find((e=>{var a;return e.value===((null===(a=d.warehouse)||void 0===a?void 0:a._id)||d.warehouse)}));B(c||null),U($.find((e=>{var a;return e.value===((null===(a=d.customer)||void 0===a?void 0:a._id)||d.customer)}))||null),te([]),ee([]),g([]),I("");const u=d.items||[],m=[];for(const e of u){var a,t,s,l,r,n;const i=null===(a=(null===(t=e.variant)||void 0===t?void 0:t._id)||e.variant||(null===(s=e.item)||void 0===s?void 0:s._id)||e.item||(null===(l=e.product)||void 0===l?void 0:l._id)||e.product)||void 0===a?void 0:a.toString();if(!i)continue;let o=K.find((e=>e._id.toString()===i)),d=null;if(o||(o=K.find((e=>{const a=(e.variants||[]).find((e=>e._id.toString()===i));return!!a&&(d=a,!0)}))),!o)continue;const c=!!d;m.push({item:c?d._id:o._id,itemName:c?`${o.itemName} / ${d.name||"Variant"}`:o.itemName,itemCode:(null===(r=d)||void 0===r?void 0:r.itemCode)||o.itemCode,quantity:1,reason:"",price:e.price||(null===(n=d)||void 0===n?void 0:n.salesPrice)||o.salesPrice||0,maxQuantity:e.quantity||1,isVariant:c})}te(m)}catch(i){console.error("Load sale error:",i),alert("Failed to load sale details: "+i.message)}})(e),children:e.label},a)))}),R&&(0,u.jsx)("p",{className:"text-red-500 text-sm mt-1",children:R})]}),(0,u.jsxs)("div",{className:"flex flex-col",children:[(0,u.jsx)("label",{className:"font-semibold text-gray-700",children:"Return Code *"}),(0,u.jsx)("input",{type:"text",className:"p-2 border rounded",value:b,readOnly:!0})]}),(0,u.jsxs)("div",{className:"flex flex-col",children:[(0,u.jsx)("label",{className:"font-semibold text-gray-700",children:"Reference No."}),(0,u.jsx)("input",{type:"text",className:"p-2 border rounded",value:C,onChange:e=>S(e.target.value)})]}),(0,u.jsxs)("div",{className:"flex flex-col",children:[(0,u.jsx)("label",{className:"font-semibold text-gray-700",children:"Return Date *"}),(0,u.jsx)("input",{type:"date",className:"p-2 border rounded",value:w,onChange:e=>A(e.target.value)})]}),(0,u.jsxs)("div",{className:"flex flex-col",children:[(0,u.jsx)("label",{className:"font-semibold text-gray-700",children:"Warehouse *"}),(0,u.jsx)(d.Ay,{options:k,value:Q,onChange:B})]}),(0,u.jsxs)("div",{className:"flex flex-col",children:[(0,u.jsx)("label",{className:"font-semibold text-gray-700",children:"Customer *"}),(0,u.jsx)(d.Ay,{options:$,value:z,onChange:U})]}),(0,u.jsxs)("div",{className:"flex flex-col",children:[(0,u.jsx)("label",{className:"font-semibold text-gray-700",children:"Status"}),(0,u.jsxs)("select",{className:"p-2 border rounded",value:_,onChange:e=>P(e.target.value),children:[(0,u.jsx)("option",{value:"Return",children:"Return"}),(0,u.jsx)("option",{value:"Cancel",children:"Cancel"})]})]})]}),(0,u.jsxs)("div",{className:"relative mb-6",children:[(0,u.jsxs)("div",{className:"flex items-center",children:[(0,u.jsx)(r.SCC,{className:"mr-2 text-gray-600"}),(0,u.jsx)("input",{type:"text",disabled:!Q,placeholder:"Search item by name, code, or barcode",className:"flex-grow p-2 border rounded disabled:bg-gray-100",value:se,onChange:e=>{const a=e.target.value.trim();le(a);const t=Z.find((e=>e.barcode===a||e.itemCode===a||e.itemName.toLowerCase()===a.toLowerCase()));t&&(qe(t),le(""))},onKeyDown:e=>{"Enter"===e.key&&re.length>0&&qe(re[0])}})]}),ie&&(0,u.jsx)("p",{className:"text-red-500 text-sm mt-1",children:ie}),re.length>0&&(0,u.jsx)("ul",{className:"absolute z-50 w-full max-h-60 overflow-y-auto bg-white border rounded shadow mt-1",children:re.map((e=>(0,u.jsxs)("li",{className:"px-3 py-2 cursor-pointer hover:bg-gray-100",onClick:()=>qe(e),children:[(0,u.jsx)("strong",{children:e.itemCode})," \u2014 ",e.itemName," ",e.variantId?"(Variant)":"",(0,u.jsxs)("span",{className:"text-gray-500",children:[" (",e.barcode||"No barcode",")"]})]},e._id)))})]}),(0,u.jsx)("div",{className:"overflow-x-auto mb-6",children:(0,u.jsxs)("table",{className:"w-full table-auto border",children:[(0,u.jsx)("thead",{className:"bg-sky-600 text-white",children:(0,u.jsxs)("tr",{children:[(0,u.jsx)("th",{className:"px-2 py-1",children:"Item"}),(0,u.jsx)("th",{className:"px-2 py-1",children:"Code"}),(0,u.jsx)("th",{className:"px-2 py-1",children:"Qty"}),(0,u.jsx)("th",{className:"px-2 py-1",children:"Price"}),(0,u.jsx)("th",{className:"px-2 py-1",children:"Reason"}),(0,u.jsx)("th",{className:"px-2 py-1",children:"Action"})]})}),(0,u.jsx)("tbody",{children:0===ae.length?(0,u.jsx)("tr",{children:(0,u.jsx)("td",{colSpan:6,className:"py-4 text-center text-red-600",children:"No items to return"})}):ae.map(((e,a)=>(0,u.jsxs)("tr",{className:"text-center",children:[(0,u.jsxs)("td",{className:"border px-2 py-1",children:[e.itemName," ",e.isVariant?"(Variant)":""]}),(0,u.jsx)("td",{className:"border px-2 py-1",children:e.itemCode}),(0,u.jsx)("td",{className:"border px-2 py-1",children:(0,u.jsx)("input",{type:"number",min:"1",max:e.maxQuantity,className:"w-16 border rounded",value:e.quantity,onChange:e=>Te(a,"quantity",e.target.value)})}),(0,u.jsx)("td",{className:"border px-2 py-1",children:e.price.toFixed(2)}),(0,u.jsx)("td",{className:"border px-2 py-1",children:(0,u.jsx)("input",{type:"text",className:"w-full border rounded",value:e.reason,onChange:e=>Te(a,"reason",e.target.value)})}),(0,u.jsx)("td",{className:"border px-2 py-1",children:(0,u.jsx)("button",{className:"text-red-600",onClick:()=>(e=>{te((a=>a.filter(((a,t)=>t!==e))))})(a),children:"Remove"})})]},a)))})]})}),(0,u.jsxs)("div",{className:"mb-6 p-4 bg-white rounded shadow",children:[(0,u.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,u.jsxs)("div",{className:"flex flex-col",children:[(0,u.jsx)("label",{className:"font-semibold",children:"Other Charges"}),(0,u.jsx)("input",{type:"number",min:"0",className:"p-2 border rounded",value:de,onChange:e=>ce(e.target.value)})]}),(0,u.jsxs)("div",{className:"flex flex-col",children:[(0,u.jsx)("label",{className:"font-semibold",children:"Coupon Code"}),(0,u.jsx)("input",{type:"text",className:"p-2 border rounded",value:ue,onChange:e=>me(e.target.value)})]}),(0,u.jsxs)("div",{className:"flex flex-col",children:[(0,u.jsx)("label",{className:"font-semibold",children:"Coupon Type & Value"}),(0,u.jsxs)("div",{className:"flex space-x-2",children:[(0,u.jsxs)("select",{className:"p-2 border rounded",value:xe,onChange:e=>he(e.target.value),children:[(0,u.jsx)("option",{value:"",children:"Select\u2026"}),(0,u.jsx)("option",{value:"percentage",children:"Percentage"}),(0,u.jsx)("option",{value:"value",children:"Fixed"})]}),(0,u.jsx)("input",{type:"number",min:"0",className:"p-2 border rounded w-24",value:ve,onChange:e=>pe(+e.target.value)})]})]}),(0,u.jsxs)("div",{className:"flex flex-col",children:[(0,u.jsx)("label",{className:"font-semibold",children:"Discount on All"}),(0,u.jsxs)("div",{className:"flex space-x-2",children:[(0,u.jsx)("input",{type:"number",min:"0",className:"p-2 border rounded w-24",value:fe,onChange:e=>ge(e.target.value)}),(0,u.jsxs)("select",{className:"p-2 border rounded",value:ye,onChange:e=>Ne(e.target.value),children:[(0,u.jsx)("option",{value:"Per%",children:"Per%"}),(0,u.jsx)("option",{value:"Fixed",children:"Fixed"})]})]})]}),(0,u.jsxs)("div",{className:"flex flex-col",children:[(0,u.jsx)("label",{className:"font-semibold",children:"Note"}),(0,u.jsx)("textarea",{className:"p-2 border rounded",value:be,onChange:e=>je(e.target.value)})]})]}),(0,u.jsxs)("div",{className:"mt-4 border-t pt-4 text-right space-y-2",children:[(0,u.jsxs)("div",{children:[(0,u.jsx)("strong",{children:"Subtotal:"})," \u20b9",Qe.toFixed(2)]}),(0,u.jsxs)("div",{children:[(0,u.jsx)("strong",{children:"Other Charges:"})," \u20b9",Be.toFixed(2)]}),(0,u.jsxs)("div",{children:[(0,u.jsx)("strong",{children:"Coupon Disc:"})," \u20b9",ze.toFixed(2)]}),(0,u.jsxs)("div",{children:[(0,u.jsx)("strong",{children:"Discount on All:"})," \u20b9",Ue.toFixed(2)]}),(0,u.jsxs)("div",{className:"text-xl font-bold",children:[(0,u.jsx)("strong",{children:"Grand Total:"})," \u20b9",We.toFixed(2)]})]})]}),(0,u.jsxs)("div",{className:"mb-6 p-4 bg-white rounded shadow",children:[(0,u.jsx)("h2",{className:"font-semibold mb-2",children:"Payment"}),(0,u.jsxs)("div",{className:"mb-2",children:[(0,u.jsxs)("label",{className:"inline-flex items-center",children:[(0,u.jsx)("input",{type:"checkbox",checked:Ce,onChange:()=>Se(!Ce),className:"mr-2"}),"Adjust Advance"]}),(0,u.jsxs)("label",{className:"inline-flex items-center ml-4",children:[(0,u.jsx)("input",{type:"checkbox",checked:we,onChange:()=>Ae(!we),className:"mr-2"}),"Send Message"]})]}),(0,u.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,u.jsxs)("div",{className:"flex flex-col",children:[(0,u.jsx)("label",{children:"Amount"}),(0,u.jsx)("input",{type:"number",min:"0",className:"p-2 border rounded",value:_e,onChange:e=>Pe(e.target.value)})]}),(0,u.jsxs)("div",{className:"flex flex-col",children:[(0,u.jsx)("label",{children:"Payment Type"}),(0,u.jsx)(d.Ay,{options:L,value:W,onChange:Y})]}),Ve&&(0,u.jsxs)("div",{className:"flex flex-col",children:[(0,u.jsx)("label",{children:"Account"}),(0,u.jsx)(d.Ay,{options:Le,value:M,onChange:G})]}),De&&(0,u.jsxs)("div",{className:"flex flex-col",children:[(0,u.jsx)("label",{children:"Terminal"}),(0,u.jsx)(d.Ay,{options:q.filter((e=>e.warehouse===(null===Q||void 0===Q?void 0:Q.value))),value:H,onChange:J,placeholder:"Select TID"})]})]}),(0,u.jsxs)("div",{className:"mt-4",children:[(0,u.jsx)("label",{children:"Payment Note"}),(0,u.jsx)("textarea",{className:"w-full p-2 border rounded",value:Re,onChange:e=>Ie(e.target.value)})]})]}),(0,u.jsxs)("div",{className:"flex justify-center space-x-4",children:[(0,u.jsx)("button",{className:"px-6 py-2 bg-green-600 text-white rounded",onClick:async()=>{try{if(_e>0&&M){const e=await async function(e){const{data:{warehouseId:a}}=await o.A.get(`api/by-cash-account/${e}`,$e()),{data:t}=await o.A.get("api/cash-summary",{...$e(),params:{warehouseId:a}});return t.liveBalance}(M.value);if(_e>e)return void alert(`Insufficient funds. You only have \u20b9${e.toFixed(2)} available.`)}const e=ae.map((e=>({item:e.item,quantity:e.quantity,reason:e.reason,itemName:e.itemName,itemCode:e.itemCode,price:e.price,maxQuantity:e.maxQuantity,isVariant:e.isVariant}))),s=_e>0?[{paymentType:(null===W||void 0===W?void 0:W.value)||null,account:(null===M||void 0===M?void 0:M.value)||null,terminal:(null===H||void 0===H?void 0:H.value)||null,amount:+_e||0,paymentNote:Re,paymentDate:new Date}]:[],l={originalSaleRef:v||void 0,returnCode:b,referenceNo:C,returnDate:w||(new Date).toISOString(),warehouse:null===Q||void 0===Q?void 0:Q.value,customer:null===z||void 0===z?void 0:z.value,status:_,items:e,totalRefund:We,otherCharges:+de||0,discountCouponCode:ue,couponType:xe,couponValue:+ve||0,discountOnAll:+fe||0,discountOnAllType:ye,note:be,payments:s,adjustAdvance:Ce,sendMessage:we};m?await o.A.put(`api/sales-return/${t}`,l,$e()):await o.A.post("api/sales-return",l,$e()),alert(m?"Sales Return updated!":"Sales Return created!"),a("/sales-payment-list")}catch(l){var e,s;console.error("Save error:",l),alert((null===(e=l.response)||void 0===e||null===(s=e.data)||void 0===s?void 0:s.message)||l.message)}},disabled:(Ye="SalesReturn",Me=m?"Edit":"Add",!("admin"===(localStorage.getItem("role")||"guest").toLowerCase()||x.some((e=>e.module.toLowerCase()===Ye.toLowerCase()&&e.actions.map((e=>e.toLowerCase())).includes(Me.toLowerCase()))))||!Q||!z),children:m?"Update":"Save"}),(0,u.jsx)("button",{className:"px-6 py-2 bg-gray-600 text-white rounded",onClick:()=>a("/sales-payment-list"),children:"Close"})]})]})]})]});var Ye,Me}},82284:(e,a,t)=>{function s(e){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s(e)}t.d(a,{A:()=>s})}}]);
//# sourceMappingURL=3696.ad693b78.chunk.js.map