"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[6469],{17069:(e,t,s)=>{s.d(t,{A:()=>a});var r=s(65043);const a=r.forwardRef((function(e,t){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",ref:t},e),r.createElement("path",{fillRule:"evenodd",d:"M4 5a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V7a2 2 0 00-2-2h-1.586a1 1 0 01-.707-.293l-1.121-1.121A2 2 0 0011.172 3H8.828a2 2 0 00-1.414.586L6.293 4.707A1 1 0 015.586 5H4zm6 9a3 3 0 100-6 3 3 0 000 6z",clipRule:"evenodd"}))}))},26469:(e,t,s)=>{s.r(t),s.d(t,{default:()=>x});var r=s(65043),a=s(86213),l=s(21197),o=(s(53888),s(66727)),n=s(60184),i=s(17069),c=s(79038),d=s(86806),m=s(59255),u=s(70579);const x=()=>{const[e,t]=(0,r.useState)(!0),[s,x]=(0,r.useState)(""),[g,h]=(0,r.useState)(!1),[f,v]=(0,r.useState)([]),[p,w]=(0,r.useState)([]),[b,j]=(0,r.useState)([]),[y,N]=(0,r.useState)(""),[C,k]=(0,r.useState)(!1),[I,S]=(0,r.useState)({});(0,r.useEffect)((()=>{window.innerWidth<768&&t(!1)}),[window.innerWidth]);const E=async()=>{try{let e=(await a.A.get("/api/items",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})).data.data;e.sort(((e,t)=>(e.masterImage?1:0)-(t.masterImage?1:0))),console.log("Items",e),v(e),w(e),j(e)}catch(e){console.error("Error fetching stores:",e)}};(0,r.useEffect)((()=>{E()}),[]);const A=(0,r.useRef)(null),M=(0,r.useRef)(null);(0,r.useEffect)((()=>{if(!g)return;return(async()=>{if(!A.current)return;const e=new c.BrowserMultiFormatReader;M.current=e;const t=async t=>{const s={video:{facingMode:t,advanced:[{width:1920},{height:1080},{zoom:2}]}};return e.decodeFromConstraints(s,A.current,((e,t)=>{if(e){var s,r,a,l;const t=e.getText();alert(t),x(t),null===(s=(r=window.navigator).vibrate)||void 0===s||s.call(r,200);new Audio("/beep.mp3").play();const o=null===(a=A.current)||void 0===a?void 0:a.srcObject;null===o||void 0===o||o.getTracks().forEach((e=>e.stop())),null!==(l=M.current)&&void 0!==l&&l.reset&&"function"===typeof M.current.reset&&M.current.reset(),h(!1)}t&&"NotFoundException"!==t.name&&console.error("Scan error:",t)}))};try{await t({exact:"environment"})}catch(s){if("OverconstrainedError"===s.name||"NotFoundError"===s.name){console.warn("Back camera not found. Trying front camera...");try{await t("user")}catch(r){console.error("Front camera also failed:",r),alert("No camera found or accessible."),h(!1)}}else console.error("Camera access error:",s),alert("Camera access error: "+s.message),h(!1)}})(),()=>{var e,t;const s=null===(e=A.current)||void 0===e?void 0:e.srcObject;null===s||void 0===s||s.getTracks().forEach((e=>e.stop())),null!==(t=M.current)&&void 0!==t&&t.reset&&"function"===typeof M.current.reset&&M.current.reset()}}),[g]),(0,r.useEffect)((()=>{if(!s)return void w(f);const e=s.toLowerCase(),t=f.filter((t=>{var s,r;return(null===(s=t.itemName)||void 0===s?void 0:s.toLowerCase().includes(e))||(null===(r=t.itemCode)||void 0===r?void 0:r.toLowerCase().includes(e))||t.barcode&&t.barcode.toLowerCase().includes(e)}));w(t)}),[s,f]),(0,r.useEffect)((()=>{if(!s)return void j(f);const e=s.toLowerCase(),t=f.filter((t=>{var s,r;return(null===(s=t.itemName)||void 0===s?void 0:s.toLowerCase().includes(e))||(null===(r=t.itemCode)||void 0===r?void 0:r.toLowerCase().includes(e))||t.barcode&&t.barcode.toLowerCase().includes(e)}));j(t)}),[s,f]);const[L,z]=(0,r.useState)(15),R=(0,r.useRef)(null),[$,O]=(0,r.useState)(!1),T=b.slice(0,L);return(0,r.useEffect)((()=>{const e=R.current;if(!e)return;const t=()=>{if($)return;const{scrollTop:t,scrollHeight:s,clientHeight:r}=e;t+r>=s-100&&L<b.length&&(O(!0),setTimeout((()=>{z((e=>Math.min(e+15,b.length))),O(!1)}),500))};return e.addEventListener("scroll",t),()=>e.removeEventListener("scroll",t)}),[L,b.length,$]),(0,r.useEffect)((()=>console.log("aa",b)),[b]),(0,u.jsxs)("div",{className:"flex flex-col h-screen",children:[(0,u.jsx)(l.A,{isSidebarOpen:e,setSidebarOpen:t}),(0,u.jsxs)("div",{className:"flex flex-grow ",children:[(0,u.jsx)("div",{children:(0,u.jsx)(m.A,{isSidebarOpen:e})}),(0,u.jsxs)("div",{className:" flex flex-col p-2 md:p-2  w-full",children:[(0,u.jsxs)("header",{className:"flex flex-col items-center justify-between p-4 rounded-md shadow sm:flex-row",children:[(0,u.jsxs)("div",{className:"flex items-center gap-1 text-center sm:flex-row sm:text-left",children:[(0,u.jsx)("h1",{className:"text-lg font-semibold truncate sm:text-xl",children:"Item Master Image"}),(0,u.jsx)("span",{className:"text-xs text-gray-600 sm:text-sm",children:"Add/Update Master"})]}),(0,u.jsxs)("nav",{className:"flex flex-wrap items-center justify-center mt-2 text-xs text-gray-500 sm:justify-start sm:text-sm sm:mt-0",children:[(0,u.jsxs)(o.k2,{to:"/dashboard",className:"flex items-center text-gray-700 no-underline hover:text-cyan-600",children:[(0,u.jsx)(n.$BV,{className:"mr-2 text-gray-500 hover:text-cyan-600"})," Home"]}),(0,u.jsx)(o.k2,{to:"/banners/view",className:"flex items-center text-gray-700 no-underline hover:text-cyan-600",children:"> Item Master Image"})]})]}),C&&(0,u.jsx)(d.A,{item:I,onClose:()=>{E(),k(!1)}}),(0,u.jsxs)("div",{className:"p-4 mt-1 bg-white border-t-4 rounded-lg shadow-md border-cyan-500",children:[(0,u.jsx)("div",{className:"flex gap-5",children:(0,u.jsxs)("div",{className:"relative flex flex-col w-full py-2",children:[(0,u.jsx)("label",{htmlFor:"",children:"Items"}),(0,u.jsxs)("label",{htmlFor:"",className:"flex",children:[(0,u.jsx)("input",{type:"text",name:"type",className:"w-full px-2 py-1 border-2 rounded-md",value:y,onChange:e=>{x(e.target.value),N(e.target.value)}}),(0,u.jsx)("button",{type:"button",className:"p-2 ml-2 text-white rounded-full hover:bg-blue-600",onClick:()=>h(!0),children:(0,u.jsx)(i.A,{className:"w-6 h-6 text-gray-500"})})]}),""!==s&&p.length>1&&(0,u.jsx)("div",{className:"absolute z-50 w-full overflow-y-auto bg-white border rounded-lg shadow-lg top-20 sm:w-96 max-h-60 touch-auto",style:{WebkitOverflowScrolling:"touch"},children:(0,u.jsx)("ul",{children:p.map((e=>(0,u.jsxs)("li",{onClick:()=>{x(e.itemCode),N(e.itemName)},className:"p-2 cursor-pointer hover:bg-gray-100",children:[(0,u.jsx)("strong",{children:e.itemCode})," - ",e.itemName," - ",e.barcode]},e.itemCode)))})}),g&&(0,u.jsxs)("div",{className:"fixed inset-0 z-50 flex flex-col items-center justify-center bg-black bg-opacity-50",children:[(0,u.jsxs)("div",{className:"relative overflow-hidden border-4 border-white rounded-lg shadow-xl w-72 h-72",children:[(0,u.jsx)("video",{ref:A,className:"absolute object-cover w-full h-full",autoPlay:!0,muted:!0,playsInline:!0}),(0,u.jsx)("div",{className:"absolute w-full h-1 bg-red-500 animate-scan"})]}),(0,u.jsx)("button",{onClick:()=>{var e,t;const s=null===(e=A.current)||void 0===e?void 0:e.srcObject;null===s||void 0===s||s.getTracks().forEach((e=>e.stop())),null!==(t=M.current)&&void 0!==t&&t.reset&&"function"===typeof M.current.reset&&M.current.reset(),h(!1)},className:"px-4 py-2 mt-6 text-white bg-red-600 rounded hover:bg-red-700",children:"Cancel"})]})]})}),(0,u.jsxs)("div",{ref:R,className:"w-full mt-4 overflow-x-auto min-h-16",style:{maxHeight:"500px",overflowY:"auto"},children:[(0,u.jsxs)("table",{className:"min-w-full border-2 divide-y divide-gray-200 min-h-48",children:[(0,u.jsx)("thead",{className:"sticky top-0 bg-gray-200",children:(0,u.jsxs)("tr",{children:[(0,u.jsx)("th",{className:"py-3 text-xs font-medium tracking-wider text-left text-gray-500 uppercase",children:"ItemName"}),(0,u.jsx)("th",{className:"py-3 text-xs font-medium tracking-wider text-left text-gray-500 uppercase",children:"Actions"})]})}),(0,u.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:T.map(((e,t)=>(0,u.jsxs)("tr",{children:[(0,u.jsx)("td",{className:"py-4 text-sm text-gray-500 whitespace-nowrap",children:e.itemName||"NA"}),(0,u.jsx)("td",{className:"py-4 text-sm text-gray-500 whitespace-nowrap",children:(0,u.jsx)("button",{onClick:()=>{S(e),k(!0)},className:"px-3 py-1 text-sm text-white bg-blue-500 rounded hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",children:"Select Master"})})]},t)))})]}),$&&(0,u.jsx)("div",{className:"flex justify-center p-4",children:(0,u.jsx)("div",{className:"w-8 h-8 border-4 border-blue-500 rounded-full border-t-transparent animate-spin"})})]})]})]})]})]})}},53888:(e,t,s)=>{s.d(t,{A:()=>a});s(65043);var r=s(70579);function a(e){let{text:t,type:s="button",className:a,...l}=e;return(0,r.jsx)("button",{className:`${a}`,...l,children:t})}},86806:(e,t,s)=>{s.d(t,{A:()=>o});var r=s(65043),a=s(86213),l=s(70579);const o=e=>{var t;let{item:s,onClose:o}=e;const[n,i]=(0,r.useState)(s.masterImageId||null),[c,d]=(0,r.useState)(s.itemImages||[]),m="/vps/uploads/qr/items";console.log("item"),console.log(s);const u=async e=>{i(e);try{const t=await a.A.put("api/items/assign/master_image",{id:s._id,image:e},{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"}});console.log(t),alert("Master image selected"),o()}catch(t){console.log("ERro in assigning master image",t)}};return(0,l.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm",children:(0,l.jsxs)("div",{className:"relative w-11/12 max-w-5xl p-4 bg-white rounded-lg shadow-lg",children:[(0,l.jsx)("button",{onClick:o,className:"absolute p-1 text-gray-500 top-2 right-2 hover:text-gray-800","aria-label":"Close",children:(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})}),(0,l.jsx)("h3",{children:"Item Master Image"}),s.masterImage&&""!==s.masterImage?(0,l.jsx)("div",{className:"grid grid-cols-2 gap-4 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5",children:(0,l.jsx)("img",{src:`${m}/${s.masterImage}`,alt:`${s.itemName}`,className:"object-cover w-full h-32"})}):(0,l.jsx)("div",{className:"py-8 text-center text-gray-500",children:"No Master Image is selected"}),(0,l.jsx)("h3",{className:"mb-4 text-lg font-semibold",children:"Item Images"}),0===c.length?(0,l.jsx)("div",{className:"py-8 text-center text-gray-500",children:"No images available for this item"}):(0,l.jsx)("div",{className:"grid grid-cols-2 gap-4 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5",children:c.map(((e,t)=>(console.log("image"),console.log(e),(0,l.jsxs)("div",{className:"relative border-2 rounded-lg overflow-hidden "+(n===e._id?"border-blue-500 ring-2 ring-blue-200":"border-gray-200"),draggable:!0,onDragStart:e=>e.dataTransfer.setData("text/plain",t),onDragOver:e=>e.preventDefault(),onDrop:e=>{e.preventDefault();((e,t)=>{const s=Array.from(c),[r]=s.splice(e,1);s.splice(t,0,r),d(s)})(parseInt(e.dataTransfer.getData("text/plain")),t)},children:[(0,l.jsx)("img",{src:`${m}/${e}`,alt:`Item ${s.itemName} - Image ${t+1}`,className:"object-cover w-full h-32"}),(0,l.jsx)("div",{className:"absolute bottom-0 left-0 right-0 p-1 text-xs text-white truncate bg-black bg-opacity-50",children:e.name||`Image ${t+1}`}),(0,l.jsx)("button",{onClick:()=>u(e),className:"absolute top-1 right-1 p-1 rounded-full "+(n===e._id?"bg-blue-500 text-white":"bg-white text-gray-700"),title:n===e._id?"Master image":"Set as master",children:n===e._id?(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-4 h-4",viewBox:"0 0 20 20",fill:"currentColor",children:(0,l.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}):(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-4 h-4",viewBox:"0 0 20 20",fill:"currentColor",children:(0,l.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v2H7a1 1 0 100 2h2v2a1 1 0 102 0v-2h2a1 1 0 100-2h-2V7z",clipRule:"evenodd"})})}),(0,l.jsx)("div",{className:"absolute px-1 text-xs text-white bg-black rounded top-1 left-1 bg-opacity-70",children:t+1})]},e._id))))}),n&&(0,l.jsxs)("div",{className:"mt-4 text-sm text-gray-600",children:["Master image selected: ",(null===(t=c.find((e=>e._id===n)))||void 0===t?void 0:t.name)||"No name"]})]})})}}}]);
//# sourceMappingURL=6469.e27c2990.chunk.js.map