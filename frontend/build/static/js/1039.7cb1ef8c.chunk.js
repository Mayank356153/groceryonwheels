"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[1039],{14840:(e,a,t)=>{t.d(a,{A:()=>l});var s=t(65043),n=t(21197),o=t(59255),r=t(70579);function l(){const[e,a]=(0,s.useState)(!1);return(0,r.jsxs)("div",{className:"flex flex-col h-screen",children:[(0,r.jsx)(n.A,{isSidebarOpen:e,setSidebarOpen:a}),(0,r.jsxs)("div",{className:"flex flex-grow mt-20",children:[(0,r.jsx)("div",{children:(0,r.jsx)(o.A,{isSidebarOpen:e})}),(0,r.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-white/80 backdrop-blur-sm",children:(0,r.jsxs)("div",{className:"flex flex-col items-center",children:[(0,r.jsx)("div",{className:"w-12 h-12 border-4 rounded-full border-cyan-500 border-t-transparent animate-spin"}),(0,r.jsx)("p",{className:"mt-3 text-lg font-semibold text-gray-700",children:"Loading..."})]})})]})]})}},81039:(e,a,t)=>{t.r(a),t.d(a,{default:()=>c});var s=t(65043),n=t(66727),o=t(86213),r=t(21197),l=t(59255),d=t(14840),i=t(70579);const c=()=>{const e=(0,n.Zp)(),a=(0,n.zy)(),t=new URLSearchParams(a.search).get("id"),[c,m]=(0,s.useState)(!0),[u,x]=(0,s.useState)(!1),[p,y]=(0,s.useState)({customer:"",saleCode:"",totalAmount:0,totalPaid:0,dueAmount:0}),[h,f]=(0,s.useState)([]),[g,b]=(0,s.useState)([]),[v,j]=(0,s.useState)({paymentDate:(new Date).toISOString().split("T")[0],paymentType:"",amount:"",account:"",paymentNote:""}),[N,w]=(0,s.useState)("");(0,s.useEffect)((()=>{if(window.innerWidth<768&&m(!1),!t)return alert("Invalid sale ID"),void e("/sales-list");A()}),[t,e]);const A=async()=>{const a=localStorage.getItem("token");if(!a)return alert("No token found, please log in"),void e("/login");x(!0);try{var s;const e=await o.A.get("api/pos/invoices",{headers:{Authorization:`Bearer ${a}`}});console.log("Sale ID:",t),console.log("Invoices Response:",e.data);let r=e.data.find((e=>e._id.toString()===t));if(r||(r=e.data.find((e=>e.saleCode===t))),!r)throw new Error(`Invoice not found for Sale ID or Sale Code: ${t}`);const l=await o.A.get(`api/payments/${r._id}`,{headers:{Authorization:`Bearer ${a}`}}),d=await o.A.get("api/paymenttypes",{headers:{Authorization:`Bearer ${a}`}});let i=[];try{const e=await o.A.get("api/accounts",{headers:{Authorization:`Bearer ${a}`}});i=e.data}catch(n){console.warn("Accounts endpoint not available, skipping accounts:",n.message)}const c=l.data.payments.reduce(((e,a)=>e+(a.paymentAmount||0)),0),m=r.amount||0,u=m-c;y({customer:(null===(s=r.customer)||void 0===s?void 0:s.customerName)||"N/A",saleCode:r.saleCode||"N/A",totalAmount:m,totalPaid:c,dueAmount:u}),f(d.data||[]),b(i),d.data.length>0&&j((e=>({...e,paymentType:d.data[0]._id}))),i.length>0&&j((e=>({...e,account:i[0]._id}))),u>0&&j((e=>({...e,amount:u.toFixed(2)})))}catch(n){console.error("Error fetching data:",n),alert(`Could not load invoice details: ${n.message}`),e("/sales-list")}finally{x(!1)}},S=e=>{const{name:a,value:t}=e.target;j((e=>({...e,[a]:t})))};return u?(0,i.jsx)(d.A,{}):(0,i.jsxs)("div",{className:"flex flex-col",children:[(0,i.jsx)(r.A,{isSidebarOpen:c,setSidebarOpen:m}),(0,i.jsxs)("div",{className:"box-border flex min-h-screen",children:[(0,i.jsx)("div",{className:"w-auto",children:(0,i.jsx)(l.A,{isSidebarOpen:c})}),(0,i.jsxs)("div",{className:"flex flex-col p-2 md:p-2 w-full mx-auto overflow-x-auto",children:[(0,i.jsx)("header",{className:"flex flex-col items-center justify-between px-2 py-2 mb-2 bg-gray-100 rounded-md shadow md:flex-row",children:(0,i.jsxs)("div",{className:"flex items-baseline gap-1 text-center sm:flex-row sm:text-left",children:[(0,i.jsx)("h1",{className:"text-lg font-semibold truncate sm:text-xl",children:"Receive Payment"}),(0,i.jsxs)("span",{className:"text-xs text-gray-600 sm:text-sm",children:["Payment for Invoice ",p.saleCode]})]})}),(0,i.jsxs)("div",{className:"p-4 bg-white shadow-md rounded-md mt-3 border-t-4 border-cyan-500",children:[(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{className:"font-semibold text-gray-700",children:"Customer Details"}),(0,i.jsx)("p",{children:p.customer})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{className:"font-semibold text-gray-700",children:"Invoice Details"}),(0,i.jsxs)("p",{children:["Invoice #: ",p.saleCode]}),(0,i.jsxs)("p",{children:["Grand Total: \u20b9",p.totalAmount.toFixed(2)]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{className:"font-semibold text-gray-700",children:"Payment Status"}),(0,i.jsxs)("p",{children:["Paid Amount: \u20b9",p.totalPaid.toFixed(2)]}),(0,i.jsxs)("p",{children:["Due Amount: \u20b9",p.dueAmount.toFixed(2)]})]})]}),(0,i.jsxs)("form",{onSubmit:async a=>{a.preventDefault(),w("");const s=localStorage.getItem("token");if(!s)return alert("No token found, please log in"),void e("/login");if(v.paymentDate)if(v.paymentType)if(!v.amount||v.amount<=0)w("Amount must be greater than 0");else{x(!0);try{const a={saleId:t,paymentDate:v.paymentDate,paymentType:v.paymentType,amount:parseFloat(v.amount),account:v.account||void 0,paymentNote:v.paymentNote||void 0};await o.A.post("api/payments/receive",a,{headers:{Authorization:`Bearer ${s}`}}),alert("Payment received successfully!"),e("/sales-list")}catch(l){var n,r;console.error("Error submitting payment:",l),w(`Failed to submit payment: ${(null===(n=l.response)||void 0===n||null===(r=n.data)||void 0===r?void 0:r.message)||l.message}`)}finally{x(!1)}}else w("Payment type is required");else w("Payment date is required")},children:[N&&(0,i.jsx)("div",{className:"mb-4 p-2 bg-red-100 text-red-700 rounded",children:N}),(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsxs)("label",{className:"block text-sm font-medium text-gray-700",children:["Payment Date ",(0,i.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,i.jsx)("input",{type:"date",name:"paymentDate",value:v.paymentDate,onChange:S,className:"mt-1 block w-full p-2 border border-gray-300 rounded-md focus:ring-cyan-500 focus:border-cyan-500",required:!0})]}),(0,i.jsxs)("div",{children:[(0,i.jsxs)("label",{className:"block text-sm font-medium text-gray-700",children:["Payment Type ",(0,i.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,i.jsx)("select",{name:"paymentType",value:v.paymentType,onChange:S,className:"mt-1 block w-full p-2 border border-gray-300 rounded-md focus:ring-cyan-500 focus:border-cyan-500",required:!0,children:0===h.length?(0,i.jsx)("option",{value:"",children:"No payment types available"}):h.map((e=>(0,i.jsx)("option",{value:e._id,children:e.paymentTypeName},e._id)))})]}),(0,i.jsxs)("div",{children:[(0,i.jsxs)("label",{className:"block text-sm font-medium text-gray-700",children:["Amount ",(0,i.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,i.jsx)("input",{type:"number",name:"amount",value:v.amount,onChange:S,step:"0.01",min:"0",className:"mt-1 block w-full p-2 border border-gray-300 rounded-md focus:ring-cyan-500 focus:border-cyan-500",required:!0})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Account (Optional)"}),(0,i.jsxs)("select",{name:"account",value:v.account,onChange:S,className:"mt-1 block w-full p-2 border border-gray-300 rounded-md focus:ring-cyan-500 focus:border-cyan-500",children:[(0,i.jsx)("option",{value:"",children:"Select Account"}),g.map((e=>(0,i.jsx)("option",{value:e._id,children:e.accountName},e._id)))]})]}),(0,i.jsxs)("div",{className:"md:col-span-2",children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Payment Note (Optional)"}),(0,i.jsx)("textarea",{name:"paymentNote",value:v.paymentNote,onChange:S,className:"mt-1 block w-full p-2 border border-gray-300 rounded-md focus:ring-cyan-500 focus:border-cyan-500",rows:"3"})]})]}),(0,i.jsxs)("div",{className:"mt-4 flex justify-end space-x-2",children:[(0,i.jsx)("button",{type:"button",onClick:()=>e("/sales-list"),className:"px-4 py-2 text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300",children:"Cancel"}),(0,i.jsx)("button",{type:"submit",className:"px-4 py-2 text-white bg-cyan-500 rounded-md hover:bg-cyan-600",children:"Submit Payment"})]})]})]})]})]})]})}}}]);
//# sourceMappingURL=1039.7cb1ef8c.chunk.js.map