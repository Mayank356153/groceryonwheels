"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[1512],{14840:(e,s,l)=>{l.d(s,{A:()=>n});var t=l(65043),a=l(21197),i=l(59255),r=l(70579);function n(){const[e,s]=(0,t.useState)(!1);return(0,r.jsxs)("div",{className:"flex flex-col h-screen",children:[(0,r.jsx)(a.A,{isSidebarOpen:e,setSidebarOpen:s}),(0,r.jsxs)("div",{className:"flex flex-grow mt-20",children:[(0,r.jsx)("div",{children:(0,r.jsx)(i.A,{isSidebarOpen:e})}),(0,r.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-white/80 backdrop-blur-sm",children:(0,r.jsxs)("div",{className:"flex flex-col items-center",children:[(0,r.jsx)("div",{className:"w-12 h-12 border-4 rounded-full border-cyan-500 border-t-transparent animate-spin"}),(0,r.jsx)("p",{className:"mt-3 text-lg font-semibold text-gray-700",children:"Loading..."})]})})]})]})}},66453:(e,s,l)=>{l.r(s),l.d(s,{default:()=>f});var t=l(65043),a=l(59255),i=l(21197),r=l(49804),n=l(60184),c=l(66727),o=l(86213),d=l(26873),m=l(11238),x=l(14840),u=l(70579);const h="/vps/uploads/qr/items",p=e=>e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),b=function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"items_export.csv";const l=m.utils.json_to_sheet(e),t=new Blob([m.utils.sheet_to_csv(l)],{type:"text/csv;charset=utf-8;"});Object.assign(document.createElement("a"),{href:URL.createObjectURL(t),download:s}).click()},g=function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"items_export.xlsx";const l=m.utils.book_new();m.utils.book_append_sheet(l,m.utils.json_to_sheet(e),"Items"),m.writeFile(l,s)};function f(){const e=(0,c.Zp)(),[s,l]=(0,t.useState)(!0),[m,f]=(0,t.useState)(!1),[j,v]=(0,t.useState)(null),[y,N]=(0,t.useState)([]),[w,k]=(0,t.useState)({}),[S,C]=(0,t.useState)([]),[_,A]=(0,t.useState)([]),[O,I]=(0,t.useState)("all"),[P,$]=(0,t.useState)("all"),[W,L]=(0,t.useState)(""),[E,M]=(0,t.useState)("itemCode"),[R,z]=(0,t.useState)("asc"),[F,H]=(0,t.useState)(1),[B,X]=(0,t.useState)(null),[D,V]=(0,t.useState)(null),[q,U]=(0,t.useState)(null),[G,J]=(0,t.useState)(null),[T,Y]=(0,t.useState)(null),Z=()=>({headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),K=async()=>{f(!0);try{const{data:e}=await o.A.get("api/items",Z());N(e.data||[])}catch{v("Failed to fetch items \u2014 try again.")}finally{f(!1)}},Q=async e=>{f(!0);try{const s="all"===e?await(async()=>{const e=S.filter((e=>"all"!==e.value));if(0===e.length)return{};const s=e.map((e=>o.A.get("api/items",{...Z(),params:{warehouse:e.value,page:1,limit:1e4}}))),l=await Promise.all(s),t={};return l.forEach((e=>{let{data:s}=e;(s.data||[]).forEach((e=>{var s;const l=e._id;t[l]=(t[l]||0)+(null!==(s=e.currentStock)&&void 0!==s?s:0)}))})),t})():await(async e=>{if("all"===e)return{};const{data:s}=await o.A.get("api/items",{...Z(),params:{warehouse:e,page:1,limit:1e4}}),l={};return(s.data||[]).forEach((e=>{var s;return l[e._id]=null!==(s=e.currentStock)&&void 0!==s?s:0})),l})(e);k(s)}catch{v("Failed to fetch stock numbers.")}finally{f(!1)}};(0,t.useEffect)((()=>{window.innerWidth<768&&l(!1),(async()=>{const[e,s]=await Promise.all([o.A.get("api/warehouses",Z()),o.A.get("api/categories",Z())]);C([{label:"All Warehouses",value:"all"},...(e.data.data||[]).map((e=>({label:e.warehouseName,value:e._id})))]),A([{label:"All Categories",value:"all"},...(s.data.data||[]).map((e=>({label:e.name,value:e._id})))]),await K(),await Q("all")})()}),[]),(0,t.useEffect)((()=>{Q(O),H(1)}),[O]);const ee=(0,t.useMemo)((()=>y.map((e=>{var s;return{...e,rowStock:null!==(s=w[e._id])&&void 0!==s?s:0,presentInWh:w.hasOwnProperty(e._id)}}))),[y,w]),se=(0,t.useMemo)((()=>{let e=[...ee];if("all"!==O&&(e=e.filter((e=>{var s;return w.hasOwnProperty(e._id)||(null===(s=e.warehouse)||void 0===s?void 0:s._id)===O}))),W.trim()){const s=p(W.trim()),l=new RegExp(s,"i");e=e.filter((e=>l.test(e.itemName)||l.test(e.itemCode)||(e.barcodes||[]).some((e=>l.test(e)))))}return"all"!==P&&(e=e.filter((e=>{var s;return(null===(s=e.category)||void 0===s?void 0:s._id)===P}))),e.sort(((e,s)=>{const l=e=>{var s;return"rowStock"===E?e.rowStock:null!==(s=e[E])&&void 0!==s?s:""},t=l(e),a=l(s);return t<a?"asc"===R?-1:1:t>a?"asc"===R?1:-1:0})),e}),[ee,W,P,E,R]),le=Math.ceil(se.length/10),te=10*(F-1),ae=se.slice(te,te+10),ie=(e,s)=>N((l=>l.map((l=>l._id===e?{...l,...s}:l))));return m?(0,u.jsx)(x.A,{}):j?(0,u.jsx)("div",{className:"p-4 text-red-600",children:j}):(0,u.jsxs)("div",{className:"flex flex-col h-screen",children:[(0,u.jsx)(i.A,{isSidebarOpen:s,setSidebarOpen:l}),(0,u.jsxs)("div",{className:"flex flex-grow",children:[(0,u.jsx)(a.A,{isSidebarOpen:s}),(0,u.jsxs)("div",{className:"flex-grow p-4 mt-20",children:[(0,u.jsxs)("header",{className:"flex flex-col md:flex-row justify-between mb-6",children:[(0,u.jsx)("h2",{className:"text-2xl font-bold",children:"Items List"}),(0,u.jsxs)("nav",{className:"flex text-gray-600 gap-2 mt-2 md:mt-0",children:[(0,u.jsxs)(c.k2,{to:"/dashboard",className:"flex items-center",children:[(0,u.jsx)(n.$BV,{})," Home"]}),(0,u.jsx)(r.XWt,{}),(0,u.jsx)(c.k2,{to:"/item-list",children:"Items List"})]})]}),(0,u.jsxs)("div",{className:"mb-4 p-4 bg-white rounded shadow flex flex-wrap gap-4 items-end",children:[(0,u.jsxs)("div",{className:"w-48",children:[(0,u.jsx)("label",{className:"block mb-1",children:"Warehouse"}),(0,u.jsx)(d.Ay,{options:S,value:S.find((e=>e.value===O)),onChange:e=>I(e.value)})]}),(0,u.jsxs)("div",{className:"w-48",children:[(0,u.jsx)("label",{className:"block mb-1",children:"Category"}),(0,u.jsx)(d.Ay,{options:_,value:_.find((e=>e.value===P)),onChange:e=>{$(e.value),H(1)}})]}),(0,u.jsxs)("div",{className:"flex-1 min-w-[200px]",children:[(0,u.jsx)("label",{className:"block mb-1",children:"Search"}),(0,u.jsx)("input",{value:W,onChange:e=>{L(e.target.value),H(1)},placeholder:"Code / name / barcode",className:"w-full px-3 py-2 border rounded"})]}),(0,u.jsxs)("div",{className:"w-48",children:[(0,u.jsx)("label",{className:"block mb-1",children:"Sort by"}),(0,u.jsx)(d.Ay,{options:[{label:"Item Code \u2191",value:"itemCode|asc"},{label:"Item Code \u2193",value:"itemCode|desc"},{label:"Stock Low\u2192High",value:"rowStock|asc"},{label:"Stock High\u2192Low",value:"rowStock|desc"},{label:"Price Low\u2192High",value:"salesPrice|asc"},{label:"Price High\u2192Low",value:"salesPrice|desc"}],onChange:e=>{const[s,l]=e.value.split("|");M(s),z(l)}})]}),(0,u.jsxs)("div",{className:"flex gap-2 ml-auto",children:[(0,u.jsx)("button",{onClick:()=>b(se),className:"px-4 py-2 bg-gray-500 text-white rounded",children:"CSV"}),(0,u.jsx)("button",{onClick:()=>g(se),className:"px-4 py-2 bg-gray-700 text-white rounded",children:"XLSX"}),(0,u.jsx)(c.N_,{to:"/items/add",children:(0,u.jsx)("button",{className:"px-4 py-2 bg-cyan-500 text-white rounded",children:"+ Create Item"})})]})]}),(0,u.jsx)("div",{className:"overflow-x-auto bg-white rounded shadow",children:(0,u.jsxs)("table",{className:"w-full text-sm border-collapse",children:[(0,u.jsx)("thead",{children:(0,u.jsx)("tr",{className:"bg-gray-200",children:[{label:"Image",field:null},{label:"Code",field:"itemCode"},{label:"Name",field:null},{label:"Category",field:null},{label:"Stock",field:"rowStock"},{label:"Price",field:"salesPrice"},{label:"Visibility",field:null},{label:"Action",field:null}].map((e=>{let{label:s,field:l}=e;return(0,u.jsx)("th",{className:"px-2 py-1 border",children:(0,u.jsxs)("div",{className:"flex items-center justify-center",children:[s,l&&(0,u.jsxs)("span",{className:"ml-1 flex flex-col",children:[(0,u.jsx)(n.XhJ,{className:"cursor-pointer "+(E===l&&"asc"===R?"text-blue-600":"text-gray-400"),onClick:()=>{M(l),z("asc")}}),(0,u.jsx)(n.GOR,{className:"cursor-pointer "+(E===l&&"desc"===R?"text-blue-600":"text-gray-400"),onClick:()=>{M(l),z("desc")}})]})]})},s)}))})}),(0,u.jsx)("tbody",{children:ae.length?ae.map((s=>{var l,t;const a=null!==(l=s.itemImages)&&void 0!==l&&l[0]?`${h}/${s.itemImages[0]}`:null;return(0,u.jsxs)("tr",{children:[(0,u.jsx)("td",{className:"border px-2 py-1 text-center",children:a?(0,u.jsx)("img",{src:a,alt:s.itemName,className:"w-10 h-10 object-cover mx-auto cursor-pointer",onClick:()=>U(s)}):"\u2014"}),(0,u.jsx)("td",{className:"border px-2 py-1",children:s.itemCode}),(0,u.jsx)("td",{className:"border px-2 py-1",children:s.itemName}),(0,u.jsx)("td",{className:"border px-2 py-1",children:(null===(t=s.category)||void 0===t?void 0:t.name)||"\u2014"}),(0,u.jsxs)("td",{className:"border px-2 py-1 text-center",children:[s.rowStock,(0,u.jsx)(n.HFM,{className:"inline ml-1 cursor-pointer",onClick:()=>(async e=>{try{const s=S.filter((e=>"all"!==e.value)),l=s.map((s=>o.A.get("api/items",{...Z(),params:{warehouse:s.value,search:e.itemCode,page:1,limit:1}}))),t=(await Promise.allSettled(l)).map(((e,l)=>{var t,a;const i=s[l];if("fulfilled"!==e.status)return{id:i.value,name:i.label,stock:"N/A"};const r=null===(t=e.value.data.data)||void 0===t?void 0:t[0];return{id:i.value,name:i.label,stock:r&&null!==(a=r.currentStock)&&void 0!==a?a:0}}));V({...e,stocksByWh:t})}catch{alert("Failed to load stock breakdown.")}})(s)})]}),(0,u.jsx)("td",{className:"border px-2 py-1 text-right",children:s.salesPrice}),(0,u.jsx)("td",{className:"border px-2 py-1 text-center",children:(0,u.jsx)("span",{onClick:()=>(async e=>{ie(e._id,{isOnline:!e.isOnline});try{await o.A.put(`api/items/${e._id}`,{isOnline:!e.isOnline},Z())}catch{ie(e._id,{isOnline:e.isOnline}),alert("Could not update visibility.")}})(s),className:"px-2 py-1 rounded text-xs cursor-pointer select-none "+(s.isOnline?"bg-green-600 text-white hover:bg-green-700":"bg-red-500 text-white hover:bg-red-600"),children:s.isOnline?"Online":"Offline"})}),(0,u.jsxs)("td",{className:"border px-2 py-1 relative",children:[(0,u.jsx)("button",{onClick:()=>X(B===s._id?null:s._id),className:"px-2 py-1 bg-cyan-600 text-white rounded",children:"Action \u25bc"}),B===s._id&&(0,u.jsxs)("div",{className:"absolute right-0 mt-1 bg-white border rounded shadow z-50",children:[(0,u.jsxs)("button",{className:"flex items-center w-full px-3 py-2 hover:bg-gray-100",onClick:()=>e(`/items/add?id=${s.parentItemId||s._id}`),children:[(0,u.jsx)(n.uO9,{className:"mr-2"})," Edit"]}),(0,u.jsxs)("button",{className:"flex items-center w-full px-3 py-2 text-red-600 hover:bg-gray-100",onClick:()=>(async e=>{if(window.confirm("Delete this item?")){f(!0);try{await o.A.delete(`api/items/${e}`,Z()),await K(),await Q(O)}catch{v("Delete failed \u2014 try again.")}finally{f(!1)}}})(s._id),children:[(0,u.jsx)(n.qbC,{className:"mr-2"})," Delete"]})]})]})]},s._id)})):(0,u.jsx)("tr",{children:(0,u.jsx)("td",{colSpan:"9",className:"py-4 text-center",children:"No data"})})})]})}),(0,u.jsxs)("div",{className:"flex justify-between items-center mt-4 px-2",children:[(0,u.jsxs)("span",{children:["Showing ",te+1,"\u2013",Math.min(te+10,se.length)," of"," ",se.length]}),(0,u.jsxs)("div",{className:"space-x-2",children:[(0,u.jsx)("button",{onClick:()=>H((e=>Math.max(e-1,1))),disabled:1===F,className:"px-3 py-1 bg-gray-300 rounded disabled:opacity-50",children:"Previous"}),(0,u.jsx)("button",{onClick:()=>H((e=>Math.min(e+1,le))),disabled:F===le,className:"px-3 py-1 bg-gray-300 rounded disabled:opacity-50",children:"Next"})]})]})]})]}),D&&(0,u.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70",onClick:()=>V(null),children:(0,u.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-4 max-w-md w-full",onClick:e=>e.stopPropagation(),children:[(0,u.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,u.jsx)("h3",{className:"text-lg font-semibold",children:"Warehouse Wise Stock"}),(0,u.jsx)("button",{className:"text-red-600 text-2xl font-bold",onClick:()=>V(null),children:"\xd7"})]}),(0,u.jsxs)("div",{className:"mb-2",children:[(0,u.jsxs)("p",{children:[(0,u.jsx)("strong",{children:"Item Name:"})," ",D.itemName||"N/A"]}),(0,u.jsxs)("p",{children:[(0,u.jsx)("strong",{children:"Sales Price:"})," ",D.salesPrice||"N/A"]})]}),(0,u.jsxs)("table",{className:"w-full text-sm border-collapse",children:[(0,u.jsx)("thead",{children:(0,u.jsxs)("tr",{className:"bg-blue-500 text-white",children:[(0,u.jsx)("th",{className:"border px-2 py-1",children:"#"}),(0,u.jsx)("th",{className:"border px-2 py-1",children:"Warehouse"}),(0,u.jsx)("th",{className:"border px-2 py-1",children:"Stock"})]})}),(0,u.jsx)("tbody",{children:D.stocksByWh.map(((e,s)=>(0,u.jsxs)("tr",{className:"border",children:[(0,u.jsx)("td",{className:"border px-2 py-1",children:s+1}),(0,u.jsx)("td",{className:"border px-2 py-1",children:e.name}),(0,u.jsx)("td",{className:"border px-2 py-1",children:e.stock})]},e.id)))})]}),(0,u.jsx)("button",{className:"mt-4 px-4 py-2 bg-gray-300 rounded hover:bg-gray-400",onClick:()=>V(null),children:"Close"})]})}),q&&(0,u.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70",onClick:()=>{U(null),J(null)},children:(0,u.jsxs)("div",{className:"bg-white rounded shadow-lg max-w-4xl w-full max-h-[90vh] p-4 overflow-auto",onClick:e=>e.stopPropagation(),children:[(0,u.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,u.jsxs)("h3",{className:"text-lg font-semibold",children:[q.itemName," \u2013 images"]}),(0,u.jsx)("button",{className:"text-red-600 text-2xl font-bold",onClick:()=>{U(null),J(null)},children:"\xd7"})]}),(0,u.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4",children:q.itemImages.map(((e,s)=>{const l=e.startsWith("http")?e:`${h}/${e}`;return(0,u.jsx)("div",{className:"relative group",children:(0,u.jsx)("img",{src:l,alt:`${q.itemName} ${s+1}`,className:"w-full h-64 object-cover rounded cursor-pointer",onClick:()=>{J(e),Y(s)},onError:e=>{e.currentTarget.src="https://via.placeholder.com/150"}})},s)}))}),G&&(0,u.jsx)("div",{className:"fixed inset-0 z-60 flex items-center justify-center bg-black/50",onClick:()=>J(null),children:(0,u.jsxs)("div",{className:"bg-white rounded-lg p-6 shadow-lg max-w-sm w-full",onClick:e=>e.stopPropagation(),children:[(0,u.jsx)("h4",{className:"text-lg font-semibold mb-4",children:"Remove this image?"}),(0,u.jsxs)("p",{className:"text-sm mb-6 text-gray-700",children:["Are you sure you want to remove"," ",(0,u.jsx)("span",{className:"font-medium",children:G}),"?"]}),(0,u.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,u.jsx)("button",{className:"px-4 py-2 bg-gray-300 rounded hover:bg-gray-400",onClick:()=>J(null),children:"Cancel"}),(0,u.jsx)("button",{className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",onClick:()=>{(async e=>{if(!window.confirm("Remove this image?"))return;const s=q.itemImages[e];U((s=>{const l=[...s.itemImages];return l.splice(e,1),{...s,itemImages:l}}));try{await o.A.delete(`/items/${q._id}/images/${s}`)}catch(l){console.error("Failed to remove image on server:",l)}})(T),J(null)},children:"Yes, Remove"})]})]})})]})})]})}},82284:(e,s,l)=>{function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}l.d(s,{A:()=>t})}}]);
//# sourceMappingURL=1512.e43f0e72.chunk.js.map