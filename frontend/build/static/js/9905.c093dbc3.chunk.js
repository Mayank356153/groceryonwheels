"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[9905],{14840:(e,s,t)=>{t.d(s,{A:()=>d});var a=t(65043),l=t(21197),r=t(59255),n=t(70579);function d(){const[e,s]=(0,a.useState)(!1);return(0,n.jsxs)("div",{className:"flex flex-col h-screen",children:[(0,n.jsx)(l.A,{isSidebarOpen:e,setSidebarOpen:s}),(0,n.jsxs)("div",{className:"flex flex-grow mt-20",children:[(0,n.jsx)("div",{children:(0,n.jsx)(r.A,{isSidebarOpen:e})}),(0,n.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-white/80 backdrop-blur-sm",children:(0,n.jsxs)("div",{className:"flex flex-col items-center",children:[(0,n.jsx)("div",{className:"w-12 h-12 border-4 rounded-full border-cyan-500 border-t-transparent animate-spin"}),(0,n.jsx)("p",{className:"mt-3 text-lg font-semibold text-gray-700",children:"Loading..."})]})})]})]})}},69905:(e,s,t)=>{t.r(s),t.d(s,{default:()=>f});var a=t(65043),l=t(27473),r=t(33150),n=t(83910),d=t(97929),c=t(60184),i=t(66727),o=t(32916),x=t(21197),m=t(59255),h=t(86213),u=t(14840),p=t(70579);const f=()=>{const[e,s]=(0,a.useState)(!1),[t,f]=(0,a.useState)([]),[g,j]=(0,a.useState)(null),[b,y]=(0,a.useState)(!0),[N,v]=(0,a.useState)(""),[w,S]=(0,a.useState)(1),[C,k]=(0,a.useState)(10),[A,P]=(0,a.useState)([]),[L,_]=(0,a.useState)(0),[D,E]=(0,a.useState)(0),[T,I]=(0,a.useState)(0),[O,$]=(0,a.useState)([]);function z(e,s){return"admin"===(localStorage.getItem("role")||"guest").toLowerCase()||O.some((t=>t.module.toLowerCase()===e.toLowerCase()&&t.actions.map((e=>e.toLowerCase())).includes(s.toLowerCase())))}(0,a.useEffect)((()=>{const e=localStorage.getItem("permissions");e&&$(JSON.parse(e))}),[]);const B=(0,i.Zp)(),[R,F]=(0,a.useState)(null);(0,a.useEffect)((()=>{window.innerWidth<768&&y(!1)}),[]);const V=async()=>{s(!0);const e=localStorage.getItem("token");if(!e)return console.log("No token found redirecting..."),void B("/");try{const s=await h.A.get("api/purchases/purchase-returns",{headers:{Authorization:`Bearer ${e}`}});console.log("Purchase List"),console.log(s.data),s.data.data&&P(s.data.data)}catch(t){alert(t.message)}finally{s(!1)}};(0,a.useEffect)((()=>{V(),(async()=>{s(!0);const e=localStorage.getItem("token");if(!e)return console.log("No token found redirecting..."),void B("/");try{const s=await h.A.get("api/warehouses",{headers:{Authorization:`Bearer ${e}`}});if(console.log("Warehouse"),console.log(s.data),s.data.data){const e=s.data.data.map((e=>({label:e.warehouseName,value:e._id})));f(e)}}catch(t){alert(t.message)}finally{s(!1)}})()}),[]),(0,a.useEffect)((()=>{(()=>{const e=("all"!==g&&g?A.filter((e=>{var s;return(null===(s=e.warehouse)||void 0===s?void 0:s._id)===g})):A).reduce(((e,s)=>e+(s.grandTotal||0)),0);E(e),console.log(e)})(),(()=>{if(!A||0===A.length)return void I(0);const e=("all"!==g&&g?A.filter((e=>{var s;return(null===(s=e.warehouse)||void 0===s?void 0:s._id)===g})):A).reduce(((e,s)=>{var t;return e+((null===(t=s.payments)||void 0===t?void 0:t.length)>0&&s.payments[0].amount||0)}),0);I(e),console.log(e)})(),(()=>{const e="all"!==g&&g?A.filter((e=>{var s;return(null===(s=e.warehouse)||void 0===s?void 0:s._id)===g})):A;_(e.length)})()}),[A,g]);const W=A.filter((e=>{var s;return(null===(s=e.purchaseCode)||void 0===s?void 0:s.toLowerCase().includes(N.toLowerCase()))||e.referenceNo.toLowerCase().includes(N.toLowerCase())})),M=w*C,q=M-C,H=W.slice(q,M),J=Math.ceil(W.length/C),U=e=>{S(e)};return e&&u.A,(0,p.jsxs)("div",{className:"flex flex-col h-screen",children:[(0,p.jsx)(x.A,{isSidebarOpen:b,setSidebarOpen:y}),(0,p.jsxs)("div",{className:"flex flex-grow",children:[(0,p.jsx)("div",{className:"w-auto",children:(0,p.jsx)(m.A,{isSidebarOpen:b})}),(0,p.jsxs)("div",{className:"overflow-x-auto  flex flex-col p-2 md:p-2 min-h-screen w-full",children:[(0,p.jsxs)("header",{className:"flex flex-col items-center justify-between p-4 mb-6 bg-gray-100 rounded-lg md:flex-row",children:[(0,p.jsxs)("div",{className:"flex items-baseline",children:[(0,p.jsx)("h1",{className:"text-2xl font-semibold",children:"Purchase Returns List "}),(0,p.jsx)("span",{className:"text-gray-500 text-sm/6",children:"View/Search Purchase"})]}),(0,p.jsxs)("div",{className:"flex items-center space-x-2 text-blue-600",children:[(0,p.jsxs)(i.N_,{to:"/dashboard",className:"flex items-center text-gray-500 no-underline hover:text-cyan-600 text-sm/6",children:[(0,p.jsx)(c.$BV,{className:"mr-2 text-gray-500 hover:text-cyan-600"})," Home"]}),(0,p.jsx)("span",{className:"text-gray-400",children:">"}),(0,p.jsx)(i.N_,{to:"/purchasereturn-list",className:"text-gray-500 no-underline hover:text-cyan-600 text-sm/6",children:"Purchase Returns List"})]})]}),(0,p.jsx)("div",{className:"flex flex-col gap-4",children:(0,p.jsxs)("div",{className:"grid grid-cols-1 gap-4 lg:grid-cols-2",children:[(0,p.jsxs)("div",{className:"flex items-center text-black bg-white rounded-lg shadow-md ",children:[(0,p.jsx)(l.A,{className:"w-16 text-white rounded bg-cyan-500"}),(0,p.jsxs)("div",{className:"flex flex-col justify-center ml-4",children:[(0,p.jsx)("h2",{className:"text-xl",children:L}),(0,p.jsx)("p",{children:"Total Invoices"})]})]}),(0,p.jsxs)("div",{className:"flex items-center text-black bg-white rounded-lg shadow-md",children:[(0,p.jsx)(c.Tsk,{className:"w-16 h-16 text-white rounded bg-cyan-500"}),(0,p.jsxs)("div",{className:"flex flex-col justify-center ml-4",children:[(0,p.jsxs)("h2",{className:"text-xl",children:["\u20b9",T]}),(0,p.jsx)("p",{children:"Total Paid Amount"})]})]}),(0,p.jsxs)("div",{className:"flex items-center text-black bg-white rounded-lg shadow-md",children:[(0,p.jsx)(n.g,{icon:d.d0D,className:"w-16 h-16 text-white rounded bg-cyan-500"}),(0,p.jsxs)("div",{className:"flex flex-col justify-center ml-4",children:[(0,p.jsxs)("h2",{className:"text-xl",children:["\u20b9",D]}),(0,p.jsx)("p",{children:"Total Invoices Amount"})]})]}),(0,p.jsxs)("div",{className:"flex items-center text-black bg-white rounded-lg shadow-md",children:[(0,p.jsx)(r.A,{className:"h-16 text-white rounded bg-cyan-500 w-18"}),(0,p.jsxs)("div",{className:"flex flex-col justify-center ml-4",children:[(0,p.jsxs)("h2",{className:"text-xl",children:["\u20b9",D-T]}),(0,p.jsx)("p",{children:"Total Purchase Due"})]})]})]})}),(0,p.jsxs)("div",{className:"flex flex-col items-center justify-between w-full gap-4 mt-3 md:flex-row md:gap-28",children:[(0,p.jsx)("div",{className:"flex w-full px-4 py-2 bg-white border border-gray-300 rounded-md md:w-64",children:(0,p.jsxs)("div",{className:"flex items-center w-full gap-4",children:[(0,p.jsx)(n.g,{icon:o.URI,className:"w-5 h-5 text-red-500"}),(0,p.jsxs)("select",{className:"flex-grow text-gray-700 bg-transparent outline-none cursor-pointer",onChange:e=>j(e.target.value),children:[" ",(0,p.jsx)("option",{value:"all",children:"All Warehouse"}),t.map(((e,s)=>(0,p.jsx)("option",{value:e.value,children:e.label},s)))]})]})}),z("Purchases","Add")&&(0,p.jsxs)("button",{className:"w-full px-2 py-2 text-white transition rounded-md md:w-auto bg-cyan-300 hover:bg-cyan-500",onClick:()=>B("/purchase-return"),children:[(0,p.jsx)("span",{className:"text-xl font-",children:"+ "}),"Create Purchase"]})]}),(0,p.jsxs)("div",{className:"flex flex-col justify-between mt-4 mb-4 space-y-2 md:flex-row md:space-y-0 md:items-center",children:[(0,p.jsxs)("div",{className:"flex items-center px-2 space-x-2",children:[(0,p.jsx)("span",{className:"text-sm",children:"Show"}),(0,p.jsxs)("select",{className:"p-2 text-sm border border-gray-300 rounded-md",value:C,onChange:e=>k(e.target.value),children:[(0,p.jsx)("option",{value:"10",children:"10"}),(0,p.jsx)("option",{value:"20",children:"20"}),(0,p.jsx)("option",{value:"50",children:"50"})]}),(0,p.jsx)("span",{className:"text-sm",children:"Entries"})]}),(0,p.jsxs)("div",{className:"flex flex-col gap-2 md:flex-row",children:[(0,p.jsxs)("div",{className:"flex items-center justify-between flex-1 gap-2 px-2",children:[(0,p.jsx)("button",{className:"px-3 py-2 text-sm text-white bg-cyan-500",children:"Copy"}),(0,p.jsx)("button",{className:"px-3 py-2 text-sm text-white bg-cyan-500",children:"Excel"}),(0,p.jsx)("button",{className:"px-3 py-2 text-sm text-white bg-cyan-500",children:"PDF"}),(0,p.jsx)("button",{className:"px-3 py-2 text-sm text-white bg-cyan-500",children:"Print"}),(0,p.jsx)("button",{className:"px-3 py-2 text-sm text-white bg-cyan-500",children:"CSV"})]}),(0,p.jsx)("input",{type:"text",placeholder:"Search",className:"w-full p-2 text-sm border border-gray-300 rounded-sm ",onChange:e=>v(e.target.value)})]})]}),(0,p.jsx)("div",{className:"mt-6 overflow-x-auto",children:(0,p.jsxs)("table",{className:"min-w-full bg-white border border-gray-300 shadow-sm",children:[(0,p.jsx)("thead",{className:"bg-gray-200",children:(0,p.jsx)("tr",{children:["Date","Purchase Code","Return Status","Reference No.","Supplier Name","Total","Paid Payment","Payment Status","Created by","Action"].map((e=>(0,p.jsx)("th",{className:"px-4 py-2 font-medium text-left border",children:e},e)))})}),(0,p.jsx)("tbody",{children:("all"!==g&&g?H.filter((e=>{var s;return(null===(s=e.warehouse)||void 0===s?void 0:s._id)===g})):H).length>0?("all"!==g&&g?H.filter((e=>{var s;return(null===(s=e.warehouse)||void 0===s?void 0:s._id)===g})):H).map((e=>{var t,a,l;return(0,p.jsxs)("tr",{className:"font-bold bg-gray-100",children:[(0,p.jsx)("td",{className:"px-4 py-2 font-medium text-left border",children:new Date(e.purchaseDate).toLocaleDateString()}),(0,p.jsx)("td",{className:"px-4 py-2 font-medium text-left border",children:e.purchaseCode||"No purchaseCode found"}),(0,p.jsx)("td",{className:"px-4 py-2 font-medium text-left border",children:e.status}),(0,p.jsx)("td",{className:"px-4 py-2 font-medium text-left border",children:e.referenceNo}),(0,p.jsx)("td",{className:"px-4 py-2 font-medium text-left border",children:null!==(t=e.supplier)&&void 0!==t&&t.email?e.supplier.email:"No supplier"}),(0,p.jsx)("td",{className:"px-4 py-2 font-medium text-left border",children:e.grandTotal}),(0,p.jsx)("td",{className:"px-4 py-2 font-medium text-left border",children:(null===(a=e.payments)||void 0===a?void 0:a.length)>0?`${e.payments[0].amount.toFixed(2)}`:0}),(0,p.jsx)("td",{className:"px-4 py-2 font-medium text-left border",children:(null===(l=e.payments)||void 0===l?void 0:l.length)>0?`${e.payments[0].paymentNote}`:"No Status"}),(0,p.jsx)("td",{className:"px-4 py-2 font-medium text-left border",children:e.creatorName||e.createdByModel}),(0,p.jsxs)("td",{className:"relative px-4 py-2 border",children:[(0,p.jsx)("button",{onClick:()=>{F(R===e._id?null:e._id)},className:"px-3 py-1 text-white transition rounded bg-cyan-600 hover:bg-cyan-700",children:"Action \u25bc"}),R===e._id&&(0,p.jsx)("div",{className:"absolute right-0 z-50 mt-2 bg-white border border-gray-200 rounded-md shadow-lg w-36 animate-fade-in",children:z("Purchases","Delete")&&(0,p.jsxs)("button",{className:"flex items-center w-full px-3 py-2 text-red-600 hover:bg-gray-100",onClick:()=>(async e=>{if(window.confirm("Do you want to delete this supplier?")){s(!0);try{if(!(await fetch(`api/purchases/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}})).ok)throw new Error("Failed to delete supplier");console.log("Purchase deleted successfully!"),V()}catch(t){console.error("Error deleting purchase:",t.message)}finally{s(!1)}}})(e._id),children:[(0,p.jsx)(c.qbC,{className:"mr-2"})," Delete"]})})]})]},e._id)})):(0,p.jsx)("tr",{children:(0,p.jsx)("td",{colSpan:"10",className:"py-4 font-semibold text-center border",children:"No Data Available"})})})]})}),(0,p.jsxs)("div",{className:"flex items-center justify-between mt-6 text-gray-700",children:[(0,p.jsxs)("span",{children:["Showing 1 to ",H.length," of ",C," entries"]}),(0,p.jsxs)("div",{className:"flex gap-2",children:[(0,p.jsx)("button",{className:"px-4 py-2 border border-gray-300 rounded hover:bg-gray-100",onClick:()=>U(w-1),disabled:1===w,children:"Previous"}),[...Array(J)].map(((e,s)=>(0,p.jsx)("button",{onClick:()=>U(s+1),className:w===s+1?"active":"",children:s+1},s))),(0,p.jsx)("button",{className:"px-4 py-2 border border-gray-300 rounded hover:bg-gray-100",onClick:()=>U(w+1),disabled:w===J,children:"Next"})]})]})]})]})]})}}}]);
//# sourceMappingURL=9905.c093dbc3.chunk.js.map