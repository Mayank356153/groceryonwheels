"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[3734],{13734:(e,t,s)=>{s.r(t),s.d(t,{default:()=>x});var a=s(65043),r=s(49804),n=s(60184),l=s(37762),o=s(64857),i=s(11238),c=s(21197),d=s(59255),m=s(86213),u=s(70579);const h="api",x=()=>{const[e,t]=(0,a.useState)("2025-05-01"),[s,x]=(0,a.useState)("2025-05-14"),[f,p]=(0,a.useState)(""),[b,w]=(0,a.useState)(""),[v,g]=(0,a.useState)(10),[j,N]=(0,a.useState)(window.innerWidth>=768),[y,$]=(0,a.useState)(0),[S,A]=(0,a.useState)([]),[k,C]=(0,a.useState)(""),[I,E]=(0,a.useState)(1),[_,D]=(0,a.useState)([]),[M,L]=(0,a.useState)([]),[W,R]=(0,a.useState)({}),[P,U]=(0,a.useState)(!1),[q,B]=(0,a.useState)(""),F=localStorage.getItem("storeId")||"",z=localStorage.getItem("token")||"";m.A.defaults.headers.common={Authorization:`Bearer ${z}`},(0,a.useEffect)((()=>{const e=()=>N(window.innerWidth>=768);return window.addEventListener("resize",e),e(),()=>window.removeEventListener("resize",e)}),[]),(0,a.useEffect)((()=>{F?(U(!0),Promise.all([m.A.get(`${h}/accounts`),m.A.get(`${h}/warehouses`)]).then((e=>{let[t,s]=e;const a=(s.data.data||[]).filter((e=>e.store===F));D(a);const r={};a.forEach((e=>{r[e._id]=e}));const n=(t.data.data||[]).map((e=>m.A.get(`${h}/by-cash-account/${e._id}`).then((t=>{const s=t.data.warehouseId,a=r[s];return a&&a.store===F?(R((t=>({...t,[e._id]:{warehouseId:s,warehouseName:a.warehouseName}}))),e):null})).catch((t=>(console.error(`Error fetching by-cash-account for account ${e._id}:`,t.message),null)))));Promise.all(n).then((e=>{const t=e.filter((e=>e));L(t),0===t.length&&B("No accounts found for warehouses in the current store.")}))})).catch((e=>{var t,s;console.error("Error fetching data:",e),B((null===(t=e.response)||void 0===t||null===(s=t.data)||void 0===s?void 0:s.message)||"Failed to fetch accounts or warehouses.")})).finally((()=>U(!1)))):B("No store ID found. Please log in again.")}),[F]);(0,a.useEffect)((()=>{(async()=>{try{const t=await m.A.get(`${h}/cash-sale-details`,{headers:{Authorization:`Bearer ${z}`},params:{start:e,end:s,...f&&{warehouseId:f},...b&&{accountId:b}}});A(t.data.data||[])}catch(t){console.error("Error fetching cash sales:",t.message),alert("Failed to fetch cash sales")}})()}),[e,s,f,b]);const O=S.filter((e=>{var t,s,a,r,n;const l=k.toLowerCase();return((null===(t=e.warehouse)||void 0===t||null===(s=t.name)||void 0===s?void 0:s.toLowerCase())||"").includes(l)||((null===(a=e.account)||void 0===a||null===(r=a.name)||void 0===r?void 0:r.toLowerCase())||"").includes(l)||((null===(n=e.referenceId)||void 0===n?void 0:n.toLowerCase())||"").includes(l)}));(0,a.useEffect)((()=>{const e=O.reduce(((e,t)=>e+(t.amount||0)),0);$(e)}),[O]);const V=Math.ceil(O.length/v),T=O.slice((I-1)*v,I*v),H=e=>{e>=1&&e<=V&&E(e)};return P?(0,u.jsx)("div",{children:"Loading..."}):q?(0,u.jsx)("p",{className:"text-red-500 p-4",children:q}):(0,u.jsxs)("div",{className:"flex flex-col h-screen",children:[(0,u.jsx)(c.A,{isSidebarOpen:j,setSidebarOpen:N}),(0,u.jsxs)("div",{className:"flex flex-grow",children:[(0,u.jsx)("div",{className:"w-auto",children:(0,u.jsx)(d.A,{isSidebarOpen:j})}),(0,u.jsxs)("div",{className:"overflow-x-auto flex flex-col p-2 md:p-2 min-h-screen w-full",children:[(0,u.jsxs)("header",{className:"flex flex-col items-center justify-between px-2 py-2 mb-2 bg-gray-100 rounded-md shadow sm:flex-row",children:[(0,u.jsxs)("div",{className:"flex items-baseline gap-1 text-center sm:flex-row sm:text-left",children:[(0,u.jsx)("h1",{className:"text-lg font-semibold truncate sm:text-xl",children:"Cash Sales"}),(0,u.jsx)("span",{className:"text-xs text-gray-600 sm:text-sm",children:"View/Search Cash Sales"})]}),(0,u.jsxs)("nav",{className:"flex flex-wrap items-center justify-center mt-2 text-xs text-gray-500 sm:justify-start sm:text-sm sm:mt-0",children:[(0,u.jsxs)("a",{href:"#",className:"flex items-center text-gray-700 no-underline hover:text-cyan-600",children:[(0,u.jsx)(n.$BV,{className:"mr-2 text-gray-500 hover:text-cyan-600"})," Home"]}),(0,u.jsx)(r.XWt,{className:"mx-1 sm:mx-2"}),(0,u.jsx)("a",{href:"#",className:"text-gray-700 no-underline hover:text-cyan-600",children:"Cash Sales"})]})]}),(0,u.jsx)("div",{className:"flex-col items-start p-4 border-t-4 rounded-lg md:flex-row md:items-center border-cyan-500",children:(0,u.jsxs)("div",{className:"flex flex-wrap justify-start space-y-2 md:space-x-4 md:space-y-0",children:[(0,u.jsxs)("div",{className:"flex flex-col",children:[(0,u.jsx)("label",{className:"text-sm font-bold text-gray-700",children:"Start Date"}),(0,u.jsx)("input",{type:"date",value:e,onChange:e=>t(e.target.value),className:"w-64 p-2 border"})]}),(0,u.jsxs)("div",{className:"flex flex-col",children:[(0,u.jsx)("label",{className:"text-sm font-bold text-gray-700",children:"End Date"}),(0,u.jsx)("input",{type:"date",value:s,onChange:e=>x(e.target.value),className:"w-64 p-2 border"})]}),(0,u.jsxs)("div",{className:"flex flex-col",children:[(0,u.jsx)("label",{className:"text-sm font-bold text-gray-700",children:"Warehouse"}),(0,u.jsxs)("select",{value:f,onChange:e=>p(e.target.value),className:"w-64 p-2 border",children:[(0,u.jsx)("option",{value:"",children:"All Warehouses"}),_.map((e=>(0,u.jsx)("option",{value:e._id,children:e.warehouseName},e._id)))]})]})]})}),(0,u.jsxs)("div",{className:"flex flex-col items-center justify-between mt-4 lg:flex-row",children:[(0,u.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,u.jsx)("label",{className:"text-sm",children:"Show"}),(0,u.jsxs)("select",{value:v,onChange:e=>{g(parseInt(e.target.value)),E(1)},className:"p-2 border",children:[(0,u.jsx)("option",{value:10,children:"10"}),(0,u.jsx)("option",{value:25,children:"25"}),(0,u.jsx)("option",{value:50,children:"50"}),(0,u.jsx)("option",{value:100,children:"100"})]}),(0,u.jsx)("label",{className:"text",children:"Entries"})]}),(0,u.jsxs)("div",{className:"flex items-center space-x-0.5 mt-2 lg:mt-0 w-full",children:[(0,u.jsx)("button",{onClick:()=>{const e=O.map((e=>{var t,s,a;const r=null!==(t=e.items)&&void 0!==t&&t.length?e.items.map((e=>`${e.itemName||"Unknown"} (${e.quantity||0})`)).join(", "):"No items";return`${e.date},${e.amount},${(null===(s=e.warehouse)||void 0===s?void 0:s.name)||"N/A"},${(null===(a=e.account)||void 0===a?void 0:a.name)||"N/A"},${r},${e.referenceId},${e.refModel}`})).join("\n");navigator.clipboard.writeText(e),alert("Data copied to clipboard")},className:"w-full px-3 py-2 text-sm text-white transition bg-cyan-500 hover:bg-cyan-600",children:"Copy"}),(0,u.jsx)("button",{onClick:()=>{const e=O.map((e=>{var t,s,a;return{Date:e.date,Amount:e.amount,Warehouse:(null===(t=e.warehouse)||void 0===t?void 0:t.name)||"N/A",Account:(null===(s=e.account)||void 0===s?void 0:s.name)||"N/A",Items:null!==(a=e.items)&&void 0!==a&&a.length?e.items.map((e=>`${e.itemName||"Unknown"} (${e.quantity||0})`)).join(", "):"No items","Reference ID":e.referenceId,"Reference Model":e.refModel}})),t=i.utils.json_to_sheet(e),s=i.utils.book_new();i.utils.book_append_sheet(s,t,"CashSales"),i.writeFile(s,"cash_sales.xlsx")},className:"w-full px-3 py-2 text-sm text-white transition bg-cyan-500 hover:bg-cyan-600",children:"Excel"}),(0,u.jsx)("button",{onClick:()=>{const e=new l.uE;e.text("Cash Sales List",14,16);const t=O.map((e=>{var t,s,a;return[e.date,e.amount,(null===(t=e.warehouse)||void 0===t?void 0:t.name)||"N/A",(null===(s=e.account)||void 0===s?void 0:s.name)||"N/A",null!==(a=e.items)&&void 0!==a&&a.length?e.items.map((e=>`${e.itemName||"Unknown"} (${e.quantity||0})`)).join(", "):"No items",e.referenceId,e.refModel]}));(0,o.Ay)(e,{head:[["Date","Amount","Warehouse","Account","Items","Reference ID","Reference Model"]],body:t}),e.save("cash_sales.pdf")},className:"w-full px-3 py-2 text-sm text-white transition bg-cyan-500 hover:bg-cyan-600",children:"PDF"}),(0,u.jsx)("button",{onClick:()=>{window.print()},className:"w-full px-3 py-2 text-sm text-white transition bg-cyan-500 hover:bg-cyan-600",children:"Print"}),(0,u.jsx)("button",{onClick:()=>{const e="data:text/csv;charset=utf-8,Date,Amount,Warehouse,Account,Items,Reference ID,Reference Model\n"+O.map((e=>{var t,s,a;const r=null!==(t=e.items)&&void 0!==t&&t.length?e.items.map((e=>`${e.itemName||"Unknown"} (${e.quantity||0})`)).join("; "):"No items";return`${e.date},${e.amount},${(null===(s=e.warehouse)||void 0===s?void 0:s.name)||"N/A"},${(null===(a=e.account)||void 0===a?void 0:a.name)||"N/A"},${r},${e.referenceId},${e.refModel}`})).join("\n"),t=encodeURI(e),s=document.createElement("a");s.setAttribute("href",t),s.setAttribute("download","cash_sales.csv"),document.body.appendChild(s),s.click(),document.body.removeChild(s)},className:"w-full px-3 py-2 text-sm text-white transition bg-cyan-500 hover:bg-cyan-600",children:"CSV"})]})]}),(0,u.jsx)("div",{className:"overflow-x-auto",children:(0,u.jsxs)("table",{className:"min-w-full mt-4 border border-collapse border-gray-300",children:[(0,u.jsx)("thead",{className:"bg-gray-200",children:(0,u.jsxs)("tr",{className:"text-sm md:text-base",children:[(0,u.jsx)("th",{className:"p-2 border border-gray-300 whitespace-nowrap",children:"Date"}),(0,u.jsx)("th",{className:"p-2 border border-gray-300 whitespace-nowrap",children:"Amount"}),(0,u.jsx)("th",{className:"p-2 border border-gray-300 whitespace-nowrap",children:"Warehouse"}),(0,u.jsx)("th",{className:"p-2 border border-gray-300 whitespace-nowrap",children:"Items"}),(0,u.jsx)("th",{className:"p-2 border border-gray-300 whitespace-nowrap",children:"Reference ID"}),(0,u.jsx)("th",{className:"p-2 border border-gray-300 whitespace-nowrap",children:"Reference Model"})]})}),(0,u.jsx)("tbody",{children:0===T.length?(0,u.jsx)("tr",{children:(0,u.jsx)("td",{colSpan:"7",className:"p-4 text-center",children:"No data available"})}):T.map((e=>{var t,s;return(0,u.jsxs)("tr",{className:"text-sm md:text-base",children:[(0,u.jsx)("td",{className:"p-2 border border-gray-300",children:e.date}),(0,u.jsx)("td",{className:"p-2 border border-gray-300",children:e.amount}),(0,u.jsx)("td",{className:"p-2 border border-gray-300",children:(null===(t=e.warehouse)||void 0===t?void 0:t.name)||"N/A"}),(0,u.jsx)("td",{className:"p-2 border border-gray-300",children:null!==(s=e.items)&&void 0!==s&&s.length?e.items.map((e=>`${e.itemName||"Unknown"} (${e.quantity||0})`)).join(", "):"No items"}),(0,u.jsx)("td",{className:"p-2 border border-gray-300",children:e.referenceId}),(0,u.jsx)("td",{className:"p-2 border border-gray-300",children:e.refModel})]},e.referenceId)}))})]})}),(0,u.jsxs)("div",{className:"mt-4 text-sm font-semibold",children:["Total Amount: ",y.toFixed(2)]}),(0,u.jsxs)("div",{className:"flex flex-col items-start justify-between gap-2 p-2 md:justify-between md:flex-row",children:[(0,u.jsxs)("span",{children:["Showing ",v*(I-1)+1," to"," ",Math.min(v*I,O.length)," of ",O.length," entries"]}),(0,u.jsxs)("div",{className:"flex justify-between w-full md:w-auto md:gap-2",children:[(0,u.jsxs)("button",{className:"flex items-center gap-2 px-4 py-2 text-sm font-semibold rounded-lg transition-all duration-200 shadow-md \n                  "+(1===I?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-500 hover:bg-blue-600 text-white cursor-pointer"),onClick:()=>H(I-1),disabled:1===I,children:[(0,u.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",strokeWidth:2,viewBox:"0 0 24 24",children:(0,u.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})}),"Previous"]}),(0,u.jsxs)("button",{className:"flex items-center gap-2 px-4 py-2 text-sm font-semibold rounded-lg transition-all duration-200 shadow-md \n                  "+(I===V?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-500 hover:bg-blue-600 text-white cursor-pointer"),onClick:()=>H(I+1),disabled:I===V,children:["Next",(0,u.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",strokeWidth:2,viewBox:"0 0 24 24",children:(0,u.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})]})]})]})]})]})]})}}}]);
//# sourceMappingURL=3734.8c6d8cda.chunk.js.map