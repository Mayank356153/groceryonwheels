"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[8163],{14840:(e,t,s)=>{s.d(t,{A:()=>r});var a=s(65043),i=s(21197),o=s(59255),l=s(70579);function r(){const[e,t]=(0,a.useState)(!1);return(0,l.jsxs)("div",{className:"flex flex-col h-screen",children:[(0,l.jsx)(i.A,{isSidebarOpen:e,setSidebarOpen:t}),(0,l.jsxs)("div",{className:"flex flex-grow mt-20",children:[(0,l.jsx)("div",{children:(0,l.jsx)(o.A,{isSidebarOpen:e})}),(0,l.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-white/80 backdrop-blur-sm",children:(0,l.jsxs)("div",{className:"flex flex-col items-center",children:[(0,l.jsx)("div",{className:"w-12 h-12 border-4 rounded-full border-cyan-500 border-t-transparent animate-spin"}),(0,l.jsx)("p",{className:"mt-3 text-lg font-semibold text-gray-700",children:"Loading..."})]})})]})]})}},34656:(e,t,s)=>{t.L=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{positionOptions:t={enableHighAccuracy:!0,maximumAge:0,timeout:1/0},isOptimisticGeolocationEnabled:s=!0,userDecisionTimeout:i,suppressLocationOnMount:o=!1,watchPosition:l=!1,geolocationProvider:r=("undefined"!==typeof navigator?navigator.geolocation:void 0),watchLocationPermissionChange:n=!1,onError:c,onSuccess:d}=e,u=(0,a.useRef)(0),x=(0,a.useRef)(!0),h=(0,a.useRef)(0),[m,p]=(0,a.useState)(s),[g,f]=(0,a.useState)(),[v,j]=(0,a.useState)(),[y,b]=(0,a.useState)(),[w,N]=(0,a.useState)(),S=(0,a.useCallback)((()=>{u.current&&window.clearTimeout(u.current)}),[]),A=(0,a.useCallback)((e=>{S(),x.current&&(f((()=>{})),p(!1),b(e)),null===c||void 0===c||c(e)}),[c,S]),C=(0,a.useCallback)((e=>{S(),x.current&&(f(e.coords),j(e.timestamp),p(!0),b((()=>{}))),null===d||void 0===d||d(e)}),[d,S]),k=(0,a.useCallback)((()=>{if(!r||!r.getCurrentPosition||!r.watchPosition)throw new Error("The provided geolocation provider is invalid");i&&(u.current=window.setTimeout((()=>{A()}),i)),l?h.current=r.watchPosition(C,A,t):r.getCurrentPosition(C,A,t)}),[r,l,i,A,C,t]);return(0,a.useEffect)((()=>{let e;return n&&r&&"permissions"in navigator&&navigator.permissions.query({name:"geolocation"}).then((t=>{e=t,e.onchange=()=>{N(e.state)}})).catch((e=>{console.error("Error updating the permissions",e)})),()=>{e&&(e.onchange=null)}}),[]),(0,a.useEffect)((()=>(o||k(),()=>{S(),l&&h.current&&(null===r||void 0===r||r.clearWatch(h.current))})),[w]),{getPosition:k,coords:g,timestamp:v,isGeolocationEnabled:m,isGeolocationAvailable:Boolean(r),positionError:y}};const a=s(65043)},98163:(e,t,s)=>{s.r(t),s.d(t,{default:()=>h});var a=s(65043),i=s(66727),o=s(49804),l=s(60184),r=s(34656),n=s(86213),c=(s(37762),s(64857),s(21197)),d=s(59255),u=s(14840),x=s(70579);const h=()=>{const e=(0,i.Zp)(),[t,s]=(0,a.useState)(window.innerWidth>=768),[h,m]=(0,a.useState)(!1),[p,g]=(0,a.useState)([]),[f,v]=(0,a.useState)([]),[j,y]=(0,a.useState)({}),[b,w]=(0,a.useState)(""),[N,S]=(0,a.useState)(10),[A,C]=(0,a.useState)(1),[k,E]=(0,a.useState)([]);(0,a.useEffect)((()=>{const e=localStorage.getItem("permissions");if(e)try{E(JSON.parse(e))}catch{}}),[]);const I=(e,t)=>"admin"===(localStorage.getItem("role")||"guest").toLowerCase()||k.some((s=>s.module.toLowerCase()===e.toLowerCase()&&s.actions.map((e=>e.toLowerCase())).includes(t.toLowerCase())));(0,a.useEffect)((()=>{window.innerWidth<768&&s(!1)}),[]);const{coords:L,isGeolocationAvailable:W,isGeolocationEnabled:_,positionError:O}=(0,r.L)({positionOptions:{enableHighAccuracy:!0,timeout:1e4,maximumAge:0},watchPosition:!0,userDecisionTimeout:5e3}),[P,$]=(0,a.useState)(null),[z,T]=(0,a.useState)(null),R=async()=>{m(!0);try{const{data:e}=await n.A.get("api/warehouses",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});g(e.data||[])}catch(e){alert(e.message)}finally{m(!1)}};(0,a.useEffect)((()=>{R(),(async()=>{try{const{data:e}=await n.A.get("api/items/summary",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});v(e.data||[])}catch{}})()}),[]),(0,a.useEffect)((()=>{L&&console.log("\ud83d\udccd My position:",L.latitude,L.longitude,"| accuracy (m):",L.accuracy)}),[L]),(0,a.useEffect)((()=>{const e={};f.forEach((t=>{var s;const a=null===(s=t.warehouse)||void 0===s?void 0:s._id;a&&(e[a]||(e[a]={totalItems:0,totalQuantity:0,totalWorth:0}),e[a].totalItems+=1,e[a].totalQuantity+=t.openingStock,e[a].totalWorth+=t.openingStock*t.mrp)})),y(e)}),[f]);const B=p.filter((e=>e.warehouseName.toLowerCase().includes(b.toLowerCase())||(e.mobile||"").toLowerCase().includes(b.toLowerCase())||(e.email||"").toLowerCase().includes(b.toLowerCase()))),M=Math.ceil(B.length/N),G=B.slice((A-1)*N,A*N),[D,q]=(0,a.useState)(null),Q=(localStorage.getItem("role")||"guest").toLowerCase();const H=e=>{if("admin"===Q)!async function(e){if(window.confirm("Permanently delete this warehouse?")){m(!0);try{await n.A.delete(`api/warehouses/${e}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),R()}catch(a){var t,s;alert((null===(t=a.response)||void 0===t||null===(s=t.data)||void 0===s?void 0:s.message)||a.message)}finally{m(!1)}}}(e);else{const t=window.prompt("Reason for deletion:");if(!t)return;n.A.post("api/deletion-requests",{itemType:"Warehouse",itemId:e,reason:t},{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}).then((()=>alert("Request sent"))).catch((e=>alert(e.message)))}};return h?(0,x.jsx)(u.A,{}):(0,x.jsxs)("div",{className:"flex flex-col h-screen",children:[(0,x.jsx)(c.A,{isSidebarOpen:t,setSidebarOpen:s}),(0,x.jsxs)("div",{className:"flex flex-grow",children:[(0,x.jsx)(d.A,{isSidebarOpen:t}),(0,x.jsxs)("main",{className:"flex-grow p-2 overflow-x-auto",children:[(0,x.jsxs)("header",{className:"flex justify-between bg-white p-3 rounded shadow",children:[(0,x.jsxs)("div",{children:[(0,x.jsx)("h1",{className:"text-lg font-bold",children:"Warehouse List"}),(0,x.jsx)("p",{className:"text-xs text-gray-600",children:"Manage Warehouses"})]}),(0,x.jsxs)("nav",{className:"flex items-center text-gray-500 text-sm",children:[(0,x.jsxs)("a",{href:"/dashboard",className:"flex items-center",children:[(0,x.jsx)(l.$BV,{className:"mr-1"})," Home"]}),(0,x.jsx)(o.XWt,{className:"mx-2"}),(0,x.jsx)("span",{children:"Warehouse List"})]})]}),(0,x.jsx)("div",{className:"flex flex-col gap-2 my-4 lg:flex-row lg:items-center",children:I("Warehouses","Add")&&(0,x.jsx)(i.N_,{to:"/warehouse-form",className:"ml-auto",children:(0,x.jsxs)("button",{className:"flex items-center gap-1 bg-cyan-500 hover:bg-cyan-600 text-white px-3 py-2 rounded",children:[(0,x.jsx)(l.OiG,{})," Add Warehouse"]})})}),(0,x.jsx)("div",{className:"overflow-x-auto",children:(0,x.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,x.jsx)("thead",{className:"bg-gray-100 text-xs font-semibold",children:(0,x.jsxs)("tr",{children:[(0,x.jsx)("th",{className:"px-3 py-2",children:"Report"}),(0,x.jsx)("th",{className:"px-3 py-2",children:"Track"}),(0,x.jsx)("th",{className:"px-3 py-2",children:"#"}),(0,x.jsx)("th",{className:"px-3 py-2",children:"Warehouse"}),(0,x.jsx)("th",{className:"px-3 py-2",children:"Mobile"}),(0,x.jsx)("th",{className:"px-3 py-2",children:"Email"}),(0,x.jsx)("th",{className:"px-3 py-2",children:"Cash A/c No."}),(0,x.jsx)("th",{className:"px-3 py-2",children:"TID"}),(0,x.jsx)("th",{className:"px-3 py-2",children:"Details"}),(0,x.jsx)("th",{className:"px-3 py-2",children:"Status"}),(0,x.jsx)("th",{className:"px-3 py-2 text-right",children:"Action"})]})}),(0,x.jsxs)("tbody",{className:"divide-y divide-gray-200 text-sm",children:[G.map(((t,s)=>{var a,i,o,r,c;const d=t.isRestricted;return(0,x.jsxs)("tr",{children:[(0,x.jsxs)("td",{className:"px-3 py-2",children:[(0,x.jsx)("button",{onClick:()=>(e=>{if(P===e)return clearInterval(z),$(null),void T(null);if(!L)return void alert("Waiting for geolocation\u2026");$(e);const t=()=>{n.A.post("/api/warehouse-location",{lat:L.latitude,lng:L.longitude,warehouseId:e},{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}).catch(console.error)};t();const s=setInterval(t,1e4);T(s)})(t._id),className:"px-2 py-1 rounded text-white "+(P===t._id?"bg-red-500":"bg-green-500"),children:P===t._id?"Stop":"Report"}),!W&&(0,x.jsx)("div",{className:"text-xs text-red-500",children:"Geo unavailable"}),O&&(0,x.jsx)("div",{className:"text-xs text-red-500",children:O.message})]}),(0,x.jsx)("td",{className:"px-3 py-2",children:(0,x.jsx)("button",{onClick:()=>{return s=t._id,void e(`/warehouse-tracker?id=${s}`);var s},className:"px-2 py-1 bg-blue-500 text-white rounded text-xs",children:"Track"})}),(0,x.jsx)("td",{className:"px-3 py-2",children:(A-1)*N+s+1}),(0,x.jsx)("td",{className:"px-3 py-2",children:t.warehouseName}),(0,x.jsx)("td",{className:"px-3 py-2",children:t.mobile}),(0,x.jsx)("td",{className:"px-3 py-2",children:t.email}),(0,x.jsx)("td",{className:"px-3 py-2",children:(null===(a=t.cashAccount)||void 0===a?void 0:a.accountNumber)||"\u2014"}),(0,x.jsx)("td",{className:"px-3 py-2",children:(null===(i=t.terminal)||void 0===i?void 0:i.tid)||t.tid||"\u2014"}),(0,x.jsxs)("td",{className:"px-3 py-2",children:[(0,x.jsxs)("div",{children:["Total Items: ",(null===(o=j[t._id])||void 0===o?void 0:o.totalItems)||0]}),(0,x.jsxs)("div",{children:["Quantity: ",(null===(r=j[t._id])||void 0===r?void 0:r.totalQuantity)||0]}),(0,x.jsxs)("div",{children:["Worth \u20b9: ",(null===(c=j[t._id])||void 0===c?void 0:c.totalWorth)||0]})]}),(0,x.jsx)("td",{className:"px-3 py-2",children:d?(0,x.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-semibold bg-yellow-100 text-yellow-800",children:"Restricted"}):(0,x.jsx)("span",{onClick:()=>(async(e,t)=>{m(!0);try{await n.A.put(`/api/warehouses/${e}`,{status:"Active"===t?"Inactive":"Active"},{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),R()}catch(i){var s,a;alert((null===(s=i.response)||void 0===s||null===(a=s.data)||void 0===a?void 0:a.message)||i.message)}finally{m(!1)}})(t._id,t.status),className:"cursor-pointer px-2 py-1 rounded-full text-xs font-semibold "+("Active"===t.status?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:t.status})}),(0,x.jsxs)("td",{className:"px-3 py-2 text-right relative",children:[(0,x.jsx)("button",{className:"px-3 py-1 border rounded",onClick:()=>q(D===t._id?null:t._id),children:"Action \u25bc"}),D===t._id&&(0,x.jsxs)("div",{className:"absolute right-0 mt-1 bg-white border rounded shadow p-2 flex flex-col gap-1 z-10",children:[!d&&I("Warehouses","Edit")&&(0,x.jsxs)("button",{onClick:()=>e(`/warehouse-form?id=${t._id}`),className:"flex items-center gap-1 bg-blue-500 hover:bg-blue-600 text-white px-2 py-1 rounded text-xs",children:[(0,x.jsx)(l.uO9,{size:14})," Edit"]}),!d&&I("Warehouses","Delete")&&(0,x.jsxs)("button",{onClick:()=>H(t._id),className:"flex items-center gap-1 bg-red-500 hover:bg-red-600 text-white px-2 py-1 rounded text-xs",children:[(0,x.jsx)(l.qbC,{size:14})," Delete"]})]})]})]},t._id)})),0===G.length&&(0,x.jsx)("tr",{children:(0,x.jsx)("td",{colSpan:12,className:"p-4 text-center",children:"No data available"})})]})]})}),(0,x.jsxs)("div",{className:"flex flex-col items-center justify-between gap-2 mt-4 md:flex-row",children:[(0,x.jsxs)("span",{className:"text-sm",children:["Showing ",(A-1)*N+1,"-"," ",Math.min(N*A,B.length)," of ",B.length]}),(0,x.jsxs)("div",{className:"flex gap-2",children:[(0,x.jsx)("button",{onClick:()=>C((e=>Math.max(1,e-1))),disabled:1===A,className:"px-4 py-1 border rounded disabled:opacity-50",children:"Prev"}),(0,x.jsx)("button",{onClick:()=>C((e=>Math.min(M,e+1))),disabled:A===M,className:"px-4 py-1 border rounded disabled:opacity-50",children:"Next"})]})]})]})]})]})}}}]);
//# sourceMappingURL=8163.1181b159.chunk.js.map