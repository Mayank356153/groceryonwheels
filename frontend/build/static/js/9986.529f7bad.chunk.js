"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[9986],{39986:(e,t,s)=>{s.r(t),s.d(t,{default:()=>m});var a=s(65043),r=s(86213),n=s(66727),l=s(60184),o=s(21197),d=s(59255),i=s(70579);const c=r.A.create({baseURL:"/vps/api"});c.interceptors.request.use((e=>{const t=localStorage.getItem("token");return t&&(e.headers.Authorization=`Bearer ${t}`),e}));const u=(e,t,s,a)=>{const r=e=>e*Math.PI/180,n=r(s-e),l=r(a-t),o=Math.sin(n/2)**2+Math.cos(r(e))*Math.cos(r(s))*Math.sin(l/2)**2;return 12742*Math.asin(Math.sqrt(o))};function m(){const[e,t]=(0,a.useState)(!0),[s,r]=(0,a.useState)([]),[m,x]=(0,a.useState)(!1),[h,p]=(0,a.useState)(null),[g,f]=(0,a.useState)({customer:"",street:"",area:"",city:"",state:"",postalCode:""}),[v,b]=(0,a.useState)(!1),[j,N]=(0,a.useState)(5),[y,w]=(0,a.useState)({lat:"",lng:""}),[C,k]=(0,a.useState)((()=>new Set));(0,a.useEffect)((()=>{x(!0),c.get("/addresses/admin/all").then((e=>{r(e.data.data||[]),p(null)})).catch((()=>p("Failed to load addresses"))).finally((()=>x(!1)))}),[]);const S=(e,t)=>e.toLowerCase().includes(t.toLowerCase()),M=(0,a.useMemo)((()=>{const e=v&&y.lat&&y.lng&&!Number.isNaN(parseFloat(y.lat))&&!Number.isNaN(parseFloat(y.lng)),t=parseFloat(y.lat),a=parseFloat(y.lng),r=new Map;for(const d of s){var n,l;const s=(null===(n=d.user)||void 0===n?void 0:n.name)||"Unknown customer",i=(null===(l=d.user)||void 0===l?void 0:l._id)||`unknown-${d._id}`;if((!g.customer||S(s,g.customer))&&((!g.street||S(d.street||"",g.street))&&(!g.area||S(d.area||"",g.area))&&(!g.city||S(d.city||"",g.city))&&(!g.state||S(d.state||"",g.state))&&(!g.postalCode||S(d.postalCode||"",g.postalCode)))){if(e){var o;const e=null===(o=d.location)||void 0===o?void 0:o.coordinates;if(!e)continue;const[s,r]=e;if(u(t,a,r,s)>j)continue}r.has(i)||r.set(i,{name:s,addresses:[]}),r.get(i).addresses.push(d)}}for(const s of r.values())s.addresses.sort(((e,t)=>(t.isDefault?1:0)-(e.isDefault?1:0)));return[...r.entries()]}),[s,g,v,y,j]);return(0,i.jsxs)("div",{className:"flex flex-col h-screen",children:[(0,i.jsx)(o.A,{isSidebarOpen:e,setSidebarOpen:t}),(0,i.jsxs)("div",{className:"flex flex-1",children:[(0,i.jsx)(d.A,{isSidebarOpen:e}),(0,i.jsxs)("main",{className:"flex-1 p-6 bg-gray-100 overflow-auto",children:[(0,i.jsxs)("div",{className:"flex justify-between items-end mb-6",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h1",{className:"text-2xl font-semibold",children:"Customer Addresses"}),(0,i.jsx)("p",{className:"text-sm text-gray-600",children:"Default address shown first. Click row to expand."})]}),(0,i.jsxs)(n.k2,{to:"/dashboard",className:"flex items-center text-gray-700 hover:underline",children:[(0,i.jsx)(l.$BV,{className:"mr-1"}),"Home"]})]}),(0,i.jsxs)("div",{className:"mb-6 flex items-center gap-4 flex-wrap",children:[(0,i.jsxs)("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700",children:[(0,i.jsx)("input",{type:"checkbox",checked:v,onChange:e=>b(e.target.checked)}),"Enable distance filter"]}),v&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("input",{type:"number",step:"any",placeholder:"Latitude",value:y.lat,onChange:e=>w({...y,lat:e.target.value}),className:"p-2 border border-gray-300 rounded w-32"}),(0,i.jsx)("input",{type:"number",step:"any",placeholder:"Longitude",value:y.lng,onChange:e=>w({...y,lng:e.target.value}),className:"p-2 border border-gray-300 rounded w-32"}),(0,i.jsx)("input",{type:"range",min:1,max:5e3,value:j,onChange:e=>N(parseInt(e.target.value)),className:"w-40"}),(0,i.jsxs)("span",{className:"text-sm text-gray-700",children:[j," km"]}),(0,i.jsx)("button",{onClick:()=>{if(!navigator.geolocation)return alert("Geolocation not supported");navigator.geolocation.getCurrentPosition((e=>{w({lat:e.coords.latitude.toFixed(6),lng:e.coords.longitude.toFixed(6)}),b(!0)}),(()=>alert("Unable to get position")))},className:"px-3 py-1 text-sm bg-blue-500 text-white rounded",children:"Use my location"})]})]}),(0,i.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-2 mb-6",children:["customer","street","area","city","state","postalCode"].map((e=>(0,i.jsx)("input",{name:e,placeholder:e,value:g[e],onChange:t=>f((s=>({...s,[e]:t.target.value}))),className:"p-2 border border-gray-300 rounded"},e)))}),h&&(0,i.jsx)("div",{className:"p-3 mb-4 bg-red-100 text-red-700 rounded",children:h}),m&&(0,i.jsx)("div",{children:"Loading\u2026"}),!m&&0===M.length&&!h&&(0,i.jsx)("div",{className:"text-gray-600",children:"No matches."}),!m&&M.length>0&&(0,i.jsx)("div",{className:"space-y-4",children:M.map((e=>{let[t,s]=e;const[a,...r]=s.addresses,n=C.has(t);return(0,i.jsxs)("div",{className:"bg-white rounded shadow divide-y",children:[(0,i.jsxs)("button",{onClick:()=>{return e=t,k((t=>{const s=new Set(t);return s.has(e)?s.delete(e):s.add(e),s}));var e},className:"w-full text-left p-4 flex justify-between hover:bg-gray-50",children:[(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{className:"font-semibold",children:[s.name,a.isDefault&&(0,i.jsx)("span",{className:"ml-2 text-sm text-green-600",children:"(Default)"})]}),(0,i.jsxs)("div",{className:"text-gray-700",children:[a.label," \u2013 ",a.street,a.area&&`, ${a.area}`,", ",a.city,", ",a.state,", ",a.country," \u2014 ",a.postalCode]})]}),r.length>0&&(n?(0,i.jsx)(l.Vr3,{className:"mt-1"}):(0,i.jsx)(l.X6T,{className:"mt-1"}))]}),n&&r.length>0&&(0,i.jsx)("div",{className:"p-4 space-y-2",children:r.map((e=>(0,i.jsxs)("div",{className:"text-gray-700",children:[e.label," \u2013 ",e.street,e.area&&`, ${e.area}`,", ",e.city,", ",e.state,", ",e.country," \u2014 ",e.postalCode]},e._id)))})]},t)}))})]})]})]})}}}]);
//# sourceMappingURL=9986.529f7bad.chunk.js.map