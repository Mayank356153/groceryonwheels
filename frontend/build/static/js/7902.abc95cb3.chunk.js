"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[7902],{14840:(e,t,n)=>{n.d(t,{A:()=>o});var a=n(65043),c=n(21197),r=n(59255),s=n(70579);function o(){const[e,t]=(0,a.useState)(!1);return(0,s.jsxs)("div",{className:"flex flex-col h-screen",children:[(0,s.jsx)(c.A,{isSidebarOpen:e,setSidebarOpen:t}),(0,s.jsxs)("div",{className:"flex flex-grow mt-20",children:[(0,s.jsx)("div",{children:(0,s.jsx)(r.A,{isSidebarOpen:e})}),(0,s.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-white/80 backdrop-blur-sm",children:(0,s.jsxs)("div",{className:"flex flex-col items-center",children:[(0,s.jsx)("div",{className:"w-12 h-12 border-4 rounded-full border-cyan-500 border-t-transparent animate-spin"}),(0,s.jsx)("p",{className:"mt-3 text-lg font-semibold text-gray-700",children:"Loading..."})]})})]})]})}},82284:(e,t,n)=>{function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}n.d(t,{A:()=>a})},91291:(e,t,n)=>{n.r(t),n.d(t,{default:()=>b});var a=n(65043),c=n(49804),r=n(60184),s=n(66727),o=n(26873),l=n(86213),i=n(21197),d=n(59255),u=n(14840),m=n(70579);const b=()=>{var e;const t=(0,s.Zp)(),[n]=(0,s.ok)(),b=n.get("id"),p=(localStorage.getItem("role")||"").toLowerCase(),f=localStorage.getItem("storeId"),[x,h]=(0,a.useState)(window.innerWidth>=768),[g,v]=(0,a.useState)(!1),[N,j]=(0,a.useState)([]),[y,A]=(0,a.useState)([]),[w,S]=(0,a.useState)(null),[k,C]=(0,a.useState)({accountNumber:"",accountName:"",openingBalance:0,note:"",parentAccount:null}),B={Authorization:`Bearer ${localStorage.getItem("token")}`},O=e=>{const[t,n]="string"===typeof e&&e.includes("-")?e.split("-"):["ACC","099"];return`${t}-${String(+n+1).padStart(3,"0")}`};(0,a.useEffect)((()=>{let e=!0;return l.A.get("api/accounts",{headers:B}).then((t=>{var n;if(!e)return;const a=null!==(n=t.data.data)&&void 0!==n?n:[];if(j(a.map((e=>({label:`${e.accountNumber} \u2013 ${e.accountName}`,value:e._id})))),!b){var c;const e=null===(c=a.at(-1))||void 0===c?void 0:c.accountNumber;C((t=>({...t,accountNumber:O(e)})))}})).catch(console.error),()=>{e=!1}}),[b]),(0,a.useEffect)((()=>{if("admin"===p)return;let e=!0;return l.A.get("admin/store/add/store",{headers:B}).then((t=>{var n;return e&&A(null!==(n=t.data.result)&&void 0!==n?n:[])})).catch(console.error),()=>{e=!1}}),[p]),(0,a.useEffect)((()=>{b&&(v(!0),l.A.get(`api/accounts/${b}`,{headers:B}).then((e=>{var t;const n=e.data.data;n&&C({accountNumber:n.accountNumber,accountName:n.accountName,openingBalance:n.openingBalance||0,note:n.note||"",parentAccount:"string"===typeof n.parentAccount?n.parentAccount:null===(t=n.parentAccount)||void 0===t?void 0:t._id})})).catch(console.error).finally((()=>v(!1))))}),[b]),(0,a.useEffect)((()=>{var e;if("admin"===p||b)return;if(!N.length||!y.length)return;const t=y.find((e=>e._id===f));if(!t)return;const n="string"===typeof t.storeAccount?t.storeAccount:null===(e=t.storeAccount)||void 0===e?void 0:e._id;n&&(S(n),C((e=>({...e,parentAccount:n}))))}),[N,y,p,b,f]);const $=e=>{const{name:t,value:n,type:a}=e.target;C((e=>({...e,[t]:"number"===a?Number(n):n})))};if(g)return(0,m.jsx)(u.A,{});const E=(null===(e=N.find((e=>{var t;return e.value===(null!==(t=k.parentAccount)&&void 0!==t?t:w)})))||void 0===e?void 0:e.label)||k.parentAccount||"Loading\u2026",I="admin"!==p&&!k.parentAccount||!k.accountNumber;return(0,m.jsxs)("div",{className:"flex flex-col h-screen",children:[(0,m.jsx)(i.A,{isSidebarOpen:x,setSidebarOpen:h}),(0,m.jsxs)("div",{className:"flex flex-grow",children:[(0,m.jsx)(d.A,{isSidebarOpen:x}),(0,m.jsxs)("main",{className:"flex-grow p-4 overflow-auto bg-gray-100",children:[(0,m.jsxs)("header",{className:"flex justify-between mb-4 bg-white p-4 rounded shadow",children:[(0,m.jsx)("h1",{className:"text-xl font-bold",children:b?"Edit Account":"Add Account"}),(0,m.jsxs)("nav",{className:"flex items-center text-gray-500",children:[(0,m.jsxs)("a",{href:"/dashboard",className:"flex items-center",children:[(0,m.jsx)(r.$BV,{className:"mr-1"})," Home"]}),(0,m.jsx)(c.XWt,{className:"mx-2"}),(0,m.jsx)("a",{href:"/account-list",children:"Accounts List"})]})]}),(0,m.jsxs)("form",{onSubmit:async e=>{e.preventDefault(),v(!0);try{const e={...k};"admin"!==p?delete e.parentAccount:e.parentAccount||delete e.parentAccount,b?(await l.A.put(`api/accounts/${b}`,e,{headers:B}),alert("Account updated!")):(await l.A.post("api/accounts",e,{headers:B}),alert("Account created!")),t("/account-list")}catch(c){var n,a;console.error(c),alert((null===(n=c.response)||void 0===n||null===(a=n.data)||void 0===a?void 0:a.message)||c.message||"Failed to save account")}finally{v(!1)}},className:"bg-white p-6 rounded shadow space-y-4",children:[(0,m.jsxs)("div",{children:[(0,m.jsxs)("label",{className:"block font-semibold mb-1",children:["Parent Account ","admin"!==p&&(0,m.jsx)("span",{className:"text-red-500",children:"*"})]}),"admin"===p?(0,m.jsx)(o.Ay,{options:N,value:N.find((e=>e.value===k.parentAccount))||null,onChange:e=>C((t=>({...t,parentAccount:e?e.value:null}))),placeholder:"(leave blank to create a root account)",isClearable:!0}):(0,m.jsx)("div",{className:"p-2 border rounded bg-gray-100",children:E})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"block font-semibold mb-1",children:"Account Number"}),(0,m.jsx)("input",{className:"w-full p-2 border rounded bg-gray-200",name:"accountNumber",value:k.accountNumber,readOnly:!0})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"block font-semibold mb-1",children:"Account Name"}),(0,m.jsx)("input",{className:"w-full p-2 border rounded",name:"accountName",value:k.accountName,onChange:$,required:!0})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"block font-semibold mb-1",children:"Opening Balance"}),(0,m.jsx)("input",{className:"w-full p-2 border rounded",type:"number",min:0,name:"openingBalance",value:k.openingBalance,onChange:$})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"block font-semibold mb-1",children:"Note"}),(0,m.jsx)("textarea",{className:"w-full p-2 border rounded",name:"note",value:k.note,onChange:$})]}),(0,m.jsxs)("div",{className:"flex justify-center gap-4 pt-4",children:[(0,m.jsx)("button",{type:"submit",disabled:I,className:"px-6 py-2 rounded text-white "+(I?"bg-gray-400 cursor-not-allowed":"bg-green-600 hover:bg-green-700"),children:b?"Update":"Save"}),(0,m.jsx)("button",{type:"button",onClick:()=>t("/account-list"),className:"px-6 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",children:"Cancel"})]})]})]})]})]})}}}]);
//# sourceMappingURL=7902.abc95cb3.chunk.js.map