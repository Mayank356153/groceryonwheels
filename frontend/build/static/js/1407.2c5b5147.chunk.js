(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[1407],{14840:(e,t,a)=>{"use strict";a.d(t,{A:()=>o});var r=a(65043),s=a(21197),n=a(59255),i=a(70579);function o(){const[e,t]=(0,r.useState)(!1);return(0,i.jsxs)("div",{className:"flex flex-col h-screen",children:[(0,i.jsx)(s.A,{isSidebarOpen:e,setSidebarOpen:t}),(0,i.jsxs)("div",{className:"flex flex-grow mt-20",children:[(0,i.jsx)("div",{children:(0,i.jsx)(n.A,{isSidebarOpen:e})}),(0,i.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-white/80 backdrop-blur-sm",children:(0,i.jsxs)("div",{className:"flex flex-col items-center",children:[(0,i.jsx)("div",{className:"w-12 h-12 border-4 rounded-full border-cyan-500 border-t-transparent animate-spin"}),(0,i.jsx)("p",{className:"mt-3 text-lg font-semibold text-gray-700",children:"Loading..."})]})})]})]})}},31108:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>b});var r=a(65043),s=a(49804),n=a(60184),i=a(83910),o=a(97929),l=a(21197),u=a(59255),c=a(14840),d=a(66727),m=a(86213),h=a(26873),p=a(79038),f=a(60446),v=a.n(f),x=a(70579);const g=m.A.create({baseURL:"vps/api"});g.interceptors.request.use((e=>{const t=localStorage.getItem("token");return t&&(e.headers.Authorization=`Bearer ${t}`),e})),g.interceptors.response.use((e=>e),(e=>{var t,a;return 401!==(null===(t=e.response)||void 0===t?void 0:t.status)&&403!==(null===(a=e.response)||void 0===a?void 0:a.status)||(localStorage.removeItem("token"),window.location.href="/"),Promise.reject(e)}));const y=(e,t,a,r,s)=>{s((r=>{const s=[...r];return s[e]={...s[e],[t]:"reason"===t||"expiryDate"===t?a:Number(a)||0,totalAmount:"quantity"===t||"price"===t?(Number("quantity"===t?a:s[e].quantity)||1)*(Number("price"===t?a:s[e].price)||0):s[e].totalAmount},"quantity"===t&&s[e].quantity>s[e].maxQuantity&&(s[e].quantity=s[e].maxQuantity,s[e].totalAmount=s[e].maxQuantity*s[e].price),s}))},b=()=>{var e;const t=(0,d.Zp)(),[a]=(0,d.ok)(),m=a.get("id"),f=(0,r.useRef)(null),b=(0,r.useRef)(null),[N,j]=(0,r.useState)([]);(0,r.useEffect)((()=>{const e=localStorage.getItem("permissions");e&&j(JSON.parse(e))}),[]);const[w,S]=(0,r.useState)(""),[$,C]=(0,r.useState)([]),[D,I]=(0,r.useState)(null),[M,A]=(0,r.useState)(""),[P,_]=(0,r.useState)(""),[O,k]=(0,r.useState)((new Date).toISOString().split("T")[0]),[Y,T]=(0,r.useState)("Return"),[L,R]=(0,r.useState)(""),[q,F]=(0,r.useState)([]),[E,V]=(0,r.useState)([]),[W,H]=(0,r.useState)([]),[B,Q]=(0,r.useState)([]),[U,z]=(0,r.useState)(null),[J,Z]=(0,r.useState)(null),[K,X]=(0,r.useState)(null),[G,ee]=(0,r.useState)(null),[te,ae]=(0,r.useState)([]),[re,se]=(0,r.useState)([]),[ne,ie]=(0,r.useState)([]),[oe,le]=(0,r.useState)(""),[ue,ce]=(0,r.useState)([]),[de,me]=(0,r.useState)(""),[he,pe]=(0,r.useState)(!1),[fe,ve]=(0,r.useState)(0),[xe,ge]=(0,r.useState)(0),[ye,be]=(0,r.useState)(""),[Ne,je]=(0,r.useState)(0),[we,Se]=(0,r.useState)(""),[$e,Ce]=(0,r.useState)(0),[De,Ie]=(0,r.useState)(!1),[Me,Ae]=(0,r.useState)(!1),[Pe,_e]=(0,r.useState)(""),[Oe,ke]=(0,r.useState)(""),[Ye,Te]=(0,r.useState)(0),[Le,Re]=(0,r.useState)("Per%");(0,r.useEffect)((()=>{window.innerWidth<768&&Ae(!1)}),[]),(0,r.useEffect)((()=>{(async()=>{try{Ie(!0);const[e,t,a,r,s]=await Promise.all([g.get("/warehouses"),g.get("/suppliers"),g.get("/payment-types"),g.get("/accounts"),g.get("/purchases?isReturn=true")]),n=(e.data.data||[]).map((e=>{var t;return{label:e.warehouseName,value:e._id,cashAccount:(null===(t=e.cashAccount)||void 0===t?void 0:t._id)||e.cashAccount||null}}));F(n),console.log("Warehouses:",n),V((t.data.data||[]).filter((e=>e.supplierName)).map((e=>({label:e.supplierName,value:e._id})))),H((a.data.data||[]).map((e=>({label:e.paymentTypeName,value:e._id,name:e.paymentTypeName.toLowerCase()}))));const i=(r.data.data||[]).map((e=>({label:e.accountNumber,value:e._id})));Q(i),console.log("Accounts:",i);const o=s.data.data||[];A(o.length?(e=>{if(!e)return`PR/${(new Date).getFullYear()}/01`;const t=e.split("/"),a=parseInt(t[2],10);return`PR/${t[1]}/${String(a+1).padStart(2,"0")}`})(o[o.length-1].purchaseCode):`PR/${(new Date).getFullYear()}/01`)}catch(a){var e,t;console.error("Fetch error:",a),R("Failed to load data: "+((null===(e=a.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||a.message))}finally{Ie(!1)}})()}),[]),(0,r.useEffect)((()=>{(async()=>{if(U)try{Ie(!0);const e=await g.get("/items",{params:{warehouse:U.value}}),t=(e.data.data||[]).map((e=>{var t;const a=Boolean(e.parentItemId);return{_id:e._id,parentId:a?e.parentItemId:e._id,variantId:a?e._id:null,itemName:a?`${e.parentItemName||e.itemName} / ${e.itemName}`:e.itemName,itemCode:e.itemCode||"",barcodes:e.barcodes||[],warehouseId:(null===(t=e.warehouse)||void 0===t?void 0:t._id)||e.warehouse||null,mrp:e.mrp||0,isVariant:a}}));ae(t),console.log("Fetched items for warehouse",U.value,":",t),console.log("Checking for item 68134eff43481c8592016e2f:",t.find((e=>"68134eff43481c8592016e2f"===e._id)))}catch(a){var e,t;console.error("Fetch items error:",a),R("Failed to load items: "+((null===(e=a.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||a.message))}finally{Ie(!1)}else ae([])})()}),[U]),(0,r.useEffect)((()=>{if(!m)return;(async()=>{try{var e,t;Ie(!0);const a=(await g.get(`/purchases/${m}`)).data.data;console.log("Fetched purchase return:",a),I(a),S(a.referenceNo||""),k(a.purchaseDate?v()(a.purchaseDate).format("YYYY-MM-DD"):(new Date).toISOString().split("T")[0]),_(a.referenceNo||""),z(q.find((e=>{var t;return e.value===((null===(t=a.warehouse)||void 0===t?void 0:t._id)||a.warehouse)}))||null),Z(E.find((e=>{var t;return e.value===((null===(t=a.supplier)||void 0===t?void 0:t._id)||a.supplier)}))||null),T(a.status||"Return");const r=a.items||[];console.log("Purchase return items:",r);const s=(null===(e=a.warehouse)||void 0===e?void 0:e._id)||a.warehouse,n=r.map((e=>{var t;const a="object"===typeof e.item?null===(t=e.item)||void 0===t?void 0:t._id:e.item,r=e.variant||null,n=te.find((e=>e._id===a||e.variantId===r||e.parentId===a))||null;if(!n)return console.warn(`No matching item for ID ${a} or variant ${r} in allItems`,{purchaseItem:e,warehouseId:s}),null;const i=e.expiryDate?v()(e.expiryDate).format("YYYY-MM-DD"):"";return{item:n.parentId,variant:n.variantId,itemName:n.itemName,itemCode:n.itemCode,barcode:n.barcodes[0]||"",quantity:e.quantity||1,price:e.purchasePrice||n.mrp||0,maxQuantity:e.quantity||1,reason:e.reason||"",totalAmount:(e.quantity||1)*(e.purchasePrice||n.mrp||0),expiryDate:i,purchasePrice:e.purchasePrice||0,salesPrice:e.salesPrice||0,unitCost:e.unitCost||0,discount:e.discount||0,parentId:n.parentId,isVariant:n.isVariant}})).filter(Boolean);if(console.log("Mapped return items:",n),0===n.length&&r.length>0){te.filter((e=>e.warehouseId===s))}ie(n),ve(a.otherCharges||0),ge(a.discountOnAll||0),be(a.note||""),Ce(a.grandTotal||0),_e(a.couponCode||""),ke(a.couponType||""),Te(a.couponValue||0),Re(a.discountOnAllType||"Per%"),(null===(t=a.payments)||void 0===t?void 0:t.length)>0&&(je(a.payments[0].amount||0),Se(a.payments[0].paymentNote||""),X(W.find((e=>{var t;return e.value===((null===(t=a.payments[0].paymentType)||void 0===t?void 0:t._id)||a.payments[0].paymentType)}))||null),ee(B.find((e=>{var t;return e.value===((null===(t=a.payments[0].account)||void 0===t?void 0:t._id)||a.payments[0].account)}))||null))}catch(s){var a,r;console.error("Fetch purchase return error:",s),R("Failed to load purchase return: "+((null===(a=s.response)||void 0===a||null===(r=a.data)||void 0===r?void 0:r.message)||s.message))}finally{Ie(!1)}})()}),[m,q,E,W,B,te]);const qe=q.find((e=>e.value===(null===U||void 0===U?void 0:U.value))),Fe=null!==qe&&void 0!==qe&&qe.cashAccount?B.filter((e=>e.value===qe.cashAccount)):[],Ee="cash"===(null===(e=W.find((e=>e.value===(null===K||void 0===K?void 0:K.value))))||void 0===e?void 0:e.name);(0,r.useEffect)((()=>{Ee&&Fe.length>0?ee(Fe[0]):Ee&&0===Fe.length?(console.warn("No cash accounts available for warehouse:",qe),R("No cash account available for this warehouse. Please select an account manually or check warehouse data."),ee(null)):ee(null)}),[Ee,Fe,qe]),(0,r.useEffect)((()=>{(async()=>{if(w.trim()&&!m)try{const e=((await g.get("/purchases?isReturn=false")).data.data||[]).filter((e=>{var t;return null===(t=e.referenceNo)||void 0===t?void 0:t.toLowerCase().includes(w.toLowerCase())}));C(e.map((e=>({label:`Purchase: ${e.referenceNo}`,value:e.referenceNo,data:e}))).slice(0,10))}catch(a){var e,t;console.error("Search purchases error:",a),R("Error searching purchases: "+((null===(e=a.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||a.message))}else C([])})()}),[w,m]);(0,r.useEffect)((()=>{if(!U)return se([]),void me("Select a warehouse");if(D){var e;const t=(null===(e=D.warehouse)||void 0===e?void 0:e._id)||D.warehouse,a=D.items.flatMap((e=>{var t;const a="object"===typeof e.item?null===(t=e.item)||void 0===t?void 0:t._id:e.item,r=e.variant||null;return te.filter((e=>e._id===a||e.variantId===r||e.parentId===a))}));se([...new Set(a)]),console.log("Filtered items for warehouse",t,":",a)}else se(te);me("")}),[U,te,D]),(0,r.useEffect)((()=>{const e=oe.trim().toLowerCase();if(!e||!U)return void ce([]);const t=new RegExp(e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"i");ce(re.filter((e=>t.test(e.itemName)||t.test(e.itemCode)||e.barcodes.some((e=>t.test(e))))).slice(0,20))}),[oe,re]);(0,r.useEffect)((()=>()=>{b.current&&b.current.reset()}),[]);const Ve=e=>{if(e)if(ne.some((t=>t.item===e.parentId&&t.variant===e.variantId)))R("Item already added");else{if(D){const t=D.items.find((t=>{var a;const r="object"===typeof t.item?null===(a=t.item)||void 0===a?void 0:a._id:t.item,s=t.variant||null;return e._id===r||e.variantId===s||e.parentId===r}));if(!t)return void R("Item not in original purchase");ie((a=>[...a,{item:e.parentId,variant:e.variantId,itemName:e.itemName,itemCode:e.itemCode,barcode:e.barcodes[0]||"",quantity:1,price:t.purchasePrice||e.mrp||0,maxQuantity:t.quantity||1,reason:"",totalAmount:1*(t.purchasePrice||e.mrp||0),expiryDate:t.expiryDate?v()(t.expiryDate).format("YYYY-MM-DD"):"",purchasePrice:t.purchasePrice||0,salesPrice:t.salesPrice||0,unitCost:t.unitCost||0,discount:t.discount||0,parentId:e.parentId,isVariant:e.isVariant}]))}else ie((t=>[...t,{item:e.parentId,variant:e.variantId,itemName:e.itemName,itemCode:e.itemCode,barcode:e.barcodes[0]||"",quantity:1,price:e.mrp||0,maxQuantity:9999,reason:"",totalAmount:1*(e.mrp||0),expiryDate:"",purchasePrice:e.mrp||0,salesPrice:e.salesPrice||0,unitCost:e.priceWithoutTax||0,discount:0,parentId:e.parentId,isVariant:e.isVariant}]));le("")}};(0,r.useEffect)((()=>{let e=Number(xe)||0;if("Per%"===Le){e=ne.reduce(((e,t)=>e+t.totalAmount),0)*e/100}let t=Number(Ye)||0;if("percentage"===Oe){t=ne.reduce(((e,t)=>e+t.totalAmount),0)*t/100}const a=ne.reduce(((e,t)=>e+t.totalAmount),0)+Number(fe||0)-e-t;Ce(Math.max(a,0))}),[ne,fe,xe,Le,Ye,Oe]),(0,r.useEffect)((()=>{m||je($e)}),[$e,m]);return De?(0,x.jsx)(c.A,{}):(0,x.jsxs)("div",{className:"flex flex-col h-screen",children:[(0,x.jsx)(l.A,{isSidebarOpen:Me,setSidebarOpen:Ae}),(0,x.jsxs)("div",{className:"flex flex-grow",children:[(0,x.jsx)(u.A,{isSidebarOpen:Me}),(0,x.jsxs)("div",{className:"flex-grow p-4 overflow-y-auto",children:[(0,x.jsxs)("header",{className:"flex flex-col md:flex-row items-center justify-between mb-4",children:[(0,x.jsx)("h1",{className:"text-xl font-bold",children:"Purchase Return"}),(0,x.jsxs)("nav",{className:"flex items-center space-x-2 text-gray-600",children:[(0,x.jsxs)(d.N_,{to:"/dashboard",className:"hover:text-cyan-600",children:[(0,x.jsx)(n.$BV,{className:"mr-1"})," Home"]}),(0,x.jsx)(s.XWt,{}),(0,x.jsx)(d.N_,{to:"/purchasereturn-list",className:"hover:text-cyan-600",children:"Return List"})]})]}),L&&(0,x.jsx)("div",{className:"mb-4 p-3 bg-red-100 text-red-700 rounded",children:L}),(0,x.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[(0,x.jsxs)("div",{className:"relative",children:[(0,x.jsx)("label",{className:"font-semibold",children:"Original Purchase Ref"}),(0,x.jsx)("input",{type:"text",value:w,onChange:e=>S(e.target.value),className:"w-full p-2 border rounded",disabled:!!m,placeholder:"Enter purchase reference or leave blank"}),$.length>0&&(0,x.jsx)("ul",{className:"absolute z-50 w-full bg-white border rounded shadow max-h-60 overflow-y-auto mt-1",children:$.map(((e,t)=>(0,x.jsx)("li",{className:"p-2 hover:bg-gray-100 cursor-pointer",onClick:()=>(async e=>{try{var t;const{value:a,data:r}=e;console.log("Selected purchase:",r),S(a),I(r);const s=q.find((e=>{var t;return e.value===((null===(t=r.warehouse)||void 0===t?void 0:t._id)||r.warehouse)}))||null;z(s),Z(E.find((e=>{var t;return e.value===((null===(t=r.supplier)||void 0===t?void 0:t._id)||r.supplier)}))||null),k(r.purchaseDate?v()(r.purchaseDate).format("YYYY-MM-DD"):(new Date).toISOString().split("T")[0]),_(r.referenceNo||""),ie([]),se([]),C([]);const n=r.items||[];console.log("Purchase items:",n);const i=(null===(t=r.warehouse)||void 0===t?void 0:t._id)||r.warehouse,o=n.map((e=>{var t;const a="object"===typeof e.item?null===(t=e.item)||void 0===t?void 0:t._id:e.item,r=e.variant||null,s=te.find((e=>e._id===a||e.variantId===r||e.parentId===a))||null;if(!s)return console.warn(`No matching item for ID ${a} or variant ${r} in allItems`,{purchaseItem:e,warehouseId:i}),null;const n=e.expiryDate?v()(e.expiryDate).format("YYYY-MM-DD"):"";return{item:s.parentId,variant:s.variantId,itemName:s.itemName,itemCode:s.itemCode,barcode:s.barcodes[0]||"",quantity:1,price:e.purchasePrice||s.mrp||0,maxQuantity:e.quantity||1,reason:"",totalAmount:1*(e.purchasePrice||s.mrp||0),expiryDate:n,purchasePrice:e.purchasePrice||0,salesPrice:e.salesPrice||0,unitCost:e.unitCost||0,discount:e.discount||0,parentId:s.parentId,isVariant:s.isVariant}})).filter(Boolean);console.log("Mapped purchase items:",o),0===o.length&&n.length>0&&te.filter((e=>e.warehouseId===i)),ie(o)}catch(s){var a,r;console.error("Load purchase error:",s),R("Failed to load purchase: "+((null===(a=s.response)||void 0===a||null===(r=a.data)||void 0===r?void 0:r.message)||s.message))}})(e),children:e.label},t)))})]}),(0,x.jsxs)("div",{children:[(0,x.jsx)("label",{className:"font-semibold",children:"Return Code *"}),(0,x.jsx)("input",{type:"text",value:M,readOnly:!0,className:"w-full p-2 border rounded"})]}),(0,x.jsxs)("div",{children:[(0,x.jsx)("label",{className:"font-semibold",children:"Reference No"}),(0,x.jsx)("input",{type:"text",value:P,onChange:e=>_(e.target.value),className:"w-full p-2 border rounded"})]}),(0,x.jsxs)("div",{children:[(0,x.jsx)("label",{className:"font-semibold",children:"Purchase Date *"}),(0,x.jsx)("input",{type:"date",value:O,onChange:e=>k(e.target.value),className:"w-full p-2 border rounded"})]}),(0,x.jsxs)("div",{children:[(0,x.jsx)("label",{className:"font-semibold",children:"Warehouse *"}),(0,x.jsx)(h.Ay,{options:q,value:U,onChange:z})]}),(0,x.jsxs)("div",{children:[(0,x.jsx)("label",{className:"font-semibold",children:"Supplier *"}),(0,x.jsx)(h.Ay,{options:E,value:J,onChange:Z})]}),(0,x.jsxs)("div",{children:[(0,x.jsx)("label",{className:"font-semibold",children:"Status"}),(0,x.jsxs)("select",{value:Y,onChange:e=>T(e.target.value),className:"w-full p-2 border rounded",children:[(0,x.jsx)("option",{value:"Return",children:"Return"}),(0,x.jsx)("option",{value:"Cancel",children:"Cancel"})]})]})]}),(0,x.jsxs)("div",{className:"relative mb-6",children:[(0,x.jsxs)("div",{className:"flex items-center",children:[(0,x.jsx)(n.SCC,{className:"mr-2 text-gray-600"}),(0,x.jsx)("input",{type:"text",disabled:!U,placeholder:"Search item by name, code, or barcode",className:"flex-grow p-2 border rounded disabled:bg-gray-100",value:oe,onChange:e=>{const t=e.target.value.trim();le(t);const a=re.find((e=>e.barcodes.includes(t)||e.itemCode===t||e.itemName.toLowerCase()===t.toLowerCase()));a&&(Ve(a),le(""))},onKeyDown:e=>{"Enter"===e.key&&ue.length>0&&Ve(ue[0])}}),(0,x.jsx)("button",{onClick:()=>Ve(ue[0]),disabled:!ue.length,className:"ml-2 px-4 py-2 bg-green-600 text-white rounded disabled:bg-gray-400",children:"Add"}),(0,x.jsx)("button",{onClick:async()=>{if(!U)return void R("Select warehouse first");le(""),pe(!0);const e=new p.BrowserMultiFormatReader;b.current=e;try{var t;const a=await e.listVideoInputDevices();await e.decodeFromVideoDevice(null===(t=a[0])||void 0===t?void 0:t.deviceId,f.current,(t=>{if(t){const a=re.find((e=>e.barcodes.includes(t.getText())||e.itemCode===t.getText()));a&&Ve(a),e.stopStreams(),pe(!1)}}))}catch(a){console.error("Scanner error:",a),R("Scanner error: "+a.message),pe(!1)}},disabled:!U,className:"ml-2 p-2 bg-gray-100 rounded disabled:opacity-50",children:(0,x.jsx)(i.g,{icon:o.rwq})})]}),de&&(0,x.jsx)("p",{className:"text-red-500 text-sm mt-1",children:de}),he&&(0,x.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:[(0,x.jsx)("video",{ref:f,className:"w-64 h-64"}),(0,x.jsx)("button",{onClick:()=>{var e;null===(e=b.current)||void 0===e||e.reset(),pe(!1)},className:"mt-4 px-4 py-2 bg-red-600 text-white rounded",children:"Cancel"})]}),ue.length>0&&(0,x.jsx)("ul",{className:"absolute z-50 w-full bg-white border rounded shadow max-h-60 overflow-y-auto mt-1",children:ue.map((e=>(0,x.jsxs)("li",{className:"p-2 hover:bg-gray-100 cursor-pointer",children:[(0,x.jsxs)("div",{children:[(0,x.jsx)("strong",{children:e.itemName}),(0,x.jsxs)("span",{className:"ml-2 text-xs text-gray-500",children:["Code: ",e.itemCode]})]}),e.barcodes.length>0&&(0,x.jsxs)("div",{className:"text-xs text-gray-600",children:["Barcode: ",e.barcodes.join(", ")]})]},e._id)))})]}),(0,x.jsxs)("table",{className:"w-full border-collapse mb-6",children:[(0,x.jsx)("thead",{className:"bg-sky-600 text-white",children:(0,x.jsxs)("tr",{children:[(0,x.jsx)("th",{className:"border p-2",children:"Item"}),(0,x.jsx)("th",{className:"border p-2",children:"Code"}),(0,x.jsx)("th",{className:"border p-2",children:"Qty"}),(0,x.jsx)("th",{className:"border p-2",children:"Price"}),(0,x.jsx)("th",{className:"border p-2",children:"Expiry Date"}),(0,x.jsx)("th",{className:"border p-2",children:"Reason"}),(0,x.jsx)("th",{className:"border p-2",children:"Total"}),(0,x.jsx)("th",{className:"border p-2",children:"Action"})]})}),(0,x.jsx)("tbody",{children:0===ne.length?(0,x.jsx)("tr",{children:(0,x.jsx)("td",{colSpan:"8",className:"p-4 text-center text-red-600",children:"No items to return"})}):ne.map(((e,t)=>(0,x.jsxs)("tr",{children:[(0,x.jsx)("td",{className:"border p-2",children:e.itemName}),(0,x.jsx)("td",{className:"border p-2",children:e.itemCode}),(0,x.jsx)("td",{className:"border p-2",children:(0,x.jsx)("input",{type:"number",min:"1",max:e.maxQuantity,value:e.quantity,onChange:e=>y(t,"quantity",e.target.value,0,ie),className:"w-16 p-1 border rounded"})}),(0,x.jsx)("td",{className:"border p-2",children:(0,x.jsx)("input",{type:"number",min:"0",value:e.price,onChange:e=>y(t,"price",e.target.value,0,ie),className:"w-16 p-1 border rounded"})}),(0,x.jsx)("td",{className:"border p-2",children:(0,x.jsx)("input",{type:"date",value:e.expiryDate,onChange:e=>y(t,"expiryDate",e.target.value,0,ie),className:"w-32 p-1 border rounded"})}),(0,x.jsx)("td",{className:"border p-2",children:(0,x.jsx)("input",{type:"text",value:e.reason,onChange:e=>y(t,"reason",e.target.value,0,ie),className:"w-full p-1 border rounded"})}),(0,x.jsx)("td",{className:"border p-2",children:e.totalAmount.toFixed(2)}),(0,x.jsx)("td",{className:"border p-2",children:(0,x.jsx)("button",{onClick:()=>(e=>{ie((t=>t.filter(((t,a)=>a!==e))))})(t),className:"text-red-600",children:"Remove"})})]},t)))})]}),(0,x.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[(0,x.jsxs)("div",{children:[(0,x.jsx)("label",{className:"font-semibold",children:"Other Charges"}),(0,x.jsx)("input",{type:"number",min:"0",value:fe,onChange:e=>ve(Number(e.target.value)),className:"w-full p-2 border rounded"})]}),(0,x.jsxs)("div",{children:[(0,x.jsx)("label",{className:"font-semibold",children:"Coupon Code"}),(0,x.jsx)("input",{type:"text",value:Pe,onChange:e=>_e(e.target.value),className:"w-full p-2 border rounded"}),(0,x.jsxs)("div",{className:"flex space-x-2 mt-2",children:[(0,x.jsxs)("select",{value:Oe,onChange:e=>ke(e.target.value),className:"flex-1 p-2 border rounded",children:[(0,x.jsx)("option",{value:"",children:"Type\u2026"}),(0,x.jsx)("option",{value:"percentage",children:"Percentage"}),(0,x.jsx)("option",{value:"value",children:"Fixed"})]}),(0,x.jsx)("input",{type:"number",min:"0",value:Ye,onChange:e=>Te(Number(e.target.value)),className:"w-24 p-2 border rounded",placeholder:"Value"})]})]}),(0,x.jsxs)("div",{children:[(0,x.jsx)("label",{className:"font-semibold",children:"Discount on All"}),(0,x.jsxs)("div",{className:"flex space-x-2",children:[(0,x.jsx)("input",{type:"number",min:"0",value:xe,onChange:e=>ge(Number(e.target.value)),className:"flex-1 p-2 border rounded",placeholder:"Amount"}),(0,x.jsxs)("select",{value:Le,onChange:e=>Re(e.target.value),className:"w-24 p-2 border rounded",children:[(0,x.jsx)("option",{value:"Per%",children:"Per%"}),(0,x.jsx)("option",{value:"Fixed",children:"Fixed"})]})]})]}),(0,x.jsxs)("div",{className:"col-span-2",children:[(0,x.jsx)("label",{className:"font-semibold",children:"Note"}),(0,x.jsx)("textarea",{value:ye,onChange:e=>be(e.target.value),className:"w-full p-2 border rounded",rows:3})]})]}),(0,x.jsx)("div",{className:"mb-6 p-4 bg-gray-100 rounded",children:(0,x.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,x.jsxs)("div",{children:[(0,x.jsx)("label",{className:"font-semibold",children:"Payment Amount"}),(0,x.jsx)("input",{type:"number",min:"0",value:Ne,onChange:e=>je(e.target.value),className:"w-full p-2 border rounded"})]}),(0,x.jsxs)("div",{children:[(0,x.jsx)("label",{className:"font-semibold",children:"Payment Type"}),(0,x.jsx)(h.Ay,{options:W,value:K,onChange:X})]}),Ee&&(0,x.jsxs)("div",{children:[(0,x.jsx)("label",{className:"font-semibold",children:"Account"}),(0,x.jsx)(h.Ay,{options:Fe.length>0?Fe:B,value:G,onChange:ee,isClearable:!0})]}),(0,x.jsxs)("div",{className:"col-span-2",children:[(0,x.jsx)("label",{className:"font-semibold",children:"Payment Note"}),(0,x.jsx)("textarea",{value:we,onChange:e=>Se(e.target.value),className:"w-full p-2 border rounded"})]})]})}),(0,x.jsxs)("div",{className:"flex justify-end space-x-4",children:[(0,x.jsx)("button",{onClick:async()=>{if(U&&J&&ne.length)if(Ne>0&&Ee&&!G)R("Please select a cash account for the payment");else{Ie(!0);try{const e={originalPurchaseRef:w||void 0,referenceNo:P||w,purchaseDate:O,warehouse:U.value,supplier:J.value,isReturn:!0,status:Y,createdBy:localStorage.getItem("userId"),createdByModel:"User",items:ne.map((e=>({item:e.item,variant:e.variant||void 0,quantity:e.quantity,purchasePrice:e.price,salesPrice:e.salesPrice,unitCost:e.unitCost,totalAmount:e.totalAmount,discount:e.discount||0,reason:e.reason||void 0,expiryDate:e.expiryDate||void 0}))),otherCharges:Number(fe)||0,discountOnAll:Number(xe)||0,discountOnAllType:Le,couponCode:Pe||void 0,couponType:Oe||void 0,couponValue:Number(Ye)||0,note:ye,grandTotal:$e,payments:Ne>0?[{paymentType:null===K||void 0===K?void 0:K.value,account:(null===G||void 0===G?void 0:G.value)||void 0,amount:Number(Ne),paymentNote:we,date:(new Date).toISOString()}]:[]};if(console.log("Saving return payload:",JSON.stringify(e,null,2)),m){const t=await g.put(`/purchases/purchase-returns/${m}`,e);console.log("Update response:",t.data)}else{const t=await g.post("/purchases/purchase-returns",e);console.log("Create response:",t.data)}t("/purchasereturn-list")}catch(s){var e,a,r;console.error("Save error:",(null===(e=s.response)||void 0===e?void 0:e.data)||s),R("Save failed: "+((null===(a=s.response)||void 0===a||null===(r=a.data)||void 0===r?void 0:r.message)||s.message)+". Check console for payload and response details.")}finally{Ie(!1)}}else R("Warehouse, supplier, and at least one item are required")},disabled:(We="PurchasesReturn",He="Add",!("admin"===(localStorage.getItem("role")||"guest").toLowerCase()||N.some((e=>e.module.toLowerCase()===We.toLowerCase()&&e.actions.map((e=>e.toLowerCase())).includes(He.toLowerCase()))))),className:"px-4 py-2 bg-green-600 text-white rounded disabled:bg-gray-400",children:m?"Update":"Save"}),(0,x.jsx)("button",{onClick:()=>t("/purchasereturn-list"),className:"px-4 py-2 bg-gray-600 text-white rounded",children:"Cancel"})]})]})]})]});var We,He}},60446:function(e){e.exports=function(){"use strict";var e=1e3,t=6e4,a=36e5,r="millisecond",s="second",n="minute",i="hour",o="day",l="week",u="month",c="quarter",d="year",m="date",h="Invalid Date",p=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,f=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,v={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(e){var t=["th","st","nd","rd"],a=e%100;return"["+e+(t[(a-20)%10]||t[a]||t[0])+"]"}},x=function(e,t,a){var r=String(e);return!r||r.length>=t?e:""+Array(t+1-r.length).join(a)+e},g={s:x,z:function(e){var t=-e.utcOffset(),a=Math.abs(t),r=Math.floor(a/60),s=a%60;return(t<=0?"+":"-")+x(r,2,"0")+":"+x(s,2,"0")},m:function e(t,a){if(t.date()<a.date())return-e(a,t);var r=12*(a.year()-t.year())+(a.month()-t.month()),s=t.clone().add(r,u),n=a-s<0,i=t.clone().add(r+(n?-1:1),u);return+(-(r+(a-s)/(n?s-i:i-s))||0)},a:function(e){return e<0?Math.ceil(e)||0:Math.floor(e)},p:function(e){return{M:u,y:d,w:l,d:o,D:m,h:i,m:n,s:s,ms:r,Q:c}[e]||String(e||"").toLowerCase().replace(/s$/,"")},u:function(e){return void 0===e}},y="en",b={};b[y]=v;var N="$isDayjsObject",j=function(e){return e instanceof C||!(!e||!e[N])},w=function e(t,a,r){var s;if(!t)return y;if("string"==typeof t){var n=t.toLowerCase();b[n]&&(s=n),a&&(b[n]=a,s=n);var i=t.split("-");if(!s&&i.length>1)return e(i[0])}else{var o=t.name;b[o]=t,s=o}return!r&&s&&(y=s),s||!r&&y},S=function(e,t){if(j(e))return e.clone();var a="object"==typeof t?t:{};return a.date=e,a.args=arguments,new C(a)},$=g;$.l=w,$.i=j,$.w=function(e,t){return S(e,{locale:t.$L,utc:t.$u,x:t.$x,$offset:t.$offset})};var C=function(){function v(e){this.$L=w(e.locale,null,!0),this.parse(e),this.$x=this.$x||e.x||{},this[N]=!0}var x=v.prototype;return x.parse=function(e){this.$d=function(e){var t=e.date,a=e.utc;if(null===t)return new Date(NaN);if($.u(t))return new Date;if(t instanceof Date)return new Date(t);if("string"==typeof t&&!/Z$/i.test(t)){var r=t.match(p);if(r){var s=r[2]-1||0,n=(r[7]||"0").substring(0,3);return a?new Date(Date.UTC(r[1],s,r[3]||1,r[4]||0,r[5]||0,r[6]||0,n)):new Date(r[1],s,r[3]||1,r[4]||0,r[5]||0,r[6]||0,n)}}return new Date(t)}(e),this.init()},x.init=function(){var e=this.$d;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()},x.$utils=function(){return $},x.isValid=function(){return!(this.$d.toString()===h)},x.isSame=function(e,t){var a=S(e);return this.startOf(t)<=a&&a<=this.endOf(t)},x.isAfter=function(e,t){return S(e)<this.startOf(t)},x.isBefore=function(e,t){return this.endOf(t)<S(e)},x.$g=function(e,t,a){return $.u(e)?this[t]:this.set(a,e)},x.unix=function(){return Math.floor(this.valueOf()/1e3)},x.valueOf=function(){return this.$d.getTime()},x.startOf=function(e,t){var a=this,r=!!$.u(t)||t,c=$.p(e),h=function(e,t){var s=$.w(a.$u?Date.UTC(a.$y,t,e):new Date(a.$y,t,e),a);return r?s:s.endOf(o)},p=function(e,t){return $.w(a.toDate()[e].apply(a.toDate("s"),(r?[0,0,0,0]:[23,59,59,999]).slice(t)),a)},f=this.$W,v=this.$M,x=this.$D,g="set"+(this.$u?"UTC":"");switch(c){case d:return r?h(1,0):h(31,11);case u:return r?h(1,v):h(0,v+1);case l:var y=this.$locale().weekStart||0,b=(f<y?f+7:f)-y;return h(r?x-b:x+(6-b),v);case o:case m:return p(g+"Hours",0);case i:return p(g+"Minutes",1);case n:return p(g+"Seconds",2);case s:return p(g+"Milliseconds",3);default:return this.clone()}},x.endOf=function(e){return this.startOf(e,!1)},x.$set=function(e,t){var a,l=$.p(e),c="set"+(this.$u?"UTC":""),h=(a={},a[o]=c+"Date",a[m]=c+"Date",a[u]=c+"Month",a[d]=c+"FullYear",a[i]=c+"Hours",a[n]=c+"Minutes",a[s]=c+"Seconds",a[r]=c+"Milliseconds",a)[l],p=l===o?this.$D+(t-this.$W):t;if(l===u||l===d){var f=this.clone().set(m,1);f.$d[h](p),f.init(),this.$d=f.set(m,Math.min(this.$D,f.daysInMonth())).$d}else h&&this.$d[h](p);return this.init(),this},x.set=function(e,t){return this.clone().$set(e,t)},x.get=function(e){return this[$.p(e)]()},x.add=function(r,c){var m,h=this;r=Number(r);var p=$.p(c),f=function(e){var t=S(h);return $.w(t.date(t.date()+Math.round(e*r)),h)};if(p===u)return this.set(u,this.$M+r);if(p===d)return this.set(d,this.$y+r);if(p===o)return f(1);if(p===l)return f(7);var v=(m={},m[n]=t,m[i]=a,m[s]=e,m)[p]||1,x=this.$d.getTime()+r*v;return $.w(x,this)},x.subtract=function(e,t){return this.add(-1*e,t)},x.format=function(e){var t=this,a=this.$locale();if(!this.isValid())return a.invalidDate||h;var r=e||"YYYY-MM-DDTHH:mm:ssZ",s=$.z(this),n=this.$H,i=this.$m,o=this.$M,l=a.weekdays,u=a.months,c=a.meridiem,d=function(e,a,s,n){return e&&(e[a]||e(t,r))||s[a].slice(0,n)},m=function(e){return $.s(n%12||12,e,"0")},p=c||function(e,t,a){var r=e<12?"AM":"PM";return a?r.toLowerCase():r};return r.replace(f,(function(e,r){return r||function(e){switch(e){case"YY":return String(t.$y).slice(-2);case"YYYY":return $.s(t.$y,4,"0");case"M":return o+1;case"MM":return $.s(o+1,2,"0");case"MMM":return d(a.monthsShort,o,u,3);case"MMMM":return d(u,o);case"D":return t.$D;case"DD":return $.s(t.$D,2,"0");case"d":return String(t.$W);case"dd":return d(a.weekdaysMin,t.$W,l,2);case"ddd":return d(a.weekdaysShort,t.$W,l,3);case"dddd":return l[t.$W];case"H":return String(n);case"HH":return $.s(n,2,"0");case"h":return m(1);case"hh":return m(2);case"a":return p(n,i,!0);case"A":return p(n,i,!1);case"m":return String(i);case"mm":return $.s(i,2,"0");case"s":return String(t.$s);case"ss":return $.s(t.$s,2,"0");case"SSS":return $.s(t.$ms,3,"0");case"Z":return s}return null}(e)||s.replace(":","")}))},x.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},x.diff=function(r,m,h){var p,f=this,v=$.p(m),x=S(r),g=(x.utcOffset()-this.utcOffset())*t,y=this-x,b=function(){return $.m(f,x)};switch(v){case d:p=b()/12;break;case u:p=b();break;case c:p=b()/3;break;case l:p=(y-g)/6048e5;break;case o:p=(y-g)/864e5;break;case i:p=y/a;break;case n:p=y/t;break;case s:p=y/e;break;default:p=y}return h?p:$.a(p)},x.daysInMonth=function(){return this.endOf(u).$D},x.$locale=function(){return b[this.$L]},x.locale=function(e,t){if(!e)return this.$L;var a=this.clone(),r=w(e,t,!0);return r&&(a.$L=r),a},x.clone=function(){return $.w(this.$d,this)},x.toDate=function(){return new Date(this.valueOf())},x.toJSON=function(){return this.isValid()?this.toISOString():null},x.toISOString=function(){return this.$d.toISOString()},x.toString=function(){return this.$d.toUTCString()},v}(),D=C.prototype;return S.prototype=D,[["$ms",r],["$s",s],["$m",n],["$H",i],["$W",o],["$M",u],["$y",d],["$D",m]].forEach((function(e){D[e[1]]=function(t){return this.$g(t,e[0],e[1])}})),S.extend=function(e,t){return e.$i||(e(t,C,S),e.$i=!0),S},S.locale=w,S.isDayjs=j,S.unix=function(e){return S(1e3*e)},S.en=b[y],S.Ls=b,S.p={},S}()},82284:(e,t,a)=>{"use strict";function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}a.d(t,{A:()=>r})}}]);
//# sourceMappingURL=1407.2c5b5147.chunk.js.map