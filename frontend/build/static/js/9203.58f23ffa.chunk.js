"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[9203],{53888:(e,t,s)=>{s.d(t,{A:()=>r});s(65043);var a=s(70579);function r(e){let{text:t,type:s="button",className:r,...l}=e;return(0,a.jsx)("button",{className:`${r}`,...l,children:t})}},59203:(e,t,s)=>{s.r(t),s.d(t,{default:()=>g});var a=s(65043),r=s(86213),l=s(21197),i=(s(53888),s(66727)),o=s(60184),n=(s(79038),s(86806),s(59255)),c=s(70579);const d=e=>{let{onClose:t}=e;const[s,l]=(0,a.useState)([]),[i,o]=(0,a.useState)({}),[n,d]=(0,a.useState)([]),[m,g]=(0,a.useState)(0),[x,h]=(0,a.useState)(!1),[u,p]=(0,a.useState)(null),[b,j]=(0,a.useState)(1);(0,a.useEffect)((()=>{(async()=>{try{h(!0);const e=await r.A.get("/api/categories",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),t=Array.isArray(e.data)?e.data:Array.isArray(e.data.data)?e.data.data:[];l(t);const s=await r.A.get("/api/items/getImageByCategory",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});s.data.success&&(o(s.data.data),console.log(s.data.data))}catch(e){console.error("Error fetching data:",e),p("Failed to fetch data. Please try again.")}finally{h(!1)}})()}),[]);const y=s[m],f=(null===y||void 0===y?void 0:y._id)||(null===y||void 0===y?void 0:y.id);(0,a.useEffect)((()=>{f&&i[f]?d(i[f]):d([])}),[f,i]);const v=async e=>{try{console.log(e);const t=await r.A.put("/api/category/assign/master-image",{id:f,image:e},{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"}});console.log(t),alert("Master image updated")}catch(u){console.log("ERro in assigning master image",u)}};return x&&!s.length?(0,c.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm",children:(0,c.jsx)("div",{className:"p-6 bg-white rounded-lg shadow-lg",children:(0,c.jsx)("p",{children:"Loading categories and master images..."})})}):u?(0,c.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm",children:(0,c.jsxs)("div",{className:"p-6 bg-white rounded-lg shadow-lg",children:[(0,c.jsx)("p",{className:"text-red-500",children:u}),(0,c.jsx)("button",{onClick:t,className:"px-4 py-2 mt-4 text-white bg-blue-500 rounded hover:bg-blue-600",children:"Close"})]})}):(0,c.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm",children:(0,c.jsxs)("div",{className:"relative w-11/12 max-w-5xl p-6 bg-white rounded-lg shadow-lg",children:[(0,c.jsx)("button",{onClick:t,className:"absolute p-1 text-gray-500 transition-colors duration-200 top-2 right-2 hover:text-gray-800 hover:bg-gray-100 rounded-full","aria-label":"Close",children:(0,c.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,c.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})}),(0,c.jsx)("h2",{className:"mb-4 text-2xl font-bold text-center text-gray-800",children:"Category Master Images"}),y&&(0,c.jsxs)("div",{className:"text-center",children:[(0,c.jsx)("h3",{className:"mb-1 text-xl font-semibold text-gray-700",children:y.name||`Category ${m+1}`}),(0,c.jsxs)("p",{className:"mb-4 text-sm text-gray-500",children:["ID: ",f]})]}),(0,c.jsx)("div",{className:"p-4 mb-6 border border-gray-200 rounded-lg bg-gray-50",children:n&&n.length>0?(0,c.jsxs)("div",{className:"flex flex-col items-center",children:[(0,c.jsx)("div",{className:"w-full px-4 py-2 mb-2 overflow-x-auto",children:(0,c.jsx)("div",{className:"flex gap-6 min-w-max",children:n.map(((e,t)=>(0,c.jsxs)("div",{className:"flex flex-col items-center transition-transform duration-200 hover:scale-105",children:[(0,c.jsxs)("div",{className:"relative group",children:[(0,c.jsx)("img",{src:e,alt:`Master ${t+1} for ${(null===y||void 0===y?void 0:y.name)||f}`,onClick:()=>v(e),className:"object-contain w-48 h-48 rounded-lg shadow cursor-pointer md:w-64 md:h-64"}),(0,c.jsx)("div",{className:"absolute inset-0 flex items-center justify-center transition-opacity duration-200 bg-black bg-opacity-0 rounded-lg opacity-0 group-hover:opacity-100 group-hover:bg-opacity-30",children:(0,c.jsx)("span",{className:"px-3 py-1 text-sm font-medium text-white bg-black bg-opacity-50 rounded-full",children:"Select Image"})})]}),(0,c.jsxs)("p",{className:"mt-2 text-sm font-medium text-gray-600",children:["Image ",t+1]})]},t)))})}),(0,c.jsx)("p",{className:"text-xs text-gray-500",children:"Scroll horizontally to view all images"})]}):(0,c.jsxs)("div",{className:"flex flex-col items-center justify-center py-10",children:[(0,c.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-12 h-12 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,c.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),(0,c.jsx)("p",{className:"mt-2 text-gray-500",children:"No master image available for this category"})]})}),(0,c.jsxs)("div",{className:"flex flex-col justify-between gap-4 mt-6 md:flex-row",children:[(0,c.jsxs)("button",{onClick:()=>{g((e=>(e-1+s.length)%s.length))},disabled:x||s.length<=1,className:"flex items-center justify-center px-4 py-2 text-white transition-colors duration-200 bg-gray-500 rounded-md hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed gap-x-2",children:[(0,c.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,c.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 19l-7-7 7-7"})}),"Previous"]}),(0,c.jsx)("div",{className:"flex justify-center gap-4",children:(0,c.jsx)("button",{onClick:()=>(async e=>{try{h(!0);const t=await r.A.get(`/api/items/category/getImageForCategory?categoryId=${e}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});console.log(t),d(t.data)}catch(t){console.error("Failed to fetch merged images:",t)}finally{h(!1)}})(f),disabled:x||!y,className:"flex items-center justify-center px-4 py-2 text-white transition-colors duration-200 bg-blue-500 rounded-md hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed gap-x-2",children:x?(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)("svg",{className:"w-5 h-5 mr-2 animate-spin",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,c.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,c.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Generating..."]}):(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,c.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Regenerate Master Image"]})})}),(0,c.jsxs)("button",{onClick:()=>{g((e=>(e+1)%s.length))},disabled:x||s.length<=1,className:"flex items-center justify-center px-4 py-2 text-white transition-colors duration-200 bg-gray-500 rounded-md hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed gap-x-2",children:["Next",(0,c.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,c.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 5l7 7-7 7"})})]})]}),(0,c.jsxs)("div",{className:"mt-4 text-sm text-center text-gray-500",children:["Category ",(0,c.jsx)("span",{className:"font-medium",children:m+1})," of ",(0,c.jsx)("span",{className:"font-medium",children:s.length})]})]})})},m=e=>{let{onClose:t,category:s}=e;const[l,i]=(0,a.useState)([]),[o,n]=(0,a.useState)(!1),[d,m]=(0,a.useState)(null),[g,x]=(0,a.useState)(1);(0,a.useEffect)((()=>{h()}),[]);const h=async()=>{try{n(!0);const e=await r.A.get(`/api/items/category/getImageForCategory?categoryId=${s._id}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});console.log("res"),console.log(e),i(e.data)}catch(e){console.error("Failed to regenerate master images:",e)}finally{n(!1)}};return o?(0,c.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm",children:(0,c.jsx)("div",{className:"p-6 bg-white rounded-lg shadow-lg",children:(0,c.jsx)("p",{children:"Loading..."})})}):d||!s?(0,c.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm",children:(0,c.jsxs)("div",{className:"p-6 bg-white rounded-lg shadow-lg",children:[(0,c.jsx)("p",{className:"text-red-500",children:d||"Category not found."}),(0,c.jsx)("button",{onClick:t,className:"px-4 py-2 mt-4 text-white bg-blue-500 rounded hover:bg-blue-600",children:"Close"})]})}):(0,c.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm",children:(0,c.jsxs)("div",{className:"relative w-11/12 max-w-4xl p-6 bg-white rounded-lg shadow-lg",children:[(0,c.jsx)("button",{onClick:t,className:"absolute p-1 text-gray-500 top-2 right-2 hover:text-gray-800","aria-label":"Close",children:(0,c.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,c.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})}),(0,c.jsxs)("h2",{className:"mb-4 text-xl font-semibold text-center",children:["Master Images - ",(null===s||void 0===s?void 0:s.name)||"NA"]}),(0,c.jsxs)("p",{className:"mb-4 text-center text-gray-500",children:["Category ID: ",(null===s||void 0===s?void 0:s._id)||"NA"]}),l.length>0?(0,c.jsx)("div",{className:"grid grid-cols-1 gap-4 mb-4 sm:grid-cols-2 md:grid-cols-3",children:l.map(((e,t)=>(0,c.jsxs)("div",{className:"flex flex-col items-center justify-center p-2 border rounded shadow-sm",children:[(0,c.jsx)("img",{src:`${e}`,alt:"master",className:"object-contain mb-2 max-h-64"}),(0,c.jsx)("button",{onClick:()=>(async e=>{try{(await r.A.put("api/category/assign/master-image",{id:s._id,image:e},{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})).data.success&&alert("Master image updated successfully!")}catch(t){console.error("Failed to set master image:",t),alert("Failed to set master image.")}})(e),className:"px-3 py-1 text-white bg-blue-500 rounded hover:bg-blue-600",children:"Set as Master"})]},t)))}):(0,c.jsx)("p",{className:"text-center text-gray-500",children:"No master images available."}),(0,c.jsx)("div",{className:"flex justify-center mt-6",children:(0,c.jsx)("button",{onClick:h,className:"px-4 py-2 text-white bg-blue-500 rounded hover:bg-blue-600",children:o?"Generating...":"Regenerate Master Images"})})]})})},g=()=>{const[e,t]=(0,a.useState)(!0),[s,g]=(0,a.useState)([]),[x,h]=(0,a.useState)([]),[u,p]=(0,a.useState)(!1),[b,j]=(0,a.useState)(!1),[y,f]=(0,a.useState)(null),[v,w]=(0,a.useState)({});(0,a.useEffect)((()=>{window.innerWidth<768&&t(!1)}),[window.innerWidth]);(0,a.useEffect)((()=>{(async()=>{try{const e=await r.A.get("/api/items/getWithCategory",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});g(Object.keys(e.data.data))}catch(e){console.error("Error fetching stores:",e)}})(),(async()=>{try{const e=await r.A.get("api/categories",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),t=Array.isArray(e.data)?e.data:Array.isArray(e.data.data)?e.data.data:[];console.log(t),h(t)}catch(e){console.error("Fetch categories error:",e)}})()}),[]);return(0,c.jsxs)("div",{className:"flex flex-col h-screen",children:[(0,c.jsx)(l.A,{isSidebarOpen:e,setSidebarOpen:t}),(0,c.jsxs)("div",{className:"flex flex-grow ",children:[(0,c.jsx)("div",{children:(0,c.jsx)(n.A,{isSidebarOpen:e})}),(0,c.jsxs)("div",{className:" flex flex-col p-2 md:p-2  w-full",children:[(0,c.jsxs)("header",{className:"flex flex-col items-center justify-between p-4 rounded-md shadow sm:flex-row",children:[(0,c.jsxs)("div",{className:"flex items-center gap-1 text-center sm:flex-row sm:text-left",children:[(0,c.jsx)("h1",{className:"text-lg font-semibold truncate sm:text-xl",children:"Category Master Image"}),(0,c.jsx)("span",{className:"text-xs text-gray-600 sm:text-sm",children:"Add/Update Master"})]}),(0,c.jsxs)("nav",{className:"flex flex-wrap items-center justify-center mt-2 text-xs text-gray-500 sm:justify-start sm:text-sm sm:mt-0",children:[(0,c.jsxs)(i.k2,{to:"/dashboard",className:"flex items-center text-gray-700 no-underline hover:text-cyan-600",children:[(0,c.jsx)(o.$BV,{className:"mr-2 text-gray-500 hover:text-cyan-600"})," Home"]}),(0,c.jsx)(i.k2,{to:"/banners/view",className:"flex items-center text-gray-700 no-underline hover:text-cyan-600",children:"> Item Master Image"})]})]}),(0,c.jsxs)("div",{className:"p-4 mt-1 bg-white border-t-4 rounded-lg shadow-md border-cyan-500",children:[(0,c.jsx)("div",{className:"flex gap-5",children:(0,c.jsxs)("div",{className:"relative flex flex-col w-full py-2",children:[(0,c.jsx)("button",{onClick:()=>{p(!0),t(!1)},className:"px-4 py-2 text-sm font-semibold text-white bg-blue-600 rounded hover:bg-blue-700",children:"Generate Master Image"}),u&&(0,c.jsx)(d,{onClose:()=>{t(!0),p(!1)}}),b&&(0,c.jsx)(m,{category:y,onClose:()=>{t(!0),j(!1)}})]})}),(0,c.jsx)("div",{className:"w-full mt-4 overflow-x-auto min-h-16",children:(0,c.jsxs)("table",{className:"min-w-full border-2 divide-y divide-gray-200 min-h-48",children:[(0,c.jsx)("thead",{className:"sticky top-0 bg-gray-200",children:(0,c.jsxs)("tr",{children:[(0,c.jsx)("th",{className:"py-3 text-xs font-medium tracking-wider text-left text-gray-500 uppercase",children:"Category Name"}),(0,c.jsx)("th",{className:"py-3 text-xs font-medium tracking-wider text-left text-gray-500 uppercase",children:"Actions"})]})}),(0,c.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:s.map(((e,s)=>{const a=x.find((t=>t._id===e));return(0,c.jsxs)("tr",{children:[(0,c.jsx)("td",{className:"py-4 text-sm text-gray-500 whitespace-nowrap",children:a.name}),(0,c.jsx)("td",{className:"py-4 text-sm text-gray-500 whitespace-nowrap",children:(0,c.jsx)("button",{onClick:()=>{t(!1),f(a),j(!0)},className:"px-4 py-2 text-sm font-semibold text-white bg-blue-600 rounded hover:bg-blue-700",children:"Generate Master Image"})})]},s)}))})]})})]})]})]})]})}},86806:(e,t,s)=>{s.d(t,{A:()=>i});var a=s(65043),r=s(86213),l=s(70579);const i=e=>{var t;let{item:s,onClose:i}=e;const[o,n]=(0,a.useState)(s.masterImageId||null),[c,d]=(0,a.useState)(s.itemImages||[]),m="/vps/uploads/qr/items";console.log("item"),console.log(s);const g=async e=>{n(e);try{const t=await r.A.put("api/items/assign/master_image",{id:s._id,image:e},{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"}});console.log(t),alert("Master image selected"),i()}catch(t){console.log("ERro in assigning master image",t)}};return(0,l.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm",children:(0,l.jsxs)("div",{className:"relative w-11/12 max-w-5xl p-4 bg-white rounded-lg shadow-lg",children:[(0,l.jsx)("button",{onClick:i,className:"absolute p-1 text-gray-500 top-2 right-2 hover:text-gray-800","aria-label":"Close",children:(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})}),(0,l.jsx)("h3",{children:"Item Master Image"}),s.masterImage&&""!==s.masterImage?(0,l.jsx)("div",{className:"grid grid-cols-2 gap-4 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5",children:(0,l.jsx)("img",{src:`${m}/${s.masterImage}`,alt:`${s.itemName}`,className:"object-cover w-full h-32"})}):(0,l.jsx)("div",{className:"py-8 text-center text-gray-500",children:"No Master Image is selected"}),(0,l.jsx)("h3",{className:"mb-4 text-lg font-semibold",children:"Item Images"}),0===c.length?(0,l.jsx)("div",{className:"py-8 text-center text-gray-500",children:"No images available for this item"}):(0,l.jsx)("div",{className:"grid grid-cols-2 gap-4 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5",children:c.map(((e,t)=>(console.log("image"),console.log(e),(0,l.jsxs)("div",{className:"relative border-2 rounded-lg overflow-hidden "+(o===e._id?"border-blue-500 ring-2 ring-blue-200":"border-gray-200"),draggable:!0,onDragStart:e=>e.dataTransfer.setData("text/plain",t),onDragOver:e=>e.preventDefault(),onDrop:e=>{e.preventDefault();((e,t)=>{const s=Array.from(c),[a]=s.splice(e,1);s.splice(t,0,a),d(s)})(parseInt(e.dataTransfer.getData("text/plain")),t)},children:[(0,l.jsx)("img",{src:`${m}/${e}`,alt:`Item ${s.itemName} - Image ${t+1}`,className:"object-cover w-full h-32"}),(0,l.jsx)("div",{className:"absolute bottom-0 left-0 right-0 p-1 text-xs text-white truncate bg-black bg-opacity-50",children:e.name||`Image ${t+1}`}),(0,l.jsx)("button",{onClick:()=>g(e),className:"absolute top-1 right-1 p-1 rounded-full "+(o===e._id?"bg-blue-500 text-white":"bg-white text-gray-700"),title:o===e._id?"Master image":"Set as master",children:o===e._id?(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-4 h-4",viewBox:"0 0 20 20",fill:"currentColor",children:(0,l.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}):(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-4 h-4",viewBox:"0 0 20 20",fill:"currentColor",children:(0,l.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v2H7a1 1 0 100 2h2v2a1 1 0 102 0v-2h2a1 1 0 100-2h-2V7z",clipRule:"evenodd"})})}),(0,l.jsx)("div",{className:"absolute px-1 text-xs text-white bg-black rounded top-1 left-1 bg-opacity-70",children:t+1})]},e._id))))}),o&&(0,l.jsxs)("div",{className:"mt-4 text-sm text-gray-600",children:["Master image selected: ",(null===(t=c.find((e=>e._id===o)))||void 0===t?void 0:t.name)||"No name"]})]})})}}}]);
//# sourceMappingURL=9203.58f23ffa.chunk.js.map