"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[5233],{14840:(e,t,a)=>{a.d(t,{A:()=>o});var s=a(65043),n=a(21197),l=a(59255),r=a(70579);function o(){const[e,t]=(0,s.useState)(!1);return(0,r.jsxs)("div",{className:"flex flex-col h-screen",children:[(0,r.jsx)(n.A,{isSidebarOpen:e,setSidebarOpen:t}),(0,r.jsxs)("div",{className:"flex flex-grow mt-20",children:[(0,r.jsx)("div",{children:(0,r.jsx)(l.A,{isSidebarOpen:e})}),(0,r.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-white/80 backdrop-blur-sm",children:(0,r.jsxs)("div",{className:"flex flex-col items-center",children:[(0,r.jsx)("div",{className:"w-12 h-12 border-4 rounded-full border-cyan-500 border-t-transparent animate-spin"}),(0,r.jsx)("p",{className:"mt-3 text-lg font-semibold text-gray-700",children:"Loading..."})]})})]})]})}},34656:(e,t,a)=>{t.L=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{positionOptions:t={enableHighAccuracy:!0,maximumAge:0,timeout:1/0},isOptimisticGeolocationEnabled:a=!0,userDecisionTimeout:n,suppressLocationOnMount:l=!1,watchPosition:r=!1,geolocationProvider:o=("undefined"!==typeof navigator?navigator.geolocation:void 0),watchLocationPermissionChange:i=!1,onError:c,onSuccess:d}=e,u=(0,s.useRef)(0),m=(0,s.useRef)(!0),h=(0,s.useRef)(0),[x,p]=(0,s.useState)(a),[v,f]=(0,s.useState)(),[b,g]=(0,s.useState)(),[j,w]=(0,s.useState)(),[N,A]=(0,s.useState)(),S=(0,s.useCallback)((()=>{u.current&&window.clearTimeout(u.current)}),[]),y=(0,s.useCallback)((e=>{S(),m.current&&(f((()=>{})),p(!1),w(e)),null===c||void 0===c||c(e)}),[c,S]),C=(0,s.useCallback)((e=>{S(),m.current&&(f(e.coords),g(e.timestamp),p(!0),w((()=>{}))),null===d||void 0===d||d(e)}),[d,S]),E=(0,s.useCallback)((()=>{if(!o||!o.getCurrentPosition||!o.watchPosition)throw new Error("The provided geolocation provider is invalid");n&&(u.current=window.setTimeout((()=>{y()}),n)),r?h.current=o.watchPosition(C,y,t):o.getCurrentPosition(C,y,t)}),[o,r,n,y,C,t]);return(0,s.useEffect)((()=>{let e;return i&&o&&"permissions"in navigator&&navigator.permissions.query({name:"geolocation"}).then((t=>{e=t,e.onchange=()=>{A(e.state)}})).catch((e=>{console.error("Error updating the permissions",e)})),()=>{e&&(e.onchange=null)}}),[]),(0,s.useEffect)((()=>(l||E(),()=>{S(),r&&h.current&&(null===o||void 0===o||o.clearWatch(h.current))})),[N]),{getPosition:E,coords:v,timestamp:b,isGeolocationEnabled:x,isGeolocationAvailable:Boolean(o),positionError:j}};const s=a(65043)},85233:(e,t,a)=>{a.r(t),a.d(t,{default:()=>h});var s=a(65043),n=a(86213),l=a(49804),r=a(60184),o=a(34656),i=a(66727),c=a(21197),d=a(59255),u=a(14840),m=a(70579);const h=()=>{const e=(0,i.Zp)(),[t]=(0,i.ok)(),a=t.get("id"),h=(localStorage.getItem("role")||"").toLowerCase(),x=localStorage.getItem("storeId"),p={Authorization:`Bearer ${localStorage.getItem("token")}`},[v,f]=(0,s.useState)(window.innerWidth>=768),[b,g]=(0,s.useState)(!1),[j,w]=(0,s.useState)([]),[N,A]=(0,s.useState)([]),[S,y]=(0,s.useState)([]),[C,E]=(0,s.useState)(null),[I,L]=(0,s.useState)({warehouseName:"",mobile:"",email:"",status:"Active",store:"admin"===h?"":x,cashAccount:"",terminalId:"",tid:""}),[k,_]=(0,s.useState)(null),{coords:O,isGeolocationAvailable:T,isGeolocationEnabled:P,positionError:W}=(0,o.L)({userDecisionTimeout:5e3,watchPosition:!1}),[q,D]=(0,s.useState)(null),[G,R]=(0,s.useState)(null);(0,s.useEffect)((()=>{O&&(D(O.latitude),R(O.longitude))}),[O]),(0,s.useEffect)((()=>{n.A.get("admin/store/add/store",{headers:p}).then((e=>{var t;const a=null!==(t=e.data.result)&&void 0!==t?t:[];if(w(a),"admin"!==h){var s;const e=a.find((e=>e._id===x)),t="string"===typeof(null===e||void 0===e?void 0:e.storeAccount)?e.storeAccount:null===e||void 0===e||null===(s=e.storeAccount)||void 0===s?void 0:s._id;E(t||null)}})).catch(console.error)}),[h,x]),(0,s.useEffect)((()=>{n.A.get("api/accounts",{headers:p}).then((e=>{var t;return A(null!==(t=e.data.data)&&void 0!==t?t:[])})).catch(console.error),n.A.get("api/terminals",{headers:p}).then((e=>{var t;return y(null!==(t=e.data.data)&&void 0!==t?t:[])})).catch(console.error)}),[]),(0,s.useEffect)((()=>{a&&(g(!0),n.A.get(`api/warehouses/${a}`,{headers:p}).then((e=>{var t,a,s;const n=e.data.data;n&&(L({warehouseName:n.warehouseName||"",mobile:n.mobile||"",email:n.email||"",status:n.status||"Active",store:(null===(t=n.store)||void 0===t?void 0:t._id)||I.store,cashAccount:(null===(a=n.cashAccount)||void 0===a?void 0:a._id)||"",terminalId:(null===(s=n.terminal)||void 0===s?void 0:s._id)||"",tid:n.tid||""}),null!=n.Latitude&&D(n.Latitude),null!=n.Longitude&&R(n.Longitude))})).catch(console.error).finally((()=>g(!1))))}),[a]);const $=e=>{const{name:t,value:a}=e.target;L((e=>({...e,[t]:a})))},B="admin"===h?N:N.filter((e=>{var t;return("string"===typeof e.parentAccount?e.parentAccount:null===(t=e.parentAccount)||void 0===t?void 0:t._id)===C}));return b?(0,m.jsx)(u.A,{}):(0,m.jsxs)("div",{className:"flex flex-col h-screen bg-gray-100",children:[(0,m.jsx)(c.A,{isSidebarOpen:v,setSidebarOpen:f}),(0,m.jsxs)("div",{className:"flex flex-grow",children:[(0,m.jsx)(d.A,{isSidebarOpen:v}),(0,m.jsxs)("main",{className:"flex-grow p-6 overflow-auto",children:[(0,m.jsxs)("header",{className:"flex justify-between items-center mb-6 bg-white p-4 rounded shadow",children:[(0,m.jsxs)("div",{children:[(0,m.jsx)("h1",{className:"text-2xl font-bold",children:a?"Edit Warehouse":"Add Warehouse"}),(0,m.jsx)("p",{className:"text-gray-600",children:a?"Update details":"Fill in details"})]}),(0,m.jsxs)("nav",{className:"text-gray-500 text-sm",children:[(0,m.jsxs)("a",{href:"/dashboard",className:"flex items-center",children:[(0,m.jsx)(r.$BV,{className:"mr-1"})," Home"]}),(0,m.jsx)(l.XWt,{className:"mx-2"}),(0,m.jsx)("a",{href:"/warehouse-list",children:"Warehouse List"})]})]}),(0,m.jsxs)("form",{onSubmit:async t=>{if(t.preventDefault(),!I.terminalId&&!I.tid.trim())return alert("Either choose a Terminal or enter a new TID");g(!0);try{const t=new FormData;Object.entries(I).forEach((e=>{let[a,s]=e;return null!==s&&t.append(a,s)})),null!=q&&t.append("Latitude",q),null!=G&&t.append("Longitude",G),k&&t.append("qrCode",k),a?(await n.A.put(`api/warehouses/${a}`,t,{headers:p}),alert("Warehouse updated!")):(await n.A.post("api/warehouses",t,{headers:p}),alert("Warehouse created!")),e("/warehouse-list")}catch(r){var s,l;console.error(r),alert((null===(s=r.response)||void 0===s||null===(l=s.data)||void 0===l?void 0:l.message)||r.message)}finally{g(!1)}},className:"bg-white p-6 rounded shadow space-y-4",children:[[{label:"Name*",name:"warehouseName",req:!0},{label:"Mobile",name:"mobile"},{label:"Email",name:"email",type:"email"}].map((e=>(0,m.jsxs)("div",{className:"flex items-center",children:[(0,m.jsx)("label",{className:"w-40 font-semibold",children:e.label}),(0,m.jsx)("input",{className:"flex-grow p-2 border rounded",name:e.name,type:e.type||"text",required:e.req,value:I[e.name],onChange:$})]},e.name))),(0,m.jsxs)("div",{className:"flex items-center",children:[(0,m.jsx)("label",{className:"w-40 font-semibold",children:"Status"}),(0,m.jsxs)("select",{name:"status",value:I.status,onChange:$,className:"flex-grow p-2 border rounded",children:[(0,m.jsx)("option",{children:"Active"}),(0,m.jsx)("option",{children:"Restricted"}),(0,m.jsx)("option",{children:"Inactive"})]})]}),"admin"===h&&(0,m.jsxs)("div",{className:"flex items-center",children:[(0,m.jsx)("label",{className:"w-40 font-semibold",children:"Store"}),(0,m.jsxs)("select",{name:"store",required:!0,value:I.store,onChange:$,className:"flex-grow p-2 border rounded",children:[(0,m.jsx)("option",{value:"",children:"Select Store"}),j.map((e=>(0,m.jsx)("option",{value:e._id,children:e.StoreName},e._id)))]})]}),(0,m.jsxs)("div",{className:"flex items-center",children:[(0,m.jsx)("label",{className:"w-40 font-semibold",children:"Cash Account"}),(0,m.jsxs)("select",{name:"cashAccount",value:I.cashAccount,onChange:$,className:"flex-grow p-2 border rounded",children:[(0,m.jsx)("option",{value:"",children:"Auto-create (recommended)"}),B.map((e=>(0,m.jsxs)("option",{value:e._id,children:[e.accountNumber," \u2013 ",e.accountName]},e._id)))]})]}),(0,m.jsxs)("div",{className:"flex items-center",children:[(0,m.jsx)("label",{className:"w-40 font-semibold",children:"Terminal"}),(0,m.jsxs)("select",{name:"terminalId",value:I.terminalId,onChange:$,className:"flex-grow p-2 border rounded",children:[(0,m.jsx)("option",{value:"",children:"Create New"}),S.map((e=>(0,m.jsx)("option",{value:e._id,children:e.tid},e._id)))]})]}),!I.terminalId&&(0,m.jsxs)("div",{className:"flex items-center",children:[(0,m.jsx)("label",{className:"w-40 font-semibold",children:"New TID*"}),(0,m.jsx)("input",{name:"tid",required:!0,value:I.tid,onChange:$,className:"flex-grow p-2 border rounded",placeholder:"e.g. TID-12345"})]}),(0,m.jsxs)("div",{className:"flex items-center",children:[(0,m.jsx)("label",{className:"w-40 font-semibold",children:"QR Code"}),(0,m.jsx)("input",{type:"file",accept:"image/*",onChange:e=>_(e.target.files[0]||null),className:"flex-grow p-2 border rounded"})]}),(0,m.jsxs)("div",{className:"flex items-center",children:[(0,m.jsx)("label",{className:"w-40 font-semibold",children:"Location"}),(0,m.jsx)("button",{type:"button",onClick:()=>alert(T?"Fetching location...":"Geolocation unavailable"),className:"px-4 py-2 bg-blue-500 text-white rounded",children:"Get Current"})]}),(0,m.jsxs)("div",{className:"text-center pt-6 space-x-4",children:[(0,m.jsx)("button",{className:"px-8 py-2 bg-green-600 text-white rounded hover:bg-green-700",children:a?"Update":"Save"}),(0,m.jsx)("button",{type:"button",onClick:()=>e("/warehouse-list"),className:"px-8 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",children:"Cancel"})]})]})]})]})]})}}}]);
//# sourceMappingURL=5233.890297c2.chunk.js.map