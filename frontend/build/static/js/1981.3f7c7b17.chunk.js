(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[1981],{14840:(e,t,a)=>{"use strict";a.d(t,{A:()=>i});var s=a(65043),r=a(21197),n=a(59255),l=a(70579);function i(){const[e,t]=(0,s.useState)(!1);return(0,l.jsxs)("div",{className:"flex flex-col h-screen",children:[(0,l.jsx)(r.A,{isSidebarOpen:e,setSidebarOpen:t}),(0,l.jsxs)("div",{className:"flex flex-grow mt-20",children:[(0,l.jsx)("div",{children:(0,l.jsx)(n.A,{isSidebarOpen:e})}),(0,l.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-white/80 backdrop-blur-sm",children:(0,l.jsxs)("div",{className:"flex flex-col items-center",children:[(0,l.jsx)("div",{className:"w-12 h-12 border-4 rounded-full border-cyan-500 border-t-transparent animate-spin"}),(0,l.jsx)("p",{className:"mt-3 text-lg font-semibold text-gray-700",children:"Loading..."})]})})]})]})}},45922:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>$});var s=a(65043),r=a(49804),n=a(60184),l=a(21197),i=a(59255),o=a(66727),c=a(86213),d=a(26873),u=a(83910),m=a(97929),h=a(31782),p=a(14840),x=a(60446),v=a.n(x),f=a(70579);const b=e=>t=>{var a;return{label:t[e],value:null!==(a=t._id)&&void 0!==a?a:t[e]}};function y(e){let{open:t,onClose:a,onCreated:r}=e;const n={supplierName:"",email:"",mobile:"",phone:"",address:"",city:"",state:"",country:"",postcode:"",gstNumber:"",taxNumber:"",openingBalance:0,previousBalance:0,purchaseDue:0,purchaseReturnDue:0,status:"Active"},[l,i]=(0,s.useState)(n),[o,u]=(0,s.useState)([]),[m,h]=(0,s.useState)([]),[p,x]=(0,s.useState)(!1),[v,y]=(0,s.useState)("");if((0,s.useEffect)((()=>{if(!t)return;i(n),y("");const e={headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}};Promise.all([c.A.get("api/countries",e),c.A.get("api/states",e)]).then((e=>{let[t,a]=e;u((t.data.data||[]).filter((e=>"active"===e.status)).map(b("countryName"))),h((a.data.data||[]).filter((e=>"active"===e.status)).map(b("stateName")))})).catch((e=>y("Failed to load country/state lists")))}),[t]),(0,s.useEffect)((()=>{if(!t)return;const e=e=>"Escape"===e.key&&a();return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)}),[t,a]),!t)return null;const g=e=>i({...l,[e.target.name]:"number"===e.target.type?Number(e.target.value):e.target.value});return(0,f.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center\r bg-black bg-opacity-50",onClick:a,children:(0,f.jsxs)("form",{onClick:e=>e.stopPropagation(),onSubmit:async e=>{e.preventDefault(),x(!0),y("");try{const{data:e}=await c.A.post("api/suppliers",l,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}});null===r||void 0===r||r(e.data||e),a()}catch(n){var t,s;y((null===(t=n.response)||void 0===t||null===(s=t.data)||void 0===s?void 0:s.message)||n.message||"Save failed")}finally{x(!1)}},className:"max-h-[95vh] w-full max-w-3xl overflow-y-auto\r rounded-lg bg-white p-6 shadow-lg",children:[(0,f.jsx)("h2",{className:"mb-4 text-xl font-semibold text-center",children:"Add Supplier"}),(0,f.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,f.jsxs)("div",{children:[(0,f.jsx)("label",{className:"mb-1 block text-sm font-medium",children:"Supplier Name *"}),(0,f.jsx)("input",{required:!0,name:"supplierName",value:l.supplierName,onChange:g,className:"w-full rounded border px-3 py-2"})]}),(0,f.jsxs)("div",{children:[(0,f.jsx)("label",{className:"mb-1 block text-sm",children:"Email"}),(0,f.jsx)("input",{type:"email",name:"email",value:l.email,onChange:g,className:"w-full rounded border px-3 py-2"})]})]}),(0,f.jsxs)("div",{className:"mt-4 grid gap-4 md:grid-cols-2",children:[(0,f.jsxs)("div",{children:[(0,f.jsx)("label",{className:"mb-1 block text-sm",children:"Mobile"}),(0,f.jsx)("input",{name:"mobile",value:l.mobile,onChange:g,className:"w-full rounded border px-3 py-2"})]}),(0,f.jsxs)("div",{children:[(0,f.jsx)("label",{className:"mb-1 block text-sm",children:"Phone"}),(0,f.jsx)("input",{name:"phone",value:l.phone,onChange:g,className:"w-full rounded border px-3 py-2"})]})]}),(0,f.jsxs)("div",{className:"mt-4",children:[(0,f.jsx)("label",{className:"mb-1 block text-sm",children:"Address"}),(0,f.jsx)("textarea",{name:"address",rows:"2",value:l.address,onChange:g,className:"w-full rounded border px-3 py-2"})]}),(0,f.jsxs)("div",{className:"mt-4 grid gap-4 md:grid-cols-2",children:[(0,f.jsxs)("div",{children:[(0,f.jsx)("label",{className:"mb-1 block text-sm",children:"City"}),(0,f.jsx)("input",{name:"city",value:l.city,onChange:g,className:"w-full rounded border px-3 py-2"})]}),(0,f.jsxs)("div",{children:[(0,f.jsx)("label",{className:"mb-1 block text-sm",children:"Postcode"}),(0,f.jsx)("input",{name:"postcode",value:l.postcode,onChange:g,className:"w-full rounded border px-3 py-2"})]})]}),(0,f.jsxs)("div",{className:"mt-4 grid gap-4 md:grid-cols-2",children:[(0,f.jsxs)("div",{children:[(0,f.jsx)("label",{className:"mb-1 block text-sm",children:"Country"}),(0,f.jsx)(d.Ay,{options:o,value:o.find((e=>e.value===l.country))||null,onChange:e=>i({...l,country:(null===e||void 0===e?void 0:e.value)||""}),placeholder:"Select country"})]}),(0,f.jsxs)("div",{children:[(0,f.jsx)("label",{className:"mb-1 block text-sm",children:"State"}),(0,f.jsx)(d.Ay,{options:m,value:m.find((e=>e.value===l.state))||null,onChange:e=>i({...l,state:(null===e||void 0===e?void 0:e.value)||""}),placeholder:"Select state"})]})]}),(0,f.jsxs)("div",{className:"mt-4 grid gap-4 md:grid-cols-2",children:[(0,f.jsxs)("div",{children:[(0,f.jsx)("label",{className:"mb-1 block text-sm",children:"GST Number"}),(0,f.jsx)("input",{name:"gstNumber",value:l.gstNumber,onChange:g,className:"w-full rounded border px-3 py-2"})]}),(0,f.jsxs)("div",{children:[(0,f.jsx)("label",{className:"mb-1 block text-sm",children:"Tax Number"}),(0,f.jsx)("input",{name:"taxNumber",value:l.taxNumber,onChange:g,className:"w-full rounded border px-3 py-2"})]})]}),(0,f.jsxs)("div",{className:"mt-4 grid gap-4 md:grid-cols-2",children:[(0,f.jsxs)("div",{children:[(0,f.jsx)("label",{className:"mb-1 block text-sm",children:"Opening Balance"}),(0,f.jsx)("input",{type:"number",min:"0",name:"openingBalance",value:l.openingBalance,onChange:g,className:"w-full rounded border px-3 py-2"})]}),(0,f.jsxs)("div",{children:[(0,f.jsx)("label",{className:"mb-1 block text-sm",children:"Previous Balance"}),(0,f.jsx)("input",{type:"number",min:"0",name:"previousBalance",value:l.previousBalance,onChange:g,className:"w-full rounded border px-3 py-2"})]})]}),(0,f.jsxs)("div",{className:"mt-4 grid gap-4 md:grid-cols-2",children:[(0,f.jsxs)("div",{children:[(0,f.jsx)("label",{className:"mb-1 block text-sm",children:"Purchase Due"}),(0,f.jsx)("input",{type:"number",min:"0",name:"purchaseDue",value:l.purchaseDue,onChange:g,className:"w-full rounded border px-3 py-2"})]}),(0,f.jsxs)("div",{children:[(0,f.jsx)("label",{className:"mb-1 block text-sm",children:"Purchase Return Due"}),(0,f.jsx)("input",{type:"number",min:"0",name:"purchaseReturnDue",value:l.purchaseReturnDue,onChange:g,className:"w-full rounded border px-3 py-2"})]})]}),(0,f.jsxs)("div",{className:"mt-4",children:[(0,f.jsx)("label",{className:"mb-1 block text-sm",children:"Status"}),(0,f.jsxs)("select",{name:"status",value:l.status,onChange:g,className:"w-full rounded border px-3 py-2",children:[(0,f.jsx)("option",{value:"Active",children:"Active"}),(0,f.jsx)("option",{value:"Inactive",children:"Inactive"})]})]}),v&&(0,f.jsx)("p",{className:"mt-4 rounded border border-red-300 bg-red-100 px-3 py-2 text-sm text-red-700",children:v}),(0,f.jsxs)("div",{className:"mt-6 flex justify-end gap-3",children:[(0,f.jsx)("button",{type:"button",onClick:a,className:"rounded bg-gray-200 px-4 py-2 text-gray-700 hover:bg-gray-300",children:"Cancel"}),(0,f.jsx)("button",{disabled:p,className:"rounded bg-emerald-600 px-6 py-2 text-white hover:bg-emerald-700 disabled:opacity-60",children:p?"Saving\u2026":"Save"})]})]})})}function g(e){let{open:t,onClose:a,onSave:r,init:n}=e;const[l,i]=(0,s.useState)(""),[o,c]=(0,s.useState)("kg"),[d,u]=(0,s.useState)("");return(0,s.useEffect)((()=>{var e,t,a;n&&(i(String(null!==(e=n.bulkQty)&&void 0!==e?e:"")),c(null!==(t=n.bulkUnit)&&void 0!==t?t:"kg"),u(String(null!==(a=n.bulkCost)&&void 0!==a?a:"")))}),[n]),t?(0,f.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:(0,f.jsxs)("div",{className:"bg-white w-80 rounded-md shadow p-6",children:[(0,f.jsx)("h2",{className:"text-lg font-semibold mb-4",children:n?"Edit Raw Material":"Add Raw Material"}),(0,f.jsx)("label",{className:"block text-sm mb-1",children:"Bulk Quantity"}),(0,f.jsx)("input",{type:"number",min:"0.01",step:"0.01",value:l,onChange:e=>i(e.target.value),className:"w-full border px-2 py-1 mb-3"}),(0,f.jsx)("label",{className:"block text-sm mb-1",children:"Unit (kg/ltr\u2026)"}),(0,f.jsx)("input",{type:"text",value:o,onChange:e=>c(e.target.value),className:"w-full border px-2 py-1 mb-3"}),(0,f.jsx)("label",{className:"block text-sm mb-1",children:"Total Cost (\u20b9)"}),(0,f.jsx)("input",{type:"number",min:"0.01",step:"0.01",value:d,onChange:e=>u(e.target.value),className:"w-full border px-2 py-1 mb-6"}),(0,f.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,f.jsx)("button",{onClick:a,className:"px-4 py-1 bg-gray-300 rounded",children:"Cancel"}),(0,f.jsx)("button",{onClick:()=>r({bulkQty:Number(l),bulkUnit:o.trim()||"kg",bulkCost:Number(d)}),disabled:!l||!d,className:"px-4 py-1 bg-green-600 text-white rounded disabled:opacity-40",children:"Save"})]})]})}):null}const N=function(e,t,a,s,r){var n,l;let i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;if(("mrp"===t||"purchasePrice"===t||"salesPrice"===t)&&""===a)return void r((a=>{const s=[...a.items];return s[e]={...s[e],[t]:""},{...a,items:s}}));const o=(null===(n=s.items[e])||void 0===n?void 0:n.mrp)||0,c=(null===(l=s.items[e])||void 0===l?void 0:l.purchasePrice)||0;let d=a;if("quantity"===t&&i){var u;const t=Number(null===(u=s.items[e])||void 0===u?void 0:u.quantity)||1;d="increment"===i?t+1:Math.max(1,t-1)}else"salesPrice"===t&&Number(a)>c?(alert(`Sorry, the Sales Price cannot exceed the Cost Price (${c}).`),d=c):("salesPrice"===t||"purchasePrice"===t)&&Number(a)>o?(alert(`Sorry, the ${"salesPrice"===t?"Sales Price":"Cost Price"} cannot exceed the MRP (${o}).`),d=o):d="expiryDate"===t?a:Number(a)||0;r((a=>{const s=[...a.items];return s[e]={...s[e],[t]:"expiryDate"===t?d:Number(d)||0,totalAmount:"quantity"===t||"purchasePrice"===t||"discount"===t?(Number("quantity"===t?d:s[e].quantity)||1)*(Number("purchasePrice"===t?d:s[e].purchasePrice)||0)-(Number("discount"===t?d:s[e].discount)||0):s[e].totalAmount},{...a,items:s}}))},j=new Audio("/sounds/beep-new.mp3"),w=new Audio("/sounds/beep-repeat.mp3");function S(e){try{e.pause(),e.currentTime=0,e.play()}catch{}}const $=()=>{var e,t,a;const[x]=(0,o.ok)(),b=x.get("id"),[$,k]=(0,s.useState)(0),[C,A]=(0,s.useState)(0),[D,P]=(0,s.useState)(!1),[I,M]=(0,s.useState)("amount"),[T,O]=(0,s.useState)(0),[_,E]=(0,s.useState)(0),[B,Y]=(0,s.useState)(!0),[q,z]=(0,s.useState)(""),[R,L]=(0,s.useState)([]),[W,F]=(0,s.useState)([]),[U,H]=(0,s.useState)(0),[Q,V]=(0,s.useState)(!1),[Z,J]=(0,s.useState)(!1),G=(0,s.useRef)(null),[K,X]=(0,s.useState)(null),ee=localStorage.getItem("token")||"",te={headers:{Authorization:`Bearer ${ee}`}},[ae,se]=(0,s.useState)({}),[re,ne]=(0,s.useState)({open:!1,rowIdx:null});(0,s.useEffect)((()=>{(async()=>{try{const{data:e}=await c.A.get("/api/items",te),t={};(e.data||[]).forEach((e=>{var a;const s=e.parentItemId||e._id;t[s]||(t[s]=null===(a=e.warehouse)||void 0===a?void 0:a._id)})),se(t)}catch(e){console.error("Owner-map fetch failed:",e)}})()}),[]);const[le,ie]=(0,s.useState)({warehouse:[],items:[],suppliers:[],accounts:[],paymentType:[],terminals:[]}),[oe,ce]=(0,s.useState)({discountOnAll:0,grandTotal:0,items:[],note:"",otherCharges:0,payments:[{account:null,amount:0,paymentNote:"",paymentType:null,terminal:null}],purchaseCode:"",purchaseDate:(new Date).toLocaleDateString("en-CA"),referenceNo:"",supplier:null,warehouse:null,createdBy:"",createdByModel:""}),de=(0,o.Zp)(),ue=(0,s.useRef)(null),me=(0,s.useRef)(null);(0,s.useEffect)((()=>{if(G.current){if(G.current!==oe.warehouse){var e;const t=me.current;null!==t&&void 0!==t&&t.stopStreams&&t.stopStreams(),null!==(e=ue.current)&&void 0!==e&&e.srcObject&&ue.current.srcObject.getTracks().forEach((e=>e.stop())),V(!1),ie((e=>({...e,items:[]}))),ce((e=>({...e,items:[]})))}G.current=oe.warehouse}else G.current=oe.warehouse}),[oe.warehouse]),(0,s.useEffect)((()=>{(async()=>{try{var e;const t=localStorage.getItem("token");if(!t)return void de("/");const a="admin"===localStorage.getItem("role")?"/auth/profile":"/admiaddinguser/profile",{data:s}=await c.A.get(a,{headers:{Authorization:`Bearer ${t}`}}),r="string"===typeof s.defaultWarehouse?s.defaultWarehouse:null===(e=s.defaultWarehouse)||void 0===e?void 0:e._id;X(r||null)}catch(t){console.error("Profile fetch failed:",t)}})()}),[de]),(0,s.useEffect)((()=>{if(b)return;(async()=>{try{const{data:e}=await c.A.get("/api/purchases",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),t=(e.data||[]).filter((e=>!e.isReturn&&!(e.referenceNo||"").startsWith("BULK/"))),a=(e=>{const t=(new Date).getFullYear();if(!e||"string"!==typeof e)return`PO/${t}/01`;const a=e.split("/");if(3!==a.length||"PO"!==a[0]||!/^\d{4}$/.test(a[1])||isNaN(parseInt(a[2])))return`PO/${t}/01`;const s=parseInt(a[2],10);return`PO/${a[1]}/${String(s+1).padStart(2,"0")}`})(t.length?t[t.length-1].referenceNo:null);ce((e=>({...e,referenceNo:a})))}catch(e){console.error("Error fetching last purchase:",e)}})()}),[b]),(0,s.useEffect)((()=>{window.innerWidth<768&&Y(!1)}),[]);(0,s.useEffect)((()=>{oe.warehouse?(async()=>{P(!0);try{const e=((await c.A.get("/api/items",{headers:{Authorization:`Bearer ${ee}`},params:{warehouse:oe.warehouse,includeZero:1}})).data.data||[]).map((e=>{const t=Boolean(e.parentItemId);return{...e,parentId:t?e.parentItemId:e._id,variantId:t?e._id:null,itemName:t?`${e.itemName} / ${e.variantName||"Variant"}`:e.itemName,barcode:e.barcode||"",barcodes:e.barcodes||[],itemCode:e.itemCode||""}}));L(e)}catch(a){var e,t;alert((null===(e=a.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||a.message),L([])}finally{P(!1)}})():L([])}),[oe.warehouse]);(0,s.useEffect)((()=>{if(!b&&le.warehouse.length)if(K)ce((e=>({...e,warehouse:K})));else{const e=le.warehouse.find((e=>e.isRestricted&&"Active"===e.status));ce((t=>({...t,warehouse:(null===e||void 0===e?void 0:e.value)||le.warehouse[0].value||null})))}}),[le.warehouse,K,b]);(0,s.useEffect)((()=>{const e=q.trim();if(!e||!oe.warehouse)return void F([]);const t=new RegExp(e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"i");F(R.filter((e=>{var a;return t.test(e.itemName)||t.test(e.itemCode)||t.test((null===(a=e.barcodes)||void 0===a?void 0:a.join(" "))||"")})).slice(0,15))}),[q,oe.warehouse,R]);const he=e=>{ce((t=>({...t,[e.target.name]:"number"===e.target.type?Number(e.target.value):e.target.value})))},pe=e=>{ce((t=>({...t,payments:[{...t.payments[0],[e.target.name]:"number"===e.target.type?Number(e.target.value):e.target.value}]})))};(0,s.useEffect)((()=>{const e=((null===oe||void 0===oe?void 0:oe.items)||[]).reduce(((e,t)=>e+((t.quantity||0)*(t.purchasePrice||0)-(t.discount||0))),0);let t=C;"percent"===I&&(t=e*C/100);const a=e+parseFloat($||0)-t;O(e),H(t),E(a>0?a:0),ce((e=>({...e,grandTotal:isNaN(a)?0:a,discountOnAll:t})))}),[oe.items,C,I,$]),(0,s.useEffect)((()=>{ce((e=>({...e,payments:[{...e.payments[0],amount:_}]})))}),[_]),(0,s.useEffect)((()=>{b&&(async()=>{const e=localStorage.getItem("token");if(!e)return console.log("No token found, redirecting..."),void de("/");try{var t,a,s;const r=(await c.A.get(`/api/purchases/${b}`,{headers:{Authorization:`Bearer ${e}`}})).data.data;ce({...r,warehouse:(null===(t=r.warehouse)||void 0===t?void 0:t._id)||r.warehouse,supplier:(null===(a=r.supplier)||void 0===a?void 0:a._id)||r.supplier,purchaseDate:r.purchaseDate?v()(r.purchaseDate).format("YYYY-MM-DD"):(new Date).toLocaleDateString("en-CA"),items:r.items.map((e=>{var t;return{item:(null===(t=e.item)||void 0===t?void 0:t._id)||e.item,variant:e.variant||null,quantity:e.quantity||1,purchasePrice:e.purchasePrice||0,mrp:e.mrp||0,expiryDate:e.expiryDate||"",discount:e.discount||0,salesPrice:e.salesPrice||0,totalAmount:e.totalAmount||e.quantity*e.mrp-e.discount}})),payments:(null===(s=r.payments)||void 0===s?void 0:s.length)>0?r.payments.map((e=>{var t,a,s;return{account:(null===(t=e.account)||void 0===t?void 0:t._id)||e.account,amount:e.amount||0,paymentNote:e.paymentNote||"",paymentType:(null===(a=e.paymentType)||void 0===a?void 0:a._id)||e.paymentType,terminal:(null===(s=e.terminal)||void 0===s?void 0:s._id)||e.terminal}})):[{account:null,amount:0,paymentNote:"",paymentType:null,terminal:null}]}),ie((e=>({...e,items:r.items.map((e=>{var t,a,s,r,n,l;return{...e.item,parentId:(null===(t=e.item)||void 0===t?void 0:t.parentItemId)||(null===(a=e.item)||void 0===a?void 0:a._id),variantId:e.variant||null,itemName:null!==(s=e.item)&&void 0!==s&&s.parentItemId?`${null===(r=e.item)||void 0===r?void 0:r.itemName} / ${(null===(n=e.item)||void 0===n?void 0:n.variantName)||"Variant"}`:null===(l=e.item)||void 0===l?void 0:l.itemName}}))}))),E(r.grandTotal||0),O(r.subtotal||0),H(r.discountOnAll||0),A(r.discountOnAll||0),k(r.otherCharges||0)}catch(l){var r,n;alert((null===(r=l.response)||void 0===r||null===(n=r.data)||void 0===n?void 0:n.message)||l.message)}})(),(async()=>{P(!0);const e=localStorage.getItem("token");if(!e)return console.log("No token found, redirecting..."),void de("/");try{const t=((await c.A.get("/api/warehouses",{headers:{Authorization:`Bearer ${e}`}})).data.data||[]).filter((e=>"Active"===e.status)).map((e=>{var t;return{label:e.warehouseName,value:e._id,cashAccount:(null===(t=e.cashAccount)||void 0===t?void 0:t._id)||e.cashAccount}}));ie((e=>({...e,warehouse:t})))}catch(s){var t,a;alert((null===(t=s.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||s.message)}finally{P(!1)}})(),(async()=>{P(!0);const e=localStorage.getItem("token");if(!e)return console.log("No token found, redirecting..."),void de("/");try{const t=(await c.A.get("/api/suppliers",{headers:{Authorization:`Bearer ${e}`}})).data.data.filter((e=>e.supplierName)).map((e=>({label:e.supplierName,value:e._id})));ie((e=>({...e,suppliers:t})))}catch(s){var t,a;alert((null===(t=s.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||s.message)}finally{P(!1)}})(),(async()=>{P(!0);const e=localStorage.getItem("token");if(!e)return console.log("No token found, redirecting..."),void de("/");try{const t=(await c.A.get("/api/payment-types",{headers:{Authorization:`Bearer ${e}`}})).data.data.map((e=>({label:e.paymentTypeName,value:e._id,name:e.paymentTypeName.toLowerCase()})));ie((e=>({...e,paymentType:t})))}catch(s){var t,a;alert((null===(t=s.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||s.message)}finally{P(!1)}})(),(async()=>{P(!0);const e=localStorage.getItem("token");if(!e)return console.log("No token found, redirecting..."),void de("/");try{const t=(await c.A.get("/api/accounts",{headers:{Authorization:`Bearer ${e}`}})).data.data.map((e=>({label:e.accountNumber,value:e._id})));ie((e=>({...e,accounts:t})))}catch(s){var t,a;alert((null===(t=s.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||s.message)}finally{P(!1)}})(),(async()=>{P(!0);const e=localStorage.getItem("token");if(!e)return console.log("No token found, redirecting..."),void de("/");try{const t=(await c.A.get("/api/terminals",{headers:{Authorization:`Bearer ${e}`}})).data.data.map((e=>{var t;return{label:e.tid,value:e._id,warehouse:(null===(t=e.warehouse)||void 0===t?void 0:t._id)||e.warehouse}}));ie((e=>({...e,terminals:t})))}catch(s){var t,a;alert((null===(t=s.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||s.message)}finally{P(!1)}})()}),[b]);(0,s.useEffect)((()=>()=>{const e=me.current;e&&("function"===typeof e.stopStreams?e.stopStreams():"function"===typeof e.reset&&e.reset())}),[]);const xe=e=>{if(!e)return void console.log("No item selected");const t=oe.items.findIndex((t=>t.item===e.parentId&&(t.variant||null)===(e.variantId||null)));t>=0?(ce((e=>{const a=[...e.items];return a[t]={...a[t],quantity:(a[t].quantity||1)+1,totalAmount:((a[t].quantity||1)+1)*(a[t].mrp||0)-(a[t].discount||0)},{...e,items:a}})),S(w)):(ie((t=>({...t,items:[...t.items||[],{...e,parentId:e.parentId,variantId:e.variantId,itemName:e.itemName}]}))),ce((t=>{var a;return{...t,items:[...t.items||[],{item:e.parentId,variant:e.variantId||null,quantity:1,purchasePrice:e.purchasePrice||0,mrp:e.mrp||0,expiryDate:e.expiryDate||"",discount:"percentage"===(null===(a=e.discountType)||void 0===a?void 0:a.toLowerCase())?e.discount*e.mrp/100:e.discount||0,salesPrice:e.salesPrice||0,totalAmount:1*(e.purchasePrice||0)-(e.discount||0)}]}})),S(j)),z("")},ve=(e,t)=>{ce((a=>({...a,[t]:e?e.value:null})))},fe=e=>t=>{ce((a=>({...a,payments:[{...a.payments[0],[e]:t?t.value:null}]})))},be=le.warehouse.find((e=>e.value===oe.warehouse)),ye=be&&be.cashAccount?le.accounts.filter((e=>e.value===be.cashAccount)):[],ge=null===(e=le.paymentType.find((e=>{var t;return e.value===(null===(t=oe.payments[0])||void 0===t?void 0:t.paymentType)})))||void 0===e?void 0:e.name,Ne="cash"===ge,je="bank"===ge;return D?(0,f.jsx)(p.A,{}):(0,f.jsxs)("div",{className:"flex flex-col h-screen",children:[(0,f.jsx)(l.A,{isSidebarOpen:B,setSidebarOpen:Y}),(0,f.jsxs)("div",{className:"flex",children:[(0,f.jsx)("div",{className:"w-auto",children:(0,f.jsx)(i.A,{isSidebarOpen:B})}),(0,f.jsxs)("div",{className:"overflow-x-auto flex flex-col p-2 md:p-2 min-h-screen w-full",children:[(0,f.jsxs)("header",{className:"flex flex-col items-center justify-between p-4 bg-gray-100 rounded-md shadow sm:flex-row",children:[(0,f.jsxs)("div",{className:"flex items-baseline gap-1 text-center sm:flex-row sm:text-left",children:[(0,f.jsx)("h1",{className:"text-lg font-semibold truncate sm:text-xl",children:"Purchase"}),(0,f.jsx)("span",{className:"text-xs text-gray-600 sm:text-sm",children:"Add/Update Purchase"})]}),(0,f.jsxs)("nav",{className:"flex flex-wrap items-center justify-center mt-2 text-xs text-gray-500 sm:justify-start sm:text-sm sm:mt-0",children:[(0,f.jsxs)(o.N_,{to:"/dashboard",className:"flex items-center text-gray-700 no-underline hover:text-cyan-600",children:[(0,f.jsx)(n.$BV,{className:"mr-2 text-gray-500 hover:text-cyan-600"})," Home"]}),(0,f.jsx)(r.XWt,{className:"mx-1 sm:mx-2"}),(0,f.jsx)(o.N_,{to:"/purchase-list",className:"text-gray-700 no-underline hover:text-cyan-600",children:"Purchase List"}),(0,f.jsx)(r.XWt,{className:"mx-1 sm:mx-2"}),(0,f.jsx)(o.N_,{to:"/purchase-new",className:"text-gray-700 no-underline hover:text-cyan-600",children:"New Purchase"})]})]}),(0,f.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),!oe.warehouse)return void alert("Please select a warehouse.");if(!oe.supplier)return void alert("Please select a supplier.");if(!oe.purchaseDate)return void alert("Please select a purchase date.");if(0===oe.items.length)return void alert("Please add at least one item.");if(oe.grandTotal<=0)return void alert("Grand total must be greater than zero.");if(oe.payments[0].amount>0&&!oe.payments[0].paymentType)return void alert("Please select a payment type.");const t=oe.payments[0];if(t.amount>0&&t.account){const e=await async function(e){const{data:{warehouseId:t}}=await c.A.get(`/api/by-cash-account/${e}`,te),{data:a}=await c.A.get("/api/cash-summary",{...te,params:{warehouseId:t}});return a.liveBalance}(t.account);if(t.amount>e)return void alert(`Insufficient funds. You only have \u20b9${e.toFixed(2)} available.`)}b?(async()=>{P(!0);try{await c.A.put(`/api/purchases/${b}`,oe,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${ee}`}}),alert("Updated Successfully"),de("/purchase-list")}catch(a){var e,t;alert(`Unsuccessful: ${(null===(e=a.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||a.message}`)}finally{P(!1)}})():(async()=>{if(P(!0),!ee)return console.log("No token found, redirecting..."),void de("/");console.log("Sending formData:",JSON.stringify(oe,null,2));try{await c.A.post("/api/purchases",oe,{headers:{Authorization:`Bearer ${ee}`}}),alert("Created Successfully"),de("/purchase-list")}catch(a){var e,t;const s=(null===(e=a.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||a.message;alert(`Unsuccessful: ${s}`),console.error("Error creating purchase:",s)}finally{P(!1)}})()},children:[(0,f.jsxs)("div",{className:"p-2 mt-2 border-t-4 rounded-lg border-cyan-500",children:[(0,f.jsxs)("div",{className:"flex flex-col mb-2 sm:flex-row",children:[(0,f.jsxs)("label",{className:"block mt-2 mb-1 text-sm font-medium",children:["Warehouse ",(0,f.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,f.jsx)("div",{className:"flex items-center w-full mt-2 border rounded sm:mt-0 sm:ml-4 sm:w-64",children:(0,f.jsx)(d.Ay,{className:"w-full",options:le.warehouse,onChange:e=>ve(e,"warehouse"),value:le.warehouse.find((e=>e.value===oe.warehouse))||null,placeholder:"Select Warehouse"})})]}),(0,f.jsxs)("div",{className:"flex flex-col mb-4 sm:flex-row",children:[(0,f.jsxs)("label",{className:"block mt-2 mb-1 text-sm font-medium",children:["Supplier Name ",(0,f.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,f.jsxs)("div",{className:"flex items-center w-full mt-2 border rounded sm:mt-0 sm:ml-4 sm:w-64",children:[(0,f.jsx)(d.Ay,{className:"w-full",options:le.suppliers,onChange:e=>ve(e,"supplier"),value:le.suppliers.find((e=>e.value===oe.supplier))||null,placeholder:"Select Supplier"}),(0,f.jsx)("span",{onClick:()=>J(!0),title:"Add new supplier",className:"px-3 py-[6px] text-lg font-bold text-blue-600 border-l cursor-pointer hover:bg-gray-100",children:"+"})]})]}),(0,f.jsxs)("div",{className:"flex flex-col mb-2 sm:flex-row",children:[(0,f.jsx)("label",{className:"block mt-2 mb-1 text-sm font-medium",children:"Reference No."}),(0,f.jsx)("input",{type:"text",name:"referenceNo",value:oe.referenceNo,readOnly:!0,className:"w-full px-3 py-2 mt-2 border rounded bg-gray-100 sm:w-64 sm:mt-0 sm:ml-7",placeholder:"Auto-generated"})]}),(0,f.jsxs)("div",{className:"flex flex-col mb-2 sm:flex-row",children:[(0,f.jsx)("label",{className:"block mt-2 mb-1 text-sm font-medium",children:"Purchase Date"}),(0,f.jsx)("input",{type:"date",name:"purchaseDate",onChange:he,className:"w-full px-3 py-2 mt-2 border rounded sm:w-64 sm:mt-0 sm:ml-6",required:!0,value:oe.purchaseDate?v()(oe.purchaseDate).format("YYYY-MM-DD"):""})]})]}),(0,f.jsxs)("div",{className:"relative flex justify-center p-2 border-t-2 border-gray-500 rounded-lg",children:[(0,f.jsx)(n.SCC,{className:"w-12 h-10 mt-2 mr-2 text-gray-500 hover:text-cyan-600"}),(0,f.jsx)("input",{type:"text",name:"items",value:q,onChange:e=>{const t=e.target.value;z(t);const a=R.find((e=>{var a,s;return(null===(a=e.warehouse)||void 0===a?void 0:a._id)===oe.warehouse&&(null===(s=e.barcodes)||void 0===s?void 0:s.includes(t))}));a&&(xe(a),z(""))},onKeyDown:e=>{"Enter"===e.key&&e.preventDefault()},placeholder:"Item name/Barcode/Item code",className:"w-full h-10 p-2 mt-2 border sm:w-96",disabled:!oe.warehouse}),(0,f.jsx)("button",{type:"button",onClick:()=>{const e=W[0];e&&xe(e)},disabled:!q||!oe.warehouse,className:"ml-2 px-4 py-2 text-white "+(q&&oe.warehouse?"bg-green-600 hover:bg-green-700":"bg-gray-400 cursor-not-allowed"),children:"Add"}),(0,f.jsx)("button",{type:"button",onClick:async()=>{if(!oe.warehouse)return void alert("Please select a warehouse to scan items.");z(""),V(!0),P(!0);const e=new h.sx;me.current=e;try{const t=await e.listVideoInputDevices();if(!t.length)throw new Error("No camera found");const a=t[0].deviceId,s=await e.decodeOnceFromVideoDevice(a,ue.current),r=ue.current.srcObject;r&&(r.getTracks().forEach((e=>e.stop())),ue.current.srcObject=null);const n=s.getText(),l=R.find((e=>{var t,a;return(null===(t=e.warehouse)||void 0===t?void 0:t._id)===oe.warehouse&&(e.itemCode===n||(null===(a=e.barcodes)||void 0===a?void 0:a.includes(n)))}));l?xe(l):alert("Scanned code not found in this warehouse.")}catch(t){console.error("Scanner error:",t),alert("Scanner failed: "+t.message)}finally{V(!1),P(!1)}},disabled:!oe.warehouse,className:"ml-2 p-2 rounded-full "+(oe.warehouse?"bg-blue-500 hover:bg-blue-600 text-white":"bg-gray-400 text-gray-600 cursor-not-allowed"),children:(0,f.jsx)(u.g,{icon:m.rwq,className:"w-5 h-5"})}),!oe.warehouse&&(0,f.jsx)("p",{className:"mt-2 text-sm text-red-500",children:"Please select a warehouse to add items."}),Q&&(0,f.jsxs)("div",{className:"fixed inset-0 z-50 flex flex-col items-center justify-center bg-black bg-opacity-70",children:[(0,f.jsx)("div",{className:"w-72 h-72 border-4 border-white rounded-lg overflow-hidden",children:(0,f.jsx)("video",{ref:ue,className:"object-cover w-full h-full",autoPlay:!0,muted:!0,playsInline:!0})}),(0,f.jsx)("button",{onClick:()=>{const e=me.current;null!==e&&void 0!==e&&e.stopStreams&&e.stopStreams(),V(!1)},className:"px-4 py-2 mt-6 text-white bg-red-600 rounded hover:bg-red-700",children:"Cancel"})]}),q&&W.length>0&&(0,f.jsx)("div",{className:"absolute z-50 w-full bg-white border rounded-lg shadow-lg top-20 sm:w-96 max-h-60 overflow-y-auto",children:(0,f.jsx)("ul",{children:W.map((e=>{var t;return(0,f.jsxs)("li",{onClick:()=>xe(e),className:"p-2 cursor-pointer hover:bg-gray-100",children:[(0,f.jsx)("strong",{children:e.itemCode})," - ",e.itemName,(null===(t=e.barcodes)||void 0===t?void 0:t.length)>0&&(0,f.jsxs)("span",{className:"text-gray-500",children:[" (",e.barcodes[0],")"]})]},e._id)}))})}),q&&0===W.length&&(0,f.jsx)("p",{className:"mt-2 text-sm text-gray-500",children:"No items found for the selected warehouse."})]}),(0,f.jsx)("div",{className:"mt-4 overflow-x-auto border-b-2 border-gray-500 rounded-lg max-h-96",children:(0,f.jsxs)("table",{className:"w-full min-w-[1200px] border border-gray-300 text-sm",children:[(0,f.jsx)("thead",{children:(0,f.jsxs)("tr",{className:"text-center text-white bg-sky-600",children:[(0,f.jsx)("th",{className:"p-3 text-base font-semibold border",children:"Item Name"}),(0,f.jsx)("th",{className:"p-3 text-base font-semibold border",children:"Quantity"}),(0,f.jsx)("th",{className:"p-3 text-base font-semibold border",children:"MRP"}),(0,f.jsx)("th",{className:"p-3 text-base font-semibold border",children:"Expiry Date"}),(0,f.jsx)("th",{className:"p-3 text-base font-semibold border",children:"Purchas Price"}),(0,f.jsx)("th",{className:"p-3 text-base font-semibold border",children:"Discount (\u20b9)"}),(0,f.jsx)("th",{className:"p-3 text-base font-semibold border",children:"Sales Price"}),(0,f.jsx)("th",{className:"p-3 text-base font-semibold border",children:"Total Amount"}),(0,f.jsx)("th",{className:"p-3 text-base font-semibold border",children:"Action"})]})}),(0,f.jsx)("tbody",{children:0===le.items.length?(0,f.jsx)("tr",{children:(0,f.jsx)("td",{colSpan:"9",className:"p-4 text-center border text-base",children:"No items added"})}):le.items.map(((e,t)=>{var a,s,r,n,l,i,o,c,d,u,m,h,p,x;return(0,f.jsxs)("tr",{className:"text-center",children:[(0,f.jsx)("td",{className:"p-3 border text-base",children:e.itemName||"N/A"}),(0,f.jsx)("td",{className:"p-3 border",children:(0,f.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,f.jsx)("button",{type:"button",onClick:()=>N(t,"quantity",null,oe,ce,"decrement"),className:"w-8 h-8 bg-gray-200 rounded hover:bg-gray-300 text-lg",children:"-"}),(0,f.jsx)("input",{type:"number",min:"1",value:(null===(a=oe.items[t])||void 0===a?void 0:a.quantity)||1,onChange:e=>N(t,"quantity",e.target.value,oe,ce),className:"w-24 px-2 py-1 border rounded text-center text-base",style:{MozAppearance:"textfield"}}),(0,f.jsx)("button",{type:"button",onClick:()=>N(t,"quantity",null,oe,ce,"increment"),className:"w-8 h-8 bg-gray-200 rounded hover:bg-gray-300 text-lg",children:"+"})]})}),(0,f.jsx)("td",{className:"p-3 border",children:(0,f.jsx)("input",{type:"number",min:"0",step:"any",value:null!==(s=null===(r=oe.items[t])||void 0===r?void 0:r.mrp)&&void 0!==s?s:"",onChange:e=>N(t,"mrp",e.target.value,oe,ce),className:"w-24 px-2 py-1 border rounded text-center text-base"})}),(0,f.jsx)("td",{className:"p-3 border",children:(0,f.jsx)("input",{type:"date",value:null!==(n=oe.items[t])&&void 0!==n&&n.expiryDate?v()(oe.items[t].expiryDate).format("YYYY-MM-DD"):"",onChange:e=>N(t,"expiryDate",e.target.value,oe,ce),className:"w-32 px-2 py-1 border rounded text-base"})}),(0,f.jsx)("td",{className:"p-3 border",children:(0,f.jsx)("input",{type:"number",min:"0",step:"any",value:null!==(l=null===(i=oe.items[t])||void 0===i?void 0:i.purchasePrice)&&void 0!==l?l:"",onChange:e=>N(t,"purchasePrice",e.target.value,oe,ce),className:"w-24 px-2 py-1 border rounded text-center text-base"})}),(0,f.jsx)("td",{className:"p-3 border",children:(0,f.jsx)("input",{type:"number",min:"0",value:(null===(o=oe.items[t])||void 0===o?void 0:o.discount)||0,onChange:e=>N(t,"discount",e.target.value,oe,ce),className:"w-24 px-2 py-1 border rounded text-center text-base"})}),(0,f.jsx)("td",{className:"p-3 border",children:(0,f.jsx)("input",{type:"number",step:"1",min:"0",value:null!==(c=null===(d=oe.items[t])||void 0===d?void 0:d.salesPrice)&&void 0!==c?c:"",onChange:e=>N(t,"salesPrice",e.target.value,oe,ce),className:"w-24 px-2 py-1 border rounded text-center"})}),(0,f.jsx)("td",{className:"p-3 border text-base",children:((null===(u=oe.items[t])||void 0===u?void 0:u.quantity)||1)*((null===(m=oe.items[t])||void 0===m?void 0:m.purchasePrice)||0)-((null===(h=oe.items[t])||void 0===h?void 0:h.discount)||0)}),(0,f.jsx)("td",{className:"p-3 border",children:(0,f.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,f.jsx)("button",{type:"button",className:"text-blue-600 hover:text-blue-800 font-medium",onClick:()=>{return e=t,ie((t=>({...t,items:t.items.filter(((t,a)=>a!==e))}))),void ce((t=>({...t,items:t.items.filter(((t,a)=>a!==e))})));var e},children:"Remove"}),(0,f.jsx)("button",{type:"button",className:`text-sm ${null!==(p=oe.items[t])&&void 0!==p&&p.isRaw?"text-yellow-700 font-semibold":"text-gray-600"} hover:text-yellow-800`,onClick:()=>ne({open:!0,rowIdx:t}),children:null!==(x=oe.items[t])&&void 0!==x&&x.isRaw?"Edit Raw":"Raw Material"})]})})]},t)}))})]})}),(0,f.jsxs)("div",{className:"flex flex-col sm:flex-row",children:[(0,f.jsxs)("div",{className:"mb-2",children:[(0,f.jsxs)("div",{className:"flex gap-5 mt-5 mb-4",children:[(0,f.jsx)("label",{className:"block text-sm font-medium",children:"Total Quantities"}),(0,f.jsx)("p",{className:"text-green-600",children:oe.items.reduce(((e,t)=>e+(t.quantity||0)),0)})]}),(0,f.jsxs)("div",{className:"flex gap-5 mb-4",children:[(0,f.jsx)("label",{className:"block text-sm font-medium",children:"Other Charges"}),(0,f.jsx)("input",{type:"number",min:"0",name:"otherCharges",value:oe.otherCharges,onChange:e=>{he(e),k(e.target.value)},className:"w-full px-3 py-2 ml-2 border rounded sm:w-64",placeholder:"Enter other charges"})]}),(0,f.jsxs)("div",{className:"flex gap-5 mb-4",children:[(0,f.jsx)("label",{className:"block text-sm font-medium",children:"Discount on All"}),(0,f.jsxs)("div",{className:"flex gap-1",children:[(0,f.jsx)("input",{type:"number",min:"0",name:"discountOnAll",value:C,onChange:e=>{he(e),A(e.target.value)},className:"w-full px-2 py-2 border rounded sm:w-32",placeholder:"Enter discount"}),(0,f.jsxs)("select",{value:I,onChange:e=>M(e.target.value),className:"w-32 px-2 border rounded",children:[(0,f.jsx)("option",{value:"percent",children:"Per%"}),(0,f.jsx)("option",{value:"amount",children:"Amount"})]})]})]}),(0,f.jsxs)("div",{className:"flex gap-20 mt-2 mb-2",children:[(0,f.jsx)("label",{className:"block text-sm font-medium",children:"Note"}),(0,f.jsx)("textarea",{value:oe.note,name:"note",onChange:he,className:"w-full h-16 px-3 py-2 border rounded sm:w-64 ml-9",rows:"3",placeholder:"Add a note"})]})]}),(0,f.jsxs)("div",{className:"pt-4 mt-4 ml-0 border-t sm:ml-40 sm:w-1/2",children:[(0,f.jsxs)("div",{className:"flex gap-16 font-bold",children:[(0,f.jsx)("span",{children:"Subtotal"}),(0,f.jsxs)("span",{children:["\u20b9 ",T.toFixed(2)]})]}),(0,f.jsxs)("div",{className:"flex gap-4 font-bold",children:[(0,f.jsx)("span",{children:"Other Charges"}),(0,f.jsxs)("span",{children:["\u20b9 ",parseFloat(oe.otherCharges||0).toFixed(2)]})]}),(0,f.jsxs)("div",{className:"flex gap-3 font-bold",children:[(0,f.jsx)("span",{children:"Discount on All"}),(0,f.jsxs)("span",{children:["\u20b9 ",parseFloat(U||0).toFixed(2)]})]}),(0,f.jsxs)("div",{className:"flex gap-5 font-bold",children:[(0,f.jsx)("span",{children:"Grand Total"}),(0,f.jsxs)("span",{children:["\u20b9 ",_.toFixed(2)]})]})]})]}),(0,f.jsxs)("div",{className:"mt-6",children:[(0,f.jsx)("h2",{className:"mb-4 text-base font-semibold text-cyan-500",children:"Previous Payments Information :"}),(0,f.jsx)("div",{className:"mb-6 overflow-x-auto",children:(0,f.jsxs)("table",{className:"min-w-full bg-white border border-gray-300",children:[(0,f.jsx)("thead",{className:"bg-gray-200",children:(0,f.jsxs)("tr",{children:[(0,f.jsx)("th",{className:"px-2 py-2 border",children:"#"}),(0,f.jsx)("th",{className:"px-2 py-2 border",children:"Date"}),(0,f.jsx)("th",{className:"px-2 py-2 border",children:"Payment Type"}),(0,f.jsx)("th",{className:"px-2 py-2 border",children:"Payment Note"}),(0,f.jsx)("th",{className:"px-2 py-2 border",children:"Action"})]})}),(0,f.jsx)("tbody",{children:(0,f.jsx)("tr",{children:(0,f.jsx)("td",{className:"px-4 py-2 text-center border",colSpan:"5",children:"Payments Pending!!"})})})]})}),(0,f.jsx)("h2",{className:"mb-4 text-base font-semibold text-cyan-500",children:"Make Payment :"}),(0,f.jsxs)("div",{className:"p-2 mb-6 bg-white rounded shadow-md",children:[(0,f.jsxs)("div",{className:"flex items-center gap-4 mb-2",children:[(0,f.jsx)("label",{className:"block w-1/4 text-sm font-medium text-right",children:"Amount"}),(0,f.jsx)("input",{type:"number",min:"0",step:"0.01",value:null===(t=oe.payments[0])||void 0===t?void 0:t.amount,name:"amount",onChange:pe,className:"w-1/2 px-3 py-2 border rounded",placeholder:"Enter Amount"})]}),(0,f.jsxs)("div",{className:"flex items-center gap-4 mb-2",children:[(0,f.jsx)("label",{className:"block w-1/4 text-sm font-medium text-right",children:"Payment Type"}),(0,f.jsx)(d.Ay,{options:le.paymentType,className:"w-1/2",onChange:e=>{fe("paymentType")(e),ce((e=>({...e,payments:[{...e.payments[0],account:null,terminal:null}]})))},value:le.paymentType.find((e=>{var t,a,s;return e.value===((null===(t=oe.payments[0])||void 0===t||null===(a=t.paymentType)||void 0===a?void 0:a._id)||(null===(s=oe.payments[0])||void 0===s?void 0:s.paymentType))}))||null,placeholder:"Select Payment Type"})]}),Ne&&(0,f.jsxs)("div",{className:"flex items-center gap-4 mb-2",children:[(0,f.jsx)("label",{className:"block w-1/4 text-sm font-medium text-right",children:"Account"}),(0,f.jsx)(d.Ay,{options:ye,className:"w-1/2",onChange:fe("account"),value:ye.find((e=>{var t;return e.value===(null===(t=oe.payments[0])||void 0===t?void 0:t.account)}))||null,placeholder:"Select Account"})]}),je&&(0,f.jsxs)("div",{className:"flex items-center gap-4 mb-2",children:[(0,f.jsx)("label",{className:"block w-1/4 text-sm font-medium text-right",children:"Terminal"}),(0,f.jsx)(d.Ay,{options:le.terminals.filter((e=>e.warehouse===oe.warehouse)),className:"w-1/2",onChange:fe("terminal"),value:le.terminals.find((e=>{var t;return e.value===(null===(t=oe.payments[0])||void 0===t?void 0:t.terminal)}))||null,placeholder:"Select Terminal"})]}),(0,f.jsxs)("div",{className:"flex items-center gap-4 mb-2",children:[(0,f.jsx)("label",{className:"block w-1/4 text-sm font-medium text-right",children:"Payment Note"}),(0,f.jsx)("textarea",{name:"paymentNote",value:null===(a=oe.payments[0])||void 0===a?void 0:a.paymentNote,onChange:pe,className:"w-1/2 py-2 border rounded px-3 h-14",rows:"3",placeholder:"Add a payment note"})]})]}),(0,f.jsxs)("div",{className:"flex justify-center gap-4 mt-4",children:[(0,f.jsx)("button",{className:"px-12 py-2 text-white transition duration-200 bg-green-600 hover:bg-green-700",type:"submit",children:b?"Update":"Save"}),(0,f.jsx)("button",{className:"px-12 py-2 text-white transition duration-200 bg-orange-500 hover:bg-orange-600",type:"reset",onClick:()=>de("/purchase-list"),children:"Close"})]})]})]})]})]}),(0,f.jsx)(y,{open:Z,onClose:()=>J(!1),onCreated:e=>{const t={label:e.supplierName,value:e._id};ie((e=>({...e,suppliers:[...e.suppliers,t]}))),ce((t=>({...t,supplier:e._id})))}}),(0,f.jsx)(g,{open:re.open,init:null!=re.rowIdx?oe.items[re.rowIdx]:null,onClose:()=>ne({open:!1,rowIdx:null}),onSave:function(e){let{bulkQty:t,bulkUnit:a,bulkCost:s}=e;ce((e=>{const r=[...e.items],n=r[re.rowIdx];return r[re.rowIdx]={...n,isRaw:!0,bulkQty:t,bulkUnit:a,bulkCost:s,quantity:t,mrp:+(s/t).toFixed(4),purchasePrice:+(s/t).toFixed(4),discount:0,totalAmount:s,salesPrice:0},{...e,items:r}})),ne({open:!1,rowIdx:null})}})]})}},60446:function(e){e.exports=function(){"use strict";var e=1e3,t=6e4,a=36e5,s="millisecond",r="second",n="minute",l="hour",i="day",o="week",c="month",d="quarter",u="year",m="date",h="Invalid Date",p=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,x=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,v={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(e){var t=["th","st","nd","rd"],a=e%100;return"["+e+(t[(a-20)%10]||t[a]||t[0])+"]"}},f=function(e,t,a){var s=String(e);return!s||s.length>=t?e:""+Array(t+1-s.length).join(a)+e},b={s:f,z:function(e){var t=-e.utcOffset(),a=Math.abs(t),s=Math.floor(a/60),r=a%60;return(t<=0?"+":"-")+f(s,2,"0")+":"+f(r,2,"0")},m:function e(t,a){if(t.date()<a.date())return-e(a,t);var s=12*(a.year()-t.year())+(a.month()-t.month()),r=t.clone().add(s,c),n=a-r<0,l=t.clone().add(s+(n?-1:1),c);return+(-(s+(a-r)/(n?r-l:l-r))||0)},a:function(e){return e<0?Math.ceil(e)||0:Math.floor(e)},p:function(e){return{M:c,y:u,w:o,d:i,D:m,h:l,m:n,s:r,ms:s,Q:d}[e]||String(e||"").toLowerCase().replace(/s$/,"")},u:function(e){return void 0===e}},y="en",g={};g[y]=v;var N="$isDayjsObject",j=function(e){return e instanceof k||!(!e||!e[N])},w=function e(t,a,s){var r;if(!t)return y;if("string"==typeof t){var n=t.toLowerCase();g[n]&&(r=n),a&&(g[n]=a,r=n);var l=t.split("-");if(!r&&l.length>1)return e(l[0])}else{var i=t.name;g[i]=t,r=i}return!s&&r&&(y=r),r||!s&&y},S=function(e,t){if(j(e))return e.clone();var a="object"==typeof t?t:{};return a.date=e,a.args=arguments,new k(a)},$=b;$.l=w,$.i=j,$.w=function(e,t){return S(e,{locale:t.$L,utc:t.$u,x:t.$x,$offset:t.$offset})};var k=function(){function v(e){this.$L=w(e.locale,null,!0),this.parse(e),this.$x=this.$x||e.x||{},this[N]=!0}var f=v.prototype;return f.parse=function(e){this.$d=function(e){var t=e.date,a=e.utc;if(null===t)return new Date(NaN);if($.u(t))return new Date;if(t instanceof Date)return new Date(t);if("string"==typeof t&&!/Z$/i.test(t)){var s=t.match(p);if(s){var r=s[2]-1||0,n=(s[7]||"0").substring(0,3);return a?new Date(Date.UTC(s[1],r,s[3]||1,s[4]||0,s[5]||0,s[6]||0,n)):new Date(s[1],r,s[3]||1,s[4]||0,s[5]||0,s[6]||0,n)}}return new Date(t)}(e),this.init()},f.init=function(){var e=this.$d;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()},f.$utils=function(){return $},f.isValid=function(){return!(this.$d.toString()===h)},f.isSame=function(e,t){var a=S(e);return this.startOf(t)<=a&&a<=this.endOf(t)},f.isAfter=function(e,t){return S(e)<this.startOf(t)},f.isBefore=function(e,t){return this.endOf(t)<S(e)},f.$g=function(e,t,a){return $.u(e)?this[t]:this.set(a,e)},f.unix=function(){return Math.floor(this.valueOf()/1e3)},f.valueOf=function(){return this.$d.getTime()},f.startOf=function(e,t){var a=this,s=!!$.u(t)||t,d=$.p(e),h=function(e,t){var r=$.w(a.$u?Date.UTC(a.$y,t,e):new Date(a.$y,t,e),a);return s?r:r.endOf(i)},p=function(e,t){return $.w(a.toDate()[e].apply(a.toDate("s"),(s?[0,0,0,0]:[23,59,59,999]).slice(t)),a)},x=this.$W,v=this.$M,f=this.$D,b="set"+(this.$u?"UTC":"");switch(d){case u:return s?h(1,0):h(31,11);case c:return s?h(1,v):h(0,v+1);case o:var y=this.$locale().weekStart||0,g=(x<y?x+7:x)-y;return h(s?f-g:f+(6-g),v);case i:case m:return p(b+"Hours",0);case l:return p(b+"Minutes",1);case n:return p(b+"Seconds",2);case r:return p(b+"Milliseconds",3);default:return this.clone()}},f.endOf=function(e){return this.startOf(e,!1)},f.$set=function(e,t){var a,o=$.p(e),d="set"+(this.$u?"UTC":""),h=(a={},a[i]=d+"Date",a[m]=d+"Date",a[c]=d+"Month",a[u]=d+"FullYear",a[l]=d+"Hours",a[n]=d+"Minutes",a[r]=d+"Seconds",a[s]=d+"Milliseconds",a)[o],p=o===i?this.$D+(t-this.$W):t;if(o===c||o===u){var x=this.clone().set(m,1);x.$d[h](p),x.init(),this.$d=x.set(m,Math.min(this.$D,x.daysInMonth())).$d}else h&&this.$d[h](p);return this.init(),this},f.set=function(e,t){return this.clone().$set(e,t)},f.get=function(e){return this[$.p(e)]()},f.add=function(s,d){var m,h=this;s=Number(s);var p=$.p(d),x=function(e){var t=S(h);return $.w(t.date(t.date()+Math.round(e*s)),h)};if(p===c)return this.set(c,this.$M+s);if(p===u)return this.set(u,this.$y+s);if(p===i)return x(1);if(p===o)return x(7);var v=(m={},m[n]=t,m[l]=a,m[r]=e,m)[p]||1,f=this.$d.getTime()+s*v;return $.w(f,this)},f.subtract=function(e,t){return this.add(-1*e,t)},f.format=function(e){var t=this,a=this.$locale();if(!this.isValid())return a.invalidDate||h;var s=e||"YYYY-MM-DDTHH:mm:ssZ",r=$.z(this),n=this.$H,l=this.$m,i=this.$M,o=a.weekdays,c=a.months,d=a.meridiem,u=function(e,a,r,n){return e&&(e[a]||e(t,s))||r[a].slice(0,n)},m=function(e){return $.s(n%12||12,e,"0")},p=d||function(e,t,a){var s=e<12?"AM":"PM";return a?s.toLowerCase():s};return s.replace(x,(function(e,s){return s||function(e){switch(e){case"YY":return String(t.$y).slice(-2);case"YYYY":return $.s(t.$y,4,"0");case"M":return i+1;case"MM":return $.s(i+1,2,"0");case"MMM":return u(a.monthsShort,i,c,3);case"MMMM":return u(c,i);case"D":return t.$D;case"DD":return $.s(t.$D,2,"0");case"d":return String(t.$W);case"dd":return u(a.weekdaysMin,t.$W,o,2);case"ddd":return u(a.weekdaysShort,t.$W,o,3);case"dddd":return o[t.$W];case"H":return String(n);case"HH":return $.s(n,2,"0");case"h":return m(1);case"hh":return m(2);case"a":return p(n,l,!0);case"A":return p(n,l,!1);case"m":return String(l);case"mm":return $.s(l,2,"0");case"s":return String(t.$s);case"ss":return $.s(t.$s,2,"0");case"SSS":return $.s(t.$ms,3,"0");case"Z":return r}return null}(e)||r.replace(":","")}))},f.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},f.diff=function(s,m,h){var p,x=this,v=$.p(m),f=S(s),b=(f.utcOffset()-this.utcOffset())*t,y=this-f,g=function(){return $.m(x,f)};switch(v){case u:p=g()/12;break;case c:p=g();break;case d:p=g()/3;break;case o:p=(y-b)/6048e5;break;case i:p=(y-b)/864e5;break;case l:p=y/a;break;case n:p=y/t;break;case r:p=y/e;break;default:p=y}return h?p:$.a(p)},f.daysInMonth=function(){return this.endOf(c).$D},f.$locale=function(){return g[this.$L]},f.locale=function(e,t){if(!e)return this.$L;var a=this.clone(),s=w(e,t,!0);return s&&(a.$L=s),a},f.clone=function(){return $.w(this.$d,this)},f.toDate=function(){return new Date(this.valueOf())},f.toJSON=function(){return this.isValid()?this.toISOString():null},f.toISOString=function(){return this.$d.toISOString()},f.toString=function(){return this.$d.toUTCString()},v}(),C=k.prototype;return S.prototype=C,[["$ms",s],["$s",r],["$m",n],["$H",l],["$W",i],["$M",c],["$y",u],["$D",m]].forEach((function(e){C[e[1]]=function(t){return this.$g(t,e[0],e[1])}})),S.extend=function(e,t){return e.$i||(e(t,k,S),e.$i=!0),S},S.locale=w,S.isDayjs=j,S.unix=function(e){return S(1e3*e)},S.en=g[y],S.Ls=g,S.p={},S}()},82284:(e,t,a)=>{"use strict";function s(e){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s(e)}a.d(t,{A:()=>s})}}]);
//# sourceMappingURL=1981.3f7c7b17.chunk.js.map