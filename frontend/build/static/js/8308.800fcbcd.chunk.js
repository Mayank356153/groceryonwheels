"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[8308],{17069:(e,l,t)=>{t.d(l,{A:()=>s});var a=t(65043);const s=a.forwardRef((function(e,l){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",ref:l},e),a.createElement("path",{fillRule:"evenodd",d:"M4 5a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V7a2 2 0 00-2-2h-1.586a1 1 0 01-.707-.293l-1.121-1.121A2 2 0 0011.172 3H8.828a2 2 0 00-1.414.586L6.293 4.707A1 1 0 015.586 5H4zm6 9a3 3 0 100-6 3 3 0 000 6z",clipRule:"evenodd"}))}))},78308:(e,l,t)=>{t.r(l),t.d(l,{default:()=>p});var a=t(65043),s=t(59255),r=t(21197),o=t(66727),i=t(60184),n=t(17069),c=t(26873),d=t(86213),m=t(37762),u=t(64857),x=t(11238),h=t(79038),v=t(70579);function p(){const[e,l]=(0,a.useState)(!1),[t,p]=(0,a.useState)(!0),[f,g]=(0,a.useState)(!0),[b,j]=(0,a.useState)({warehouses:[],categories:[],brands:[],items:[]});(0,a.useEffect)((()=>{window.innerWidth<768&&p(!1)}),[]);const[w,y]=(0,a.useState)(""),[N,C]=(0,a.useState)("all"),[S,k]=(0,a.useState)("all"),[A,D]=(0,a.useState)("all"),[F,E]=(0,a.useState)("all"),[I,T]=(0,a.useState)("all"),[L,W]=(0,a.useState)(""),[z,_]=(0,a.useState)([]),[R,B]=(0,a.useState)(0);(0,a.useEffect)((()=>{(async()=>{try{const e=(await d.A.get("api/warehouses",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})).data.data.map((e=>({label:e.warehouseName,value:e._id})));j((l=>({...l,warehouses:[{label:"All",value:"all"},...e]})))}catch(e){console.log(e.message)}finally{g(!1)}})(),(async()=>{try{const e=(await d.A.get("api/categories",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})).data.data.map((e=>({label:e.name,value:e._id})));j((l=>({...l,categories:[{label:"All",value:"all"},...e]})))}catch(e){console.log(e.message)}finally{g(!1)}})(),(async()=>{try{const e=await d.A.get("api/items",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});j((l=>({...l,items:e.data.data})))}catch(e){console.log(e.message)}finally{g(!1)}})(),(async()=>{try{g(!0);const e=localStorage.getItem("token"),l=await d.A.get("api/sales",{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});console.log("sales"),console.log(l.data.sales),_(l.data.sales)}catch(e){console.log(e.message)}finally{g(!1)}})()}),[]);const[O,P]=(0,a.useState)(!1),M=(0,a.useRef)(null),V=(0,a.useRef)(null);(0,a.useEffect)((()=>{if(!O)return;return(async()=>{if(!M.current)return;const e=new h.BrowserMultiFormatReader;V.current=e;const l=async l=>{const t={video:{facingMode:l,advanced:[{width:1920},{height:1080},{zoom:2}]}};return e.decodeFromConstraints(t,M.current,((e,l)=>{if(e){var t,a,s,r;const l=e.getText();alert(l),D(l),null===(t=(a=window.navigator).vibrate)||void 0===t||t.call(a,200);new Audio("/beep.mp3").play();const o=null===(s=M.current)||void 0===s?void 0:s.srcObject;null===o||void 0===o||o.getTracks().forEach((e=>e.stop())),null!==(r=V.current)&&void 0!==r&&r.reset&&"function"===typeof V.current.reset&&V.current.reset(),P(!1)}l&&"NotFoundException"!==l.name&&console.error("Scan error:",l)}))};try{await l({exact:"environment"})}catch(t){if("OverconstrainedError"===t.name||"NotFoundError"===t.name){console.warn("Back camera not found. Trying front camera...");try{await l("user")}catch(a){console.error("Front camera also failed:",a),alert("No camera found or accessible."),P(!1)}}else console.error("Camera access error:",t),alert("Camera access error: "+t.message),P(!1)}})(),()=>{var e,l;const t=null===(e=M.current)||void 0===e?void 0:e.srcObject;null===t||void 0===t||t.getTracks().forEach((e=>e.stop())),null!==(l=V.current)&&void 0!==l&&l.reset&&"function"===typeof V.current.reset&&V.current.reset()}}),[O]);const H=z.filter((e=>{const{warehouse:l,items:t,saleDate:a}=e,s="all"===N||l._id===N,r="all"===S||t.some((e=>{var l,t;return(null===(l=e.item)||void 0===l||null===(t=l.category)||void 0===t?void 0:t._id)===S})),o="all"===A||""===A||t.some((e=>{var l,t,a;return(null===(l=e.item)||void 0===l?void 0:l._id)===A||(null===(t=e.item)||void 0===t?void 0:t.barcode)===A||(null===(a=e.item)||void 0===a?void 0:a.itemName.toLowerCase().includes(A.toLowerCase()))})),i=new Date(a),n="all"===F||""===F?null:new Date(F),c="all"===I||""===I?null:new Date(I);return s&&r&&o&&((!n||i>=n)&&(!c||i<=c))})),$=L?b.items.filter((e=>{var l,t;const a=L.toLowerCase();return(null===(l=e.itemName)||void 0===l?void 0:l.toLowerCase().includes(a))||(null===(t=e.itemCode)||void 0===t?void 0:t.toLowerCase().includes(a))||e.barcode&&e.barcode.toLowerCase().includes(a)})):[];(0,a.useEffect)((()=>{L&&b.items.filter((e=>{var l,t;const a=L.toLowerCase();return(null===(l=e.itemName)||void 0===l?void 0:l.toLowerCase().includes(a))||(null===(t=e.itemCode)||void 0===t?void 0:t.toLowerCase().includes(a))||e.barcode&&e.barcode.toLowerCase().includes(a)}))}),[L]);return(0,a.useEffect)((()=>{let e=0;H.forEach((l=>{e+=l.grandTotal})),console.log("Sum"),B(e)}),[H]),(0,a.useEffect)((()=>console.log(H)),[H]),(0,a.useEffect)((()=>console.log("sale")),[z]),(0,v.jsxs)("div",{className:"flex flex-col h-screen",children:[(0,v.jsx)(r.A,{isSidebarOpen:t,setSidebarOpen:p}),(0,v.jsxs)("div",{className:"flex flex-grow",children:[(0,v.jsx)(s.A,{isSidebarOpen:t}),(0,v.jsxs)("div",{className:"relative flex flex-col flex-grow px-4 py-6 bg-gray-100",children:[(0,v.jsxs)("header",{className:"flex flex-col items-center justify-between sm:flex-row",children:[(0,v.jsx)("div",{className:"flex items-center gap-1 text-center sm:flex-row sm:text-left",children:(0,v.jsx)("h1",{className:"text-lg font-semibold truncate sm:text-xl",children:"Sale Item Report"})}),(0,v.jsxs)("nav",{className:"flex flex-wrap items-center justify-center mt-2 text-xs text-gray-500 sm:justify-start sm:text-sm sm:mt-0",children:[(0,v.jsxs)(o.k2,{to:"/dashboard",className:"flex items-center text-gray-700 no-underline hover:text-cyan-600",children:[(0,v.jsx)(i.$BV,{className:"mr-2 text-gray-500 hover:text-cyan-600"})," Home"]}),(0,v.jsx)(o.k2,{to:"/reports/sale-item",className:"text-gray-700 no-underline hover:text-cyan-600",children:"> sale item Report"})]})]}),(0,v.jsxs)("div",{className:"flex flex-col w-full mx-auto mt-4 bg-white border-t-4 rounded-lg shadow-md border-cyan-600",children:[(0,v.jsx)("div",{className:"w-full h-auto px-2 border-b-2 border-gray-200",children:(0,v.jsx)("h4",{className:"text-gray-700",children:"Please Enter Valid Information"})}),(0,v.jsxs)("div",{className:"py-4 ",children:[(0,v.jsxs)("div",{className:"flex w-full gap-5 px-4 mb-4",children:[(0,v.jsxs)("div",{className:"flex flex-col w-full",children:[(0,v.jsx)("label",{htmlFor:"",children:"Warehouse"}),(0,v.jsx)(c.Ay,{className:"w-full",options:b.warehouses,onChange:e=>C(e.value),value:b.warehouses.find((e=>e.value===N))})]}),(0,v.jsxs)("div",{className:"flex flex-col w-full",children:[(0,v.jsx)("label",{htmlFor:"",children:"Item Type"}),(0,v.jsx)(c.Ay,{className:"w-full",options:[{label:"Item",value:"item"},{label:"Services",value:"services"}]})]})]}),(0,v.jsxs)("div",{className:"flex w-full gap-5 px-4 mb-4",children:[(0,v.jsxs)("div",{className:"flex flex-col w-full",children:[(0,v.jsx)("label",{htmlFor:"",children:"Category"}),(0,v.jsx)(c.Ay,{className:"w-full",options:b.categories,onChange:e=>k(e.value),value:b.categories.find((e=>e.value===S))||null})]}),(0,v.jsxs)("div",{className:"relative flex flex-col w-full",children:[(0,v.jsx)("label",{htmlFor:"",children:"Item Name"}),(0,v.jsxs)("label",{htmlFor:"",className:"flex",children:[(0,v.jsx)("input",{type:"text",name:"type",className:"w-full px-2 py-1 border-2 rounded-md",value:w,onChange:e=>{W(e.target.value),y(e.target.value),D(e.target.value)}}),(0,v.jsx)("button",{type:"button",className:"p-2 ml-2 text-white rounded-full hover:bg-blue-600",onClick:()=>P(!0),children:(0,v.jsx)(n.A,{className:"w-6 h-6 text-gray-500"})})]}),""!==L&&(0,v.jsx)("div",{className:"absolute z-50 w-full overflow-y-auto bg-white border rounded-lg shadow-lg top-20 sm:w-96 max-h-60 touch-auto",style:{WebkitOverflowScrolling:"touch"},children:(0,v.jsx)("ul",{children:$.map((e=>(0,v.jsxs)("li",{onClick:()=>{D(e._id),W(""),y(e.itemName)},className:"p-2 cursor-pointer hover:bg-gray-100",children:[(0,v.jsx)("strong",{children:e.itemCode})," - ",e.itemName," - ",e.barcode]},e.itemCode)))})}),O&&(0,v.jsxs)("div",{className:"fixed inset-0 z-50 flex flex-col items-center justify-center bg-black bg-opacity-50",children:[(0,v.jsxs)("div",{className:"relative overflow-hidden border-4 border-white rounded-lg shadow-xl w-72 h-72",children:[(0,v.jsx)("video",{ref:M,className:"absolute object-cover w-full h-full",autoPlay:!0,muted:!0,playsInline:!0}),(0,v.jsx)("div",{className:"absolute w-full h-1 bg-red-500 animate-scan"})]}),(0,v.jsx)("button",{onClick:()=>{var e,l;const t=null===(e=M.current)||void 0===e?void 0:e.srcObject;null===t||void 0===t||t.getTracks().forEach((e=>e.stop())),null!==(l=V.current)&&void 0!==l&&l.reset&&"function"===typeof V.current.reset&&V.current.reset(),P(!1)},className:"px-4 py-2 mt-6 text-white bg-red-600 rounded hover:bg-red-700",children:"Cancel"})]})]})]}),(0,v.jsxs)("div",{className:"flex w-full gap-5 px-4",children:[(0,v.jsxs)("div",{className:"flex flex-col w-full",children:[(0,v.jsx)("label",{htmlFor:"",children:"From Date"}),(0,v.jsx)("input",{type:"date",name:"type",className:"w-full px-2 py-1 border-2 rounded-md",onChange:e=>E(e.target.value)})]}),(0,v.jsxs)("div",{className:"flex flex-col w-full",children:[(0,v.jsx)("label",{htmlFor:"",children:"To Date"}),(0,v.jsx)("input",{type:"date",name:"type",className:"w-full px-2 py-1 border-2 rounded-md",onChange:e=>T(e.target.value)})]})]})]})]}),(0,v.jsxs)("div",{className:"flex flex-col w-full mt-5 bg-white border-t-4 border-gray-400",children:[(0,v.jsxs)("div",{className:"flex w-full px-2 py-2",children:[(0,v.jsx)("div",{className:"w-full",children:(0,v.jsx)("h4",{className:"text-gray-700",children:"Records Table"})}),(0,v.jsxs)("div",{className:"relative",children:[(0,v.jsxs)("button",{onClick:()=>l(!e),className:"flex items-center px-4 py-2 text-white bg-blue-500 rounded hover:bg-blue-600",children:[(0,v.jsx)(i.OXb,{className:"mr-2"}),"Export",(0,v.jsx)("span",{className:"ml-2 text-sm",children:"\u25bc"})]}),e&&(0,v.jsx)("div",{className:"absolute right-0 z-10 w-40 mt-2 bg-white rounded-md shadow-lg",onMouseLeave:()=>l(!1),children:(0,v.jsxs)("div",{className:"py-1",children:[(0,v.jsxs)("button",{onClick:()=>{(()=>{const e=H.map(((e,l)=>{var t,a,s,r,o,i;return{"#":l+1,"Sale Code":e.saleCode||"NA",Date:new Date(e.saleDate).toDateString(),Customer:(null===(t=e.customer)||void 0===t?void 0:t.customerName)||"NA",Items:null===(a=e.items)||void 0===a?void 0:a.map((e=>{var l;return(null===(l=e.item)||void 0===l?void 0:l.itemName)||"NA"})).join("\n"),Categories:null===(s=e.items)||void 0===s?void 0:s.map((e=>{var l,t;return(null===(l=e.item)||void 0===l||null===(t=l.category)||void 0===t?void 0:t.name)||"No category"})).join("\n"),Quantities:null===(r=e.items)||void 0===r?void 0:r.map((e=>e.quantity)).join("\n"),"Unit Prices":null===(o=e.items)||void 0===o?void 0:o.map((e=>e.unitPrice)).join("\n"),Total:(null===(i=e.grandTotal)||void 0===i?void 0:i.toFixed(2))||"0.00"}})),l=x.utils.json_to_sheet(e),t=x.utils.book_new();x.utils.book_append_sheet(t,l,"saleItems"),x.writeFile(t,"saleItems.xlsx")})(),l(!1)},className:"flex items-center w-full px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",children:[(0,v.jsx)("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,v.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Excel"]}),(0,v.jsxs)("button",{onClick:()=>{(()=>{const e=new m.Ay;e.text("Sale Item",14,15);const l=H.map(((e,l)=>{var t,a,s,r,o,i;return[l+1,e.saleCode||"NA",new Date(e.saleDate).toDateString(),(null===(t=e.customer)||void 0===t?void 0:t.customerName)||"NA",null===(a=e.items)||void 0===a?void 0:a.map((e=>{var l;return(null===(l=e.item)||void 0===l?void 0:l.itemName)||"NA"})).join(", "),null===(s=e.items)||void 0===s?void 0:s.map((e=>{var l,t;return(null===(l=e.item)||void 0===l||null===(t=l.category)||void 0===t?void 0:t.name)||"No category"})).join(", "),null===(r=e.items)||void 0===r?void 0:r.map((e=>e.quantity)).join(", "),null===(o=e.items)||void 0===o?void 0:o.map((e=>e.unitPrice)).join(", "),(null===(i=e.grandTotal)||void 0===i?void 0:i.toFixed(2))||"0.00"]}));(0,u.Ay)(e,{head:[["#","Sale Code","Date","Customer","Items","Categories","Quantities","Unit Prices","Total"]],body:l,startY:20,styles:{fontSize:8,cellPadding:2,overflow:"linebreak"},columnStyles:{0:{cellWidth:10},1:{cellWidth:20},2:{cellWidth:25},3:{cellWidth:25},4:{cellWidth:30},5:{cellWidth:25},6:{cellWidth:15},7:{cellWidth:15},8:{cellWidth:15}}}),e.save("sale_items.pdf")})(),l(!1)},className:"flex items-center w-full px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",children:[(0,v.jsx)("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,v.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"})}),"PDF"]})]})})]})]}),(0,v.jsx)("div",{className:"flex w-full px-2 py-2",children:(0,v.jsx)("div",{className:"w-full",children:(0,v.jsxs)("table",{className:"min-w-full gap-2 border-separate",children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{className:"px-4 py-2 text-sm text-white bg-blue-500",children:"#"}),(0,v.jsx)("th",{className:"px-4 py-2 text-sm text-white bg-blue-500",children:"Invoice No."}),(0,v.jsx)("th",{className:"px-4 py-2 text-sm text-white bg-blue-500",children:"Sales Date"}),(0,v.jsx)("th",{className:"px-4 py-2 text-sm text-white bg-blue-500",children:"Customer Name"}),(0,v.jsx)("th",{className:"px-4 py-2 text-sm text-white bg-blue-500",children:"Item Name"}),(0,v.jsx)("th",{className:"px-4 py-2 text-sm text-white bg-blue-500",children:"Category"}),(0,v.jsx)("th",{className:"px-4 py-2 text-sm text-white bg-blue-500",children:"Quantity"}),(0,v.jsx)("th",{className:"px-4 py-2 text-sm text-white bg-blue-500",children:"Unit Price(Rs.)"}),(0,v.jsx)("th",{className:"px-4 py-2 text-sm text-white bg-blue-500",children:"Total(Rs.)"})]})}),(0,v.jsxs)("tbody",{children:[H.length>0&&H.map(((e,l)=>{var t,a,s,r,o;return(0,v.jsxs)("tr",{className:"bg-gray-100 border-2 border-black",children:[(0,v.jsx)("td",{className:"px-4 py-2",children:l+1}),(0,v.jsx)("td",{className:"px-4 py-2",children:e.saleCode}),(0,v.jsx)("td",{className:"px-4 py-2",children:new Date(e.saleDate).toDateString()}),(0,v.jsx)("td",{className:"px-4 py-2",children:(null===(t=e.customer)||void 0===t?void 0:t.customerName)||"NA"}),(0,v.jsx)("td",{className:"px-4 py-2",children:null===(a=e.items)||void 0===a?void 0:a.map(((e,l)=>{var t;return(0,v.jsxs)("span",{children:[l+1,".",(null===(t=e.item)||void 0===t?void 0:t.itemName)||"NA"," ",(0,v.jsx)("br",{})]})}))}),(0,v.jsx)("td",{className:"px-4 py-2",children:null===(s=e.items)||void 0===s?void 0:s.map(((e,l)=>{var t,a;return(0,v.jsxs)("span",{children:[l+1,".",(null===(t=e.item)||void 0===t||null===(a=t.category)||void 0===a?void 0:a.name)||"No category"," ",(0,v.jsx)("br",{})]})}))}),(0,v.jsx)("td",{className:"px-4 py-2",children:null===(r=e.items)||void 0===r?void 0:r.map(((e,l)=>(0,v.jsxs)("span",{children:[e.quantity," ",(0,v.jsx)("br",{})]})))}),(0,v.jsx)("td",{className:"px-4 py-2",children:null===(o=e.items)||void 0===o?void 0:o.map(((e,l)=>(0,v.jsxs)("span",{children:[e.unitPrice," ",(0,v.jsx)("br",{})]})))}),(0,v.jsx)("td",{className:"px-4 py-2",children:e.grandTotal.toFixed(2)})]},l)})),0===H.length&&(0,v.jsx)("tr",{className:"bg-gray-100 border-2 border-black",children:(0,v.jsx)("td",{className:"px-4 py-2 text-center",colSpan:"10",children:(0,v.jsx)("h5",{children:"No Data Found"})})}),H.length>0&&(0,v.jsxs)("tr",{className:"bg-gray-100 border-2 border-black",children:[(0,v.jsx)("td",{className:"px-4 py-2 text-right",colSpan:"8",children:(0,v.jsx)("h7",{className:"font-semibold",children:"Total:"})}),(0,v.jsx)("td",{className:"py-2 font-semibold text-center",children:R.toFixed(2)})]})]})]})})})]})]})]})]})}}}]);
//# sourceMappingURL=8308.800fcbcd.chunk.js.map