"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[6714],{14840:(e,s,a)=>{a.d(s,{A:()=>o});var t=a(65043),r=a(21197),n=a(59255),i=a(70579);function o(){const[e,s]=(0,t.useState)(!1);return(0,i.jsxs)("div",{className:"flex flex-col h-screen",children:[(0,i.jsx)(r.A,{isSidebarOpen:e,setSidebarOpen:s}),(0,i.jsxs)("div",{className:"flex flex-grow mt-20",children:[(0,i.jsx)("div",{children:(0,i.jsx)(n.A,{isSidebarOpen:e})}),(0,i.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-white/80 backdrop-blur-sm",children:(0,i.jsxs)("div",{className:"flex flex-col items-center",children:[(0,i.jsx)("div",{className:"w-12 h-12 border-4 rounded-full border-cyan-500 border-t-transparent animate-spin"}),(0,i.jsx)("p",{className:"mt-3 text-lg font-semibold text-gray-700",children:"Loading..."})]})})]})]})}},36714:(e,s,a)=>{a.r(s),a.d(s,{default:()=>p});var t=a(65043),r=a(66727),n=a(86213),i=a(21197),o=a(59255),d=a(14840),l=a(70579);const c={posorders:["warehouses","customers","paymenttypes","items","taxgroups","taxes","accounts","sales"],sales:["warehouses","customers","paymenttypes","items","taxgroups","taxes","accounts"],salesreturn:["warehouses","customers","paymenttypes","items","accounts","cashsummary"],purchases:["warehouses","suppliers","paymenttypes","items","taxgroups","taxes","accounts","cashsummary"],purchasesreturn:["warehouses","suppliers","paymenttypes","items","accounts"],stocktransfers:["warehouses","items"],stockadjustments:["warehouses","items"],moneytransfers:["accounts","warehouses","stores"],deposits:["accounts","warehouses","stores"],cashsummary:["accounts","warehouses"],items:["brands","categories","subcategories","subsubcategories","units","taxgroups","taxes","variants"],marketingitems:["items","categories","brands"],terminals:["warehouses"]};function m(e,s,a){const t=c[s]||[],r={...e,[s]:a};return t.forEach((e=>{r[e]=Array.from(new Set([...r[e]||[],...a]))})),r}function u(e){let s={...e};return Object.entries(e).forEach((e=>{let[a,t]=e;s=m(s,a,t)})),s}const p=()=>{const[e,s]=(0,t.useState)(""),[a,c]=(0,t.useState)(""),[p,h]=(0,t.useState)({}),[x,f]=(0,t.useState)(!0),[b,g]=(0,t.useState)([]),[j,y]=(0,t.useState)(!1),w=(0,r.Zp)(),[N]=(0,r.ok)(),S=N.get("id");(0,t.useEffect)((()=>{window.innerWidth<768&&f(!1)}),[]),(0,t.useEffect)((()=>{(async()=>{if(!S)return;y(!0);const e=localStorage.getItem("token");if(!e)return w("/");try{const{data:a}=await n.A.get("/admincreatingrole/api/roles",{headers:{Authorization:`Bearer ${e}`}}),t=a.roles.find((e=>e._id===S));if(t){s(t.roleName||""),c(t.description||"");const e=t.permissions.reduce(((e,s)=>(e[s.module.toLowerCase()]=s.actions,e)),{});h(e)}}catch(a){console.error(a)}finally{y(!1)}})()}),[S,w]),(0,t.useEffect)((()=>{try{g(JSON.parse(localStorage.getItem("permissions")||"[]"))}catch{g([])}}),[]);if(v="roles",C="add","admin"!==(localStorage.getItem("role")||"").toLowerCase()&&!b.some((e=>e.module.toLowerCase()===v.toLowerCase()&&e.actions.map((e=>e.toLowerCase())).includes(C.toLowerCase()))))return(0,l.jsx)("div",{className:"p-8",children:"Insufficient permissions to create roles."});var v,C;const k=["Add","Edit","Delete","View"],A=[{id:1,name:"Accounts"},{id:2,name:"AdvancePayment"},{id:3,name:"Brands"},{id:4,name:"Categories"},{id:5,name:"Countries"},{id:6,name:"Coupons"},{id:7,name:"CustomerCoupons"},{id:8,name:"Customers"},{id:9,name:"Expenses"},{id:10,name:"Help"},{id:11,name:"Items"},{id:12,name:"PaymentTypes"},{id:13,name:"POSOrders"},{id:14,name:"Purchases"},{id:15,name:"PurchasesReturn"},{id:16,name:"Quotations"},{id:17,name:"Report"},{id:18,name:"Roles"},{id:19,name:"Sales"},{id:20,name:"SalesReturn"},{id:21,name:"SendMessages"},{id:22,name:"Services"},{id:23,name:"States"},{id:24,name:"StockAdjustments"},{id:25,name:"StockTransfers"},{id:26,name:"Store"},{id:27,name:"Stores"},{id:28,name:"Suppliers"},{id:29,name:"Taxes"},{id:30,name:"TaxGroups"},{id:31,name:"Units"},{id:32,name:"Users"},{id:33,name:"Variants"},{id:34,name:"Warehouses"},{id:35,name:"ExpenseCategories"},{id:36,name:"SubCategories"},{id:37,name:"SubSubCategories"},{id:38,name:"MoneyTransfers"},{id:39,name:"Deposits"},{id:40,name:"CashSummary"},{id:41,name:"Dashboard"},{id:42,name:"MarketingItems"},{id:43,name:"Banner"},{id:44,name:"Terminals"},{id:45,name:"Product"},{id:46,name:"Order"},{id:47,name:"Rider"},{id:48,name:"DeliverySlot"},{id:49,name:"Audit"},{id:50,name:"Image Management"},{id:51,name:"Bookings"}],L=()=>A.every((e=>(p[e.name.toLowerCase()]||[]).length===k.length));return j?(0,l.jsx)(d.A,{}):(0,l.jsxs)("div",{className:"flex h-screen flex-col",children:[(0,l.jsx)(i.A,{isSidebarOpen:x,setSidebarOpen:f}),(0,l.jsxs)("div",{className:"flex flex-grow",children:[(0,l.jsx)(o.A,{isSidebarOpen:x}),(0,l.jsxs)("main",{className:"w-full p-8 overflow-auto",children:[(0,l.jsx)("h1",{className:"text-2xl font-bold mb-6",children:S?"Update Role":"Create Role"}),(0,l.jsxs)("form",{onSubmit:async s=>{if(s.preventDefault(),!e.trim())return alert("Role name is required");const t=localStorage.getItem("token");if(!t)return w("/login");const r={roleName:e.trim(),description:a,permissions:Object.entries(u(p)).map((e=>{let[s,a]=e;return{module:s.replace(" ","_"),actions:a}}))};y(!0);try{S?(await n.A.put(`/admincreatingrole/${S}`,r,{headers:{Authorization:`Bearer ${t}`}}),alert("Role updated")):(await n.A.post("/admincreatingrole/api/roles",r,{headers:{Authorization:`Bearer ${t}`}}),alert("Role created")),w("/admin/role/list")}catch(d){var i,o;alert((null===(i=d.response)||void 0===i||null===(o=i.data)||void 0===o?void 0:o.message)||d.message)}finally{y(!1)}},children:[(0,l.jsxs)("div",{className:"mb-4",children:[(0,l.jsx)("label",{className:"block font-semibold mb-2",children:"Role Name"}),(0,l.jsx)("input",{className:"border rounded p-2 w-full",value:e,onChange:e=>s(e.target.value)})]}),(0,l.jsxs)("div",{className:"mb-6",children:[(0,l.jsx)("label",{className:"block font-semibold mb-2",children:"Description"}),(0,l.jsx)("textarea",{rows:"3",className:"border rounded p-2 w-full",value:a,onChange:e=>c(e.target.value)})]}),(0,l.jsx)("div",{className:"overflow-auto",children:(0,l.jsxs)("table",{className:"min-w-full bg-gray-50",children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{className:"bg-gray-300",children:[(0,l.jsx)("th",{className:"border px-4 py-2",children:"#"}),(0,l.jsx)("th",{className:"border px-4 py-2",children:"Module"}),(0,l.jsx)("th",{className:"border px-4 py-2 text-center",children:"Permissions"}),(0,l.jsx)("th",{className:"border px-4 py-2 text-center",children:"Row All"}),(0,l.jsx)("th",{className:"border px-4 py-2 text-center",children:(0,l.jsx)("input",{type:"checkbox",checked:L(),onChange:()=>h((e=>{if(L())return{};const s={};return A.forEach((e=>s[e.name.toLowerCase()]=[...k])),u(s)})),title:"Select ALL permissions on ALL modules"})})]})}),(0,l.jsx)("tbody",{children:A.map(((e,s)=>{const a=e.name.toLowerCase(),t=p[a]||[];return(0,l.jsxs)("tr",{children:[(0,l.jsx)("td",{className:"border px-4 py-2",children:s+1}),(0,l.jsx)("td",{className:"border px-4 py-2",children:e.name}),(0,l.jsx)("td",{className:"border px-4 py-2",children:(0,l.jsx)("div",{className:"flex flex-wrap gap-2",children:k.map((s=>(0,l.jsxs)("label",{className:"flex items-center gap-1",children:[(0,l.jsx)("input",{type:"checkbox",checked:t.includes(s),onChange:()=>((e,s)=>{const a=e.toLowerCase(),t=p[a]||[],r=t.includes(s)?t.filter((e=>e!==s)):[...t,s];h((e=>m(e,a,r)))})(e.name,s)}),(0,l.jsx)("span",{children:s})]},`${e.name}-${s}`)))})}),(0,l.jsx)("td",{className:"border px-4 py-2 text-center",children:(0,l.jsx)("input",{type:"checkbox",checked:t.length===k.length,onChange:()=>(e=>{const s=e.toLowerCase(),a=(p[s]||[]).length===k.length?[]:[...k];h((e=>m(e,s,a)))})(e.name)})})]},e.id)}))})]})}),(0,l.jsxs)("div",{className:"flex justify-center gap-8 mt-8",children:[(0,l.jsx)("button",{type:"submit",className:"bg-green-600 text-white px-6 py-2 rounded w-[150px]",children:S?"Update":"Save"}),(0,l.jsx)("button",{type:"button",className:"bg-orange-500 text-white px-6 py-2 rounded w-[150px]",onClick:()=>{s(""),c(""),h({})},children:"Clear"})]})]})]})]})]})}}}]);
//# sourceMappingURL=6714.cadef1bc.chunk.js.map