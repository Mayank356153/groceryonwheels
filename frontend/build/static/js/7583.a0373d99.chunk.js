"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[7583],{14840:(e,a,t)=>{t.d(a,{A:()=>d});var s=t(65043),n=t(21197),r=t(59255),l=t(70579);function d(){const[e,a]=(0,s.useState)(!1);return(0,l.jsxs)("div",{className:"flex flex-col h-screen",children:[(0,l.jsx)(n.A,{isSidebarOpen:e,setSidebarOpen:a}),(0,l.jsxs)("div",{className:"flex flex-grow mt-20",children:[(0,l.jsx)("div",{children:(0,l.jsx)(r.A,{isSidebarOpen:e})}),(0,l.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-white/80 backdrop-blur-sm",children:(0,l.jsxs)("div",{className:"flex flex-col items-center",children:[(0,l.jsx)("div",{className:"w-12 h-12 border-4 rounded-full border-cyan-500 border-t-transparent animate-spin"}),(0,l.jsx)("p",{className:"mt-3 text-lg font-semibold text-gray-700",children:"Loading..."})]})})]})]})}},17583:(e,a,t)=>{t.r(a),t.d(a,{default:()=>p});var s=t(65043),n=t(66727),r=t(60184),l=t(49804),d=t(21197),o=t(59255),i=t(14840),c=t(86213),h=t(70579);const u="api",x=()=>(new Date).toISOString().slice(0,10),m=e=>Number(null!==e&&void 0!==e?e:0).toFixed(2);function p(){const e=(0,n.Zp)(),a=localStorage.getItem("token")||"";c.A.defaults.headers.common={Authorization:`Bearer ${a}`};const[t,p]=(0,s.useState)(window.innerWidth>=768),[g,f]=(0,s.useState)(!1),[v,b]=(0,s.useState)(""),[N,j]=(0,s.useState)(""),[w,y]=(0,s.useState)(1),[S]=(0,s.useState)(10),[C,k]=(0,s.useState)(x()),[$,A]=(0,s.useState)(""),[_,I]=(0,s.useState)(""),[B,V]=(0,s.useState)(0),[O,E]=(0,s.useState)([]),[L,R]=(0,s.useState)({}),[T,D]=(0,s.useState)({}),[M,P]=(0,s.useState)({}),F=localStorage.getItem("storeId")||"",W="admin"===(localStorage.getItem("role")||"").toLowerCase(),z=(0,s.useRef)();(0,s.useEffect)((()=>{if(f(!0),!W&&!F)return b("No store ID found. Please log in again."),void f(!1);Promise.all([c.A.get(`${u}/accounts`),c.A.get(`${u}/warehouses`)]).then((e=>{let[a,t]=e;const s={};(t.data.data||[]).forEach((e=>s[e._id]=e));const n=(a.data.data||[]).map((e=>c.A.get(`${u}/by-cash-account/${e._id}`).then((a=>{const t=a.data.warehouseId,n=s[t];return(W?!!n:n&&n.store===F)?(P((a=>({...a,[e._id]:{warehouseId:t,warehouseName:n.warehouseName}}))),e):null})).catch((()=>null))));Promise.all(n).then((e=>{const a=e.filter(Boolean);E(a),a.length||b("No accounts found for your store.")}))})).catch((e=>{var a,t;console.error(e),b((null===(a=e.response)||void 0===a||null===(t=a.data)||void 0===t?void 0:t.message)||"Failed to load data.")})).finally((()=>f(!1)))}),[F,W]);const Z=()=>Boolean($&&_),q=()=>!Z()&&C===x();(0,s.useEffect)((()=>{if(q()){const e=setInterval((()=>V((e=>e+1))),3e4);return()=>clearInterval(e)}}),[C,$,_]);const H=async e=>{var a;const t=`${Z()?`range:${$}_${_}`:`day:${C}`}#${B}`;if((null===(a=L[e])||void 0===a?void 0:a.key)!==t){R((a=>({...a,[e]:{loading:!0,key:t}})));try{const{warehouseId:a}=await c.A.get(`${u}/by-cash-account/${e}`).then((e=>e.data)),n=await c.A.get(`${u}/cash-summary`,{params:(s={warehouseId:a},Z()?{...s,start:$,end:_}:{...s,date:C})}).then((e=>e.data));q()&&D((a=>({...a,[e]:n.liveBalance}))),R((a=>({...a,[e]:{loading:!1,key:t,data:n}})))}catch(n){console.error(`fetchSummary(${e}) failed`,n.message);const a={deposit:0,cashSale:0,bankSale:0,totalSale:0,moneyTransfer:0,vanCash:0,vanCashRemark:"",diff:0,openingBalance:0,closingBalance:0,liveBalance:0};R((s=>{var r;return{...s,[e]:{loading:!1,key:t,data:404===(null===(r=n.response)||void 0===r?void 0:r.status)?a:{...a,error:n.message}}}}))}var s}};(0,s.useEffect)((()=>{O.forEach((e=>H(e._id)))}),[O,C,$,_,B]);const U=O.filter((e=>{var a,t,s,n;const r=N.toLowerCase();return(null===(a=e.accountName)||void 0===a?void 0:a.toLowerCase().includes(r))||(null===(t=e.accountNumber)||void 0===t?void 0:t.toLowerCase().includes(r))||(null===(s=M[e._id])||void 0===s||null===(n=s.warehouseName)||void 0===n?void 0:n.toLowerCase().includes(r))||e._id.includes(r)})),X=Math.ceil(U.length/S)||1,G=U.slice((w-1)*S,w*S);return g?(0,h.jsx)(i.A,{}):v?(0,h.jsx)("p",{className:"p-4 text-red-600",children:v}):(0,h.jsxs)("div",{className:"flex flex-col h-screen",children:[(0,h.jsx)(d.A,{isSidebarOpen:t,setSidebarOpen:p}),(0,h.jsxs)("div",{className:"flex flex-grow",children:[(0,h.jsx)(o.A,{isSidebarOpen:t}),(0,h.jsxs)("main",{className:"flex-grow p-3 bg-gray-100 overflow-x-auto",children:[(0,h.jsxs)("header",{className:"flex justify-between mb-3 bg-white p-3 rounded shadow",children:[(0,h.jsxs)("div",{children:[(0,h.jsx)("h1",{className:"font-bold text-lg",children:"Accounts"}),(0,h.jsx)("p",{className:"text-sm text-gray-500",children:"View / Search"})]}),(0,h.jsxs)("nav",{className:"text-gray-500 text-sm flex items-center",children:[(0,h.jsxs)(n.N_,{to:"/dashboard",className:"flex items-center",children:[(0,h.jsx)(r.$BV,{className:"mr-1"}),"Home"]}),(0,h.jsx)(l.XWt,{className:"mx-2"}),(0,h.jsx)("span",{children:"Accounts"})]})]}),(0,h.jsxs)("div",{className:"flex flex-wrap justify-between items-center mb-3 gap-2",children:[(0,h.jsxs)("div",{className:"flex gap-2",children:[(0,h.jsx)(n.N_,{to:"/add-account",className:"px-4 py-2 bg-cyan-600 text-white rounded",children:"+ Create Account"}),(0,h.jsx)(n.N_,{to:"/ledger/van-cash/new",className:"px-4 py-2 bg-green-600 text-white rounded",children:"+ Van Cash"}),(0,h.jsx)(n.N_,{to:"/add-deposit",className:"px-4 py-2 bg-green-600 text-white rounded",children:"+ Add Deposit"}),(0,h.jsx)(n.N_,{to:"/add-money-transfer",className:"px-4 py-2 bg-green-600 text-white rounded",children:"+ Add Money Transfer"})]}),(0,h.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,h.jsx)("input",{type:"date",value:C,onChange:e=>{k(e.target.value),A(""),I("")},className:"border p-1 text-sm"}),(0,h.jsx)("span",{className:"text-sm",children:"or"}),(0,h.jsx)("input",{type:"date",value:$,onChange:e=>{A(e.target.value),k("")},className:"border p-1 text-sm"}),(0,h.jsx)("span",{className:"text-sm",children:"to"}),(0,h.jsx)("input",{type:"date",value:_,onChange:e=>{I(e.target.value),k("")},className:"border p-1 text-sm"}),(0,h.jsx)("input",{type:"text",placeholder:"Search\u2026",value:N,onChange:e=>{j(e.target.value),y(1)},className:"border p-1 text-sm"})]})]}),(0,h.jsx)("div",{className:"overflow-x-auto bg-white rounded shadow",children:(0,h.jsxs)("table",{ref:z,className:"min-w-full text-sm",children:[(0,h.jsx)("thead",{className:"bg-gray-200",children:(0,h.jsx)("tr",{children:["Account #","Account Name","Warehouse","Deposit","Cash Sale","Bank Sale","Total Sale","Money Trf","Van Cash","Van Cash Remark","Diff","Opening","Closing","Live Bal","Action"].map((e=>(0,h.jsx)("th",{className:"border p-2",children:e},e)))})}),(0,h.jsx)("tbody",{children:0===G.length?(0,h.jsx)("tr",{children:(0,h.jsx)("td",{colSpan:15,className:"text-center p-4",children:"No accounts."})}):G.map((a=>{var t,s;const l=(null===(t=L[a._id])||void 0===t?void 0:t.data)||{},d=q()&&null!==(s=T[a._id])&&void 0!==s?s:l.liveBalance,o=M[a._id]||{},i=Z()?`?from=${$}&to=${_}`:`?on=${C}`,x=`/accounts/${a._id}/ledger${i}`;return(0,h.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,h.jsx)("td",{className:"border p-2",children:a.accountNumber}),(0,h.jsx)("td",{className:"border p-2 text-blue-600 hover:underline",children:(0,h.jsx)(n.N_,{to:x,children:a.accountName})}),(0,h.jsx)("td",{className:"border p-2 text-blue-600 hover:underline",children:(0,h.jsx)(n.N_,{to:x,children:o.warehouseName||"-"})}),(0,h.jsx)("td",{className:"border p-2 text-right",children:m(l.deposit)}),(0,h.jsx)("td",{className:"border p-2 text-right",children:m(l.cashSale)}),(0,h.jsx)("td",{className:"border p-2 text-right",children:m(l.bankSale)}),(0,h.jsx)("td",{className:"border p-2 text-right",children:m(l.totalSale)}),(0,h.jsx)("td",{className:"border p-2 text-right",children:m(l.moneyTransfer)}),(0,h.jsxs)("td",{className:"border p-2 text-right flex items-center justify-end gap-1",children:[m(l.vanCash),(0,h.jsx)("button",{onClick:()=>(async e=>{var a,t;if(Z())return void alert("Edit Van Cash only in single-day view.");const s=(null===(a=L[e])||void 0===a?void 0:a.data)||{},n=s.vanCash||0,r=s.vanCashRemark||"",l=window.prompt("New Van Cash amount",n);if(null===l)return;const d=parseFloat(l);if(isNaN(d))return void alert("Please enter a valid number for the amount.");const o=window.prompt("Enter remark for Van Cash (optional)",r);if(null===o)return;const i=o.trim(),h=null===(t=M[e])||void 0===t?void 0:t.warehouseId;if(h)try{f(!0),await c.A.put(`${u}/ledger/van-cash`,{warehouseId:h,date:`${C}T12:00:00Z`,amount:d,remark:i}),H(e),alert("Updated!")}catch(p){var x,m;console.error(p),alert((null===(x=p.response)||void 0===x||null===(m=x.data)||void 0===m?void 0:m.message)||"Failed to update Van Cash")}finally{f(!1)}else alert("Warehouse missing.")})(a._id),title:"Edit Van Cash",className:"text-blue-600 hover:text-blue-800",children:(0,h.jsx)(r.Mbp,{size:12})})]}),(0,h.jsx)("td",{className:"border p-2",children:l.vanCashRemark||"-"}),(0,h.jsx)("td",{className:"border p-2 text-right font-semibold",children:m(l.diff)}),(0,h.jsx)("td",{className:"border p-2 text-right",children:m(l.openingBalance)}),(0,h.jsx)("td",{className:"border p-2 text-right",children:m(Z()?l.totalClosingBalanceInRange:l.closingBalance)}),(0,h.jsx)("td",{className:"border p-2 text-right font-semibold",children:m(d)}),(0,h.jsxs)("td",{className:"border p-2",children:[(0,h.jsx)("button",{onClick:()=>e(`/add-account?id=${a._id}`),className:"text-blue-600 mr-2",children:(0,h.jsx)(r.uO9,{})}),(0,h.jsx)("button",{onClick:()=>{},className:"text-red-600",children:(0,h.jsx)(r.qbC,{})})]})]},a._id)}))})]})}),(0,h.jsxs)("div",{className:"flex justify-between items-center mt-3 text-sm",children:[(0,h.jsxs)("span",{children:["Showing"," ",0===U.length?0:(w-1)*S+1," ","to"," ",Math.min(w*S,U.length)," ","of ",U.length," entries"]}),(0,h.jsxs)("div",{className:"flex gap-2",children:[(0,h.jsx)("button",{disabled:w<=1,onClick:()=>y((e=>e-1)),className:"px-4 py-1 rounded "+(w<=1?"bg-gray-300":"bg-blue-500 text-white"),children:"Prev"}),(0,h.jsx)("button",{disabled:w>=X,onClick:()=>y((e=>e+1)),className:"px-4 py-1 rounded "+(w>=X?"bg-gray-300":"bg-blue-500 text-white"),children:"Next"})]})]})]})]})]})}}}]);
//# sourceMappingURL=7583.a0373d99.chunk.js.map