"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[3601],{14840:(e,t,s)=>{s.d(t,{A:()=>n});var l=s(65043),a=s(21197),o=s(59255),r=s(70579);function n(){const[e,t]=(0,l.useState)(!1);return(0,r.jsxs)("div",{className:"flex flex-col h-screen",children:[(0,r.jsx)(a.A,{isSidebarOpen:e,setSidebarOpen:t}),(0,r.jsxs)("div",{className:"flex flex-grow mt-20",children:[(0,r.jsx)("div",{children:(0,r.jsx)(o.A,{isSidebarOpen:e})}),(0,r.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-white/80 backdrop-blur-sm",children:(0,r.jsxs)("div",{className:"flex flex-col items-center",children:[(0,r.jsx)("div",{className:"w-12 h-12 border-4 rounded-full border-cyan-500 border-t-transparent animate-spin"}),(0,r.jsx)("p",{className:"mt-3 text-lg font-semibold text-gray-700",children:"Loading..."})]})})]})]})}},27473:(e,t,s)=>{s.d(t,{A:()=>a});var l=s(65043);const a=l.forwardRef((function(e,t){return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor","aria-hidden":"true",ref:t},e),l.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"}))}))},33150:(e,t,s)=>{s.d(t,{A:()=>a});var l=s(65043);const a=l.forwardRef((function(e,t){return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor","aria-hidden":"true",ref:t},e),l.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"}))}))},63601:(e,t,s)=>{s.r(t),s.d(t,{default:()=>b});var l=s(65043),a=s(27473),o=s(33150),r=s(83910),n=s(97929),d=s(60184),i=s(66727),c=s(21197),u=s(59255),x=s(26873),m=s(86213),h=s(14840),p=s(64857),v=s(11238),f=s(37762),N=s(70579);const b=()=>{const e=(0,i.Zp)(),[t,s]=(0,l.useState)([]),[b,j]=(0,l.useState)(!0),[g,y]=(0,l.useState)(""),[w,C]=(0,l.useState)(10),[A,S]=(0,l.useState)("all"),[k,R]=(0,l.useState)([]),[L,D]=(0,l.useState)({totalCount:0,totalRefunded:0}),[P,_]=(0,l.useState)(0),[T,E]=(0,l.useState)(0),[O,M]=(0,l.useState)(!1),[$,F]=(0,l.useState)(1),[B,W]=(0,l.useState)(null),[z,I]=(0,l.useState)([]);(0,l.useEffect)((()=>{const e=localStorage.getItem("permissions");e&&I(JSON.parse(e))}),[]);const V=(e,t)=>"admin"===(localStorage.getItem("role")||"guest").toLowerCase()||z.some((s=>s.module.toLowerCase()===e.toLowerCase()&&s.actions.map((e=>e.toLowerCase())).includes(t.toLowerCase())));(0,l.useEffect)((()=>{window.innerWidth<768&&j(!1)}),[]);const H=()=>({headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),J=async()=>{if(!localStorage.getItem("token"))return console.log("No token found, redirecting..."),void e("/login");M(!0);try{const e=await m.A.get("api/sales-return",H());R(e.data.returns||[]),D(e.data.summary||{totalCount:0,totalRefunded:0})}catch(t){alert("Failed to fetch sales returns: "+t.message)}finally{M(!1)}};(0,l.useEffect)((()=>{J(),(async()=>{if(!localStorage.getItem("token"))return console.log("No token found, redirecting..."),void e("/login");M(!0);try{const e=[{label:"All Warehouses",value:"all"},...(await m.A.get("api/warehouses",H())).data.data.map((e=>({label:e.warehouseName,value:e._id})))];s(e)}catch(t){alert("Failed to fetch warehouses: "+t.message)}finally{M(!1)}})()}),[]);const U=k.filter((e=>{var t,s,l,a,o,r,n,d;const i="all"===A||(null===(t=e.warehouse)||void 0===t?void 0:t._id)===A,c=(null===(s=e.customer)||void 0===s||null===(l=s.customerName)||void 0===l?void 0:l.toLowerCase().includes(g.toLowerCase()))||(null===(a=e.returnCode)||void 0===a?void 0:a.toLowerCase().includes(g.toLowerCase()))||(null===(o=e.sale)||void 0===o||null===(r=o.saleCode)||void 0===r?void 0:r.toLowerCase().includes(g.toLowerCase()))||(null===(n=e.sale)||void 0===n||null===(d=n.referenceNo)||void 0===d?void 0:d.toLowerCase().includes(g.toLowerCase()));return i&&c})),Y=Math.ceil(U.length/w),Z=U.slice(($-1)*w,$*w),q=e=>{e>=1&&e<=Y&&F(e)};return(0,l.useEffect)((()=>{(()=>{const e=Z.reduce(((e,t)=>e+(Number(t.totalRefund)||0)),0),t=Z.reduce(((e,t)=>{var s,l;return e+(Number(null===(s=t.payments)||void 0===s||null===(l=s[0])||void 0===l?void 0:l.amount)||0)}),0);_(e),E(t)})()}),[Z]),O?(0,N.jsx)(h.A,{}):(0,N.jsxs)("div",{className:"flex flex-col h-screen",children:[(0,N.jsx)(c.A,{isSidebarOpen:b,setSidebarOpen:j}),(0,N.jsxs)("div",{className:"flex flex-1 overflow-hidden",children:[(0,N.jsx)(u.A,{isSidebarOpen:b}),(0,N.jsxs)("div",{className:"flex-1 p-4 overflow-x-auto",children:[(0,N.jsxs)("header",{className:"flex flex-col items-center justify-between w-full px-2 py-2 mb-4 bg-gray-100 rounded-md shadow md:flex-row",children:[(0,N.jsxs)("div",{className:"flex items-baseline gap-2",children:[(0,N.jsx)("h1",{className:"text-lg font-semibold truncate sm:text-xl",children:"Sales Returns List"}),(0,N.jsx)("span",{className:"text-xs text-gray-600 sm:text-sm",children:"View/Search Returns"})]}),(0,N.jsxs)("nav",{className:"flex items-center gap-2 text-xs text-gray-500 sm:text-sm",children:[(0,N.jsxs)(i.k2,{to:"/dashboard",className:"flex items-center text-gray-700 no-underline hover:text-cyan-600",children:[(0,N.jsx)(d.$BV,{className:"mr-1"})," Home"]}),(0,N.jsx)("span",{children:"  "}),(0,N.jsx)(i.k2,{to:"/sales-payment-list",className:"text-gray-700 no-underline hover:text-cyan-600",children:"Sales Returns List"})]})]}),(0,N.jsxs)("div",{className:"grid grid-cols-1 gap-4 mb-4 lg:grid-cols-2",children:[(0,N.jsxs)("div",{className:"flex items-center p-4 bg-white rounded-lg shadow",children:[(0,N.jsx)(a.A,{className:"w-12 h-12 text-white bg-cyan-500 rounded"}),(0,N.jsxs)("div",{className:"ml-4",children:[(0,N.jsx)("h2",{className:"text-xl font-bold",children:L.totalCount}),(0,N.jsx)("p",{className:"font-semibold",children:"Total Returns"})]})]}),(0,N.jsxs)("div",{className:"flex items-center p-4 bg-white rounded-lg shadow",children:[(0,N.jsx)(d.Tsk,{className:"w-12 h-12 text-white bg-cyan-500 rounded"}),(0,N.jsxs)("div",{className:"ml-4",children:[(0,N.jsxs)("h2",{className:"text-xl font-bold",children:["\u20b9",L.totalRefunded.toFixed(2)]}),(0,N.jsx)("p",{className:"font-semibold",children:"Total Refunded Amount"})]})]}),(0,N.jsxs)("div",{className:"flex items-center p-4 bg-white rounded-lg shadow",children:[(0,N.jsx)(r.g,{icon:n.d0D,className:"w-12 h-12 text-white bg-cyan-500 rounded"}),(0,N.jsxs)("div",{className:"ml-4",children:[(0,N.jsxs)("h2",{className:"text-xl font-bold",children:["\u20b9",T.toFixed(2)]}),(0,N.jsx)("p",{className:"font-semibold",children:"Total Paid Amount"})]})]}),(0,N.jsxs)("div",{className:"flex items-center p-4 bg-white rounded-lg shadow",children:[(0,N.jsx)(o.A,{className:"w-12 h-12 text-white bg-cyan-500 rounded"}),(0,N.jsxs)("div",{className:"ml-4",children:[(0,N.jsxs)("h2",{className:"text-xl font-bold",children:["\u20b9",(P-T).toFixed(2)]}),(0,N.jsx)("p",{className:"font-semibold",children:"Total Return Due"})]})]})]}),(0,N.jsxs)("div",{className:"flex flex-col items-center justify-between gap-4 mb-4 md:flex-row",children:[(0,N.jsxs)("div",{className:"w-full md:w-64",children:[(0,N.jsx)("label",{className:"block font-semibold text-gray-700",children:"Warehouse"}),(0,N.jsx)(x.Ay,{options:t,value:t.find((e=>e.value===A)),onChange:e=>S(e.value)})]}),(0,N.jsx)("button",{className:"px-4 py-2 text-white bg-cyan-500 rounded hover:bg-cyan-600",onClick:()=>e("/sales-return/add"),children:"+ Create Return"})]}),(0,N.jsxs)("div",{className:"flex flex-col justify-between mb-4 space-y-2 md:flex-row md:space-y-0 md:items-center",children:[(0,N.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,N.jsx)("span",{className:"text-sm",children:"Show"}),(0,N.jsxs)("select",{className:"p-2 text-sm border rounded",value:w,onChange:e=>{C(Number(e.target.value)),F(1)},children:[(0,N.jsx)("option",{children:"10"}),(0,N.jsx)("option",{children:"20"}),(0,N.jsx)("option",{children:"50"})]}),(0,N.jsx)("span",{className:"text-sm",children:"Entries"})]}),(0,N.jsxs)("div",{className:"flex flex-col gap-2 md:flex-row md:items-center",children:[(0,N.jsxs)("div",{className:"flex gap-2",children:[(0,N.jsx)("button",{onClick:()=>{const e=U.map((e=>{var t,s,l,a,o,r,n;const d="PosOrder"===e.saleModel?null===(t=e.sale)||void 0===t?void 0:t.saleCode:(null===(s=e.sale)||void 0===s?void 0:s.referenceNo)||"N/A";return`${new Date(e.returnDate).toDateString()},${e.returnCode},${d},${e.status},${(null===(l=e.customer)||void 0===l?void 0:l.customerName)||"N/A"},${e.totalRefund||0},${(null===(a=e.payments)||void 0===a||null===(o=a[0])||void 0===o?void 0:o.amount)||0},${(null===(r=e.payments)||void 0===r||null===(n=r[0])||void 0===n?void 0:n.paymentNote)||"N/A"},${e.creatorName||"N/A"}`})).join("\n");navigator.clipboard.writeText(e),alert("Data copied to clipboard!")},className:"px-3 py-2 text-sm text-white bg-cyan-500 rounded",children:"Copy"}),(0,N.jsx)("button",{onClick:()=>{const e=U.map((e=>{var t,s,l,a,o,r,n;return{"Return Date":new Date(e.returnDate).toDateString(),"Return Code":e.returnCode,"Transaction Code":"PosOrder"===e.saleModel?null===(t=e.sale)||void 0===t?void 0:t.saleCode:(null===(s=e.sale)||void 0===s?void 0:s.referenceNo)||"N/A",Status:e.status,"Customer Name":(null===(l=e.customer)||void 0===l?void 0:l.customerName)||"N/A","Total Refund":e.totalRefund||0,"Paid Amount":(null===(a=e.payments)||void 0===a||null===(o=a[0])||void 0===o?void 0:o.amount)||0,"Payment Note":(null===(r=e.payments)||void 0===r||null===(n=r[0])||void 0===n?void 0:n.paymentNote)||"N/A","Created By":e.creatorName||"N/A"}})),t=v.utils.json_to_sheet(e),s=v.utils.book_new();v.utils.book_append_sheet(s,t,"SalesReturns"),v.writeFile(s,"sales_returns.xlsx")},className:"px-3 py-2 text-sm text-white bg-cyan-500 rounded",children:"Excel"}),(0,N.jsx)("button",{onClick:()=>{const e=new f.uE;e.text("Sales Returns List",20,20);const t=U.map((e=>{var t,s,l,a,o,r,n;return[new Date(e.returnDate).toDateString(),e.returnCode,"PosOrder"===e.saleModel?null===(t=e.sale)||void 0===t?void 0:t.saleCode:(null===(s=e.sale)||void 0===s?void 0:s.referenceNo)||"N/A",e.status,(null===(l=e.customer)||void 0===l?void 0:l.customerName)||"N/A",e.totalRefund||0,(null===(a=e.payments)||void 0===a||null===(o=a[0])||void 0===o?void 0:o.amount)||0,(null===(r=e.payments)||void 0===r||null===(n=r[0])||void 0===n?void 0:n.paymentNote)||"N/A",e.creatorName||"N/A"]}));(0,p.Ay)(e,{head:[["Return Date","Return Code","Transaction Code","Status","Customer Name","Total Refund","Paid Amount","Payment Note","Created By"]],body:t}),e.save("sales_returns.pdf")},className:"px-3 py-2 text-sm text-white bg-cyan-500 rounded",children:"PDF"}),(0,N.jsx)("button",{onClick:()=>{window.print()},className:"px-3 py-2 text-sm text-white bg-cyan-500 rounded",children:"Print"}),(0,N.jsx)("button",{onClick:()=>{const e="data:text/csv;charset=utf-8,"+["Return Date,Return Code,Transaction Code,Status,Customer Name,Total Refund,Paid Amount,Payment Note,Created By",...U.map((e=>{var t,s,l,a,o,r,n;return[new Date(e.returnDate).toDateString(),e.returnCode,"PosOrder"===e.saleModel?null===(t=e.sale)||void 0===t?void 0:t.saleCode:(null===(s=e.sale)||void 0===s?void 0:s.referenceNo)||"N/A",e.status,(null===(l=e.customer)||void 0===l?void 0:l.customerName)||"N/A",e.totalRefund||0,(null===(a=e.payments)||void 0===a||null===(o=a[0])||void 0===o?void 0:o.amount)||0,(null===(r=e.payments)||void 0===r||null===(n=r[0])||void 0===n?void 0:n.paymentNote)||"N/A",e.creatorName||"N/A"].join(",")}))].join("\n"),t=encodeURI(e),s=document.createElement("a");s.setAttribute("href",t),s.setAttribute("download","sales_returns.csv"),document.body.appendChild(s),s.click(),document.body.removeChild(s)},className:"px-3 py-2 text-sm text-white bg-cyan-500 rounded",children:"CSV"})]}),(0,N.jsx)("input",{type:"text",placeholder:"Search by Customer or Return Code",className:"p-2 text-sm border rounded",value:g,onChange:e=>y(e.target.value)})]})]}),(0,N.jsx)("div",{className:"overflow-x-auto",children:(0,N.jsxs)("table",{className:"w-full bg-gray-100 border",children:[(0,N.jsx)("thead",{className:"bg-gray-300",children:(0,N.jsxs)("tr",{children:[(0,N.jsx)("th",{className:"px-4 py-2 text-sm font-bold text-left border",children:"Return Date"}),(0,N.jsx)("th",{className:"px-4 py-2 text-sm font-bold text-left border",children:"Return Code"}),(0,N.jsx)("th",{className:"px-4 py-2 text-sm font-bold text-left border",children:"Transaction Code"}),(0,N.jsx)("th",{className:"px-4 py-2 text-sm font-bold text-left border",children:"Status"}),(0,N.jsx)("th",{className:"px-4 py-2 text-sm font-bold text-left border",children:"Customer Name"}),(0,N.jsx)("th",{className:"px-4 py-2 text-sm font-bold text-left border",children:"Total Refund"}),(0,N.jsx)("th",{className:"px-4 py-2 text-sm font-bold text-left border",children:"Paid Amount"}),(0,N.jsx)("th",{className:"px-4 py-2 text-sm font-bold text-left border",children:"Payment Note"}),(0,N.jsx)("th",{className:"px-4 py-2 text-sm font-bold text-left border",children:"Created By"}),(0,N.jsx)("th",{className:"px-4 py-2 text-sm font-bold text-left border",children:"Action"})]})}),(0,N.jsxs)("tbody",{children:[0===Z.length?(0,N.jsx)("tr",{children:(0,N.jsx)("td",{colSpan:10,className:"p-4 text-center text-gray-500 border",children:"No returns available"})}):Z.map((t=>{var s,l,a,o,r,n,d;const i=t.returnDate?new Date(t.returnDate).toDateString():"N/A",c="PosOrder"===t.saleModel?null===(s=t.sale)||void 0===s?void 0:s.saleCode:(null===(l=t.sale)||void 0===l?void 0:l.referenceNo)||"N/A",u=t.status||"N/A",x=(null===(a=t.customer)||void 0===a?void 0:a.customerName)||"N/A",h=Number(t.totalRefund)||0,p=Number(null===(o=t.payments)||void 0===o||null===(r=o[0])||void 0===r?void 0:r.amount)||0,v=(null===(n=t.payments)||void 0===n||null===(d=n[0])||void 0===d?void 0:d.paymentNote)||"N/A",f=t.creatorName||"N/A";return(0,N.jsxs)("tr",{className:"bg-white",children:[(0,N.jsx)("td",{className:"px-4 py-2 border",children:i}),(0,N.jsx)("td",{className:"px-4 py-2 border",children:t.returnCode}),(0,N.jsx)("td",{className:"px-4 py-2 border",children:c}),(0,N.jsx)("td",{className:"px-4 py-2 border",children:u}),(0,N.jsx)("td",{className:"px-4 py-2 border",children:x}),(0,N.jsxs)("td",{className:"px-4 py-2 border",children:["\u20b9",h.toFixed(2)]}),(0,N.jsxs)("td",{className:"px-4 py-2 border",children:["\u20b9",p.toFixed(2)]}),(0,N.jsx)("td",{className:"px-4 py-2 border",children:v}),(0,N.jsx)("td",{className:"px-4 py-2 border",children:f}),(0,N.jsxs)("td",{className:"relative px-4 py-2 border",children:[(0,N.jsxs)("button",{className:"flex items-center gap-2 px-4 py-2 text-sm font-semibold text-white bg-cyan-600 rounded-full hover:bg-cyan-700",onClick:()=>W(B===t._id?null:t._id),children:["Action",(0,N.jsx)("svg",{className:"w-4 h-4 transition-transform "+(B===t._id?"rotate-180":""),fill:"none",stroke:"currentColor",strokeWidth:2,viewBox:"0 0 24 24",children:(0,N.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})]}),B===t._id&&(0,N.jsxs)("div",{className:"absolute right-0 z-10 w-32 mt-2 bg-white border rounded shadow-lg",children:[V("SalesReturn","Edit")&&(0,N.jsx)("button",{className:"w-full px-4 py-2 text-left text-green-500 hover:bg-gray-100",onClick:()=>e(`/sales-return/edit/${t._id}`),children:"\u270f\ufe0f Edit"}),V("SalesReturn","Delete")&&(0,N.jsx)("button",{className:"w-full px-4 py-2 text-left text-red-500 hover:bg-gray-100",onClick:()=>(async e=>{if(!V("SalesReturn","Delete"))return void alert("You don\u2019t have permission to delete sales returns.");if(window.confirm("Are you sure you want to delete this return?")){M(!0);try{await m.A.delete(`api/sales-return/${e}`,H()),J()}catch(t){alert("Failed to delete return: "+t.message)}finally{M(!1)}}})(t._id),children:"\ud83d\uddd1\ufe0f Delete"})]})]})]},t._id)})),Z.length>0&&(0,N.jsxs)("tr",{className:"font-bold bg-gray-100",children:[(0,N.jsx)("td",{colSpan:5,className:"px-4 py-2 text-right border",children:"Total:"}),(0,N.jsxs)("td",{className:"px-4 py-2 border",children:["\u20b9",P.toFixed(2)]}),(0,N.jsxs)("td",{className:"px-4 py-2 border",children:["\u20b9",T.toFixed(2)]}),(0,N.jsx)("td",{colSpan:3,className:"px-4 py-2 border"})]})]})]})}),(0,N.jsxs)("div",{className:"flex flex-col items-start justify-between gap-2 p-2 md:flex-row md:items-center",children:[(0,N.jsxs)("span",{children:["Showing ",($-1)*w+1," to ",Math.min($*w,U.length)," of ",U.length," entries"]}),(0,N.jsxs)("div",{className:"flex gap-2",children:[(0,N.jsxs)("button",{className:"flex items-center gap-2 px-4 py-2 text-sm font-semibold rounded-lg "+(1===$?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-500 text-white hover:bg-blue-600"),onClick:()=>q($-1),disabled:1===$,children:[(0,N.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",strokeWidth:2,viewBox:"0 0 24 24",children:(0,N.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})}),"Previous"]}),(0,N.jsxs)("button",{className:"flex items-center gap-2 px-4 py-2 text-sm font-semibold rounded-lg "+($===Y?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-500 text-white hover:bg-blue-600"),onClick:()=>q($+1),disabled:$===Y,children:["Next",(0,N.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",strokeWidth:2,viewBox:"0 0 24 24",children:(0,N.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})]})]})]})]})]})]})}}}]);
//# sourceMappingURL=3601.d7fad24c.chunk.js.map