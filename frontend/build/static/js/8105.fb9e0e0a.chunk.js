"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[8105],{7398:(e,t,a)=>{a.r(t),a.d(t,{default:()=>m});var s=a(65043),r=a(21197),o=a(59255),l=a(49804),n=a(60184),i=a(86213),u=a(26873),d=a(66727),c=a(70579);const m=()=>{const e=(0,d.Zp)(),{id:t}=(0,d.g)(),[a,m]=(0,s.useState)(!!t),[h,b]=(0,s.useState)([]),[x,p]=(0,s.useState)([]),[g,N]=(0,s.useState)([]),[v,f]=(0,s.useState)([]),[j,y]=(0,s.useState)(!0),[w,C]=(0,s.useState)({warehouse:null,customer:null,quotationCode:`QT/${(new Date).getFullYear()}/${Math.random().toString(36).substr(2,4).toUpperCase()}`,quotationDate:(new Date).toISOString().split("T")[0],expiryDate:"",referenceNo:"",items:[],otherCharges:0,discountOnAll:0,note:"",subtotal:0,grandTotal:0,status:"Draft"});(0,s.useEffect)((()=>{A(),S(),q(),t&&D(t),window.innerWidth<768&&y(!1)}),[t]),(0,s.useEffect)((()=>{var e;if(null!==(e=w.warehouse)&&void 0!==e&&e.value){const e=g.filter((e=>{var t;return(null===(t=e.warehouse)||void 0===t?void 0:t._id)===w.warehouse.value}));f(e)}}),[w.warehouse,g]);const A=async()=>{try{const e=localStorage.getItem("token"),t=await i.A.get("api/warehouses",{headers:{Authorization:`Bearer ${e}`}});b(t.data.data.map((e=>({value:e._id,label:e.warehouseName}))))}catch(e){console.error("Error fetching warehouses:",e)}},S=async()=>{try{const e=localStorage.getItem("token"),t=(await i.A.get("api/customer-data/all",{headers:{Authorization:`Bearer ${e}`}})).data.map((e=>({value:e._id,label:e.customerName})));p(t)}catch(e){console.error("Error fetching customers:",e),p([])}},q=async()=>{try{const e=localStorage.getItem("token"),t=await i.A.get("api/items",{headers:{Authorization:`Bearer ${e}`}});N(t.data.data)}catch(e){console.error("Error fetching items:",e)}},D=async e=>{try{const t=localStorage.getItem("token"),a=(await i.A.get(`api/quotation/${e}`,{headers:{Authorization:`Bearer ${t}`}})).data;C({warehouse:{value:a.warehouse._id,label:a.warehouse.warehouseName},customer:{value:a.customer._id,label:a.customer.customerName},quotationCode:a.quotationCode,quotationDate:new Date(a.quotationDate).toISOString().split("T")[0],expiryDate:a.expiryDate?new Date(a.expiryDate).toISOString().split("T")[0]:"",referenceNo:a.referenceNo,items:a.items.map((e=>({item:e.item._id,quantity:e.quantity,unitPrice:e.unitPrice,discount:e.discount,taxAmount:e.taxAmount,subtotal:e.subtotal}))),otherCharges:a.otherCharges,discountOnAll:0,note:a.note,subtotal:a.subtotal,grandTotal:a.grandTotal,status:a.status})}catch(t){console.error("Error fetching quotation:",t),alert("Failed to load quotation data")}},O=(e,t,a)=>{const s=w.items.map(((s,r)=>{if(r===e){const e={...s,[t]:a};return e.subtotal=(e.unitPrice-e.discount+e.taxAmount)*e.quantity,e}return s})),r=s.reduce(((e,t)=>e+t.subtotal),0),o=r+w.otherCharges-w.discountOnAll;C((e=>({...e,items:s,subtotal:r,grandTotal:o})))};return(0,c.jsxs)("div",{className:"flex flex-col h-screen",children:[(0,c.jsx)(r.A,{isSidebarOpen:j,setSidebarOpen:y}),(0,c.jsxs)("div",{className:"flex flex-grow",children:[(0,c.jsx)(o.A,{isSidebarOpen:j}),(0,c.jsxs)("div",{className:"flex-grow mt-24 p-4 "+(j?"ml-64":"ml-0"),children:[(0,c.jsx)("header",{className:"flex flex-col justify-between p-4 bg-gray-100 rounded sm:flex-row",children:(0,c.jsxs)("div",{children:[(0,c.jsx)("h1",{className:"text-xl font-semibold",children:a?"Edit Quotation":"Create Quotation"}),(0,c.jsxs)("nav",{className:"flex items-center mt-2 text-sm text-gray-600",children:[(0,c.jsx)(n.$BV,{className:"mr-2"}),(0,c.jsx)(l.XWt,{className:"mx-1"}),(0,c.jsx)("span",{children:a?"Edit Quotation":"New Quotation"})]})]})}),(0,c.jsxs)("form",{onSubmit:async s=>{s.preventDefault();try{var r,o;const s=localStorage.getItem("token");if(null===(r=w.warehouse)||void 0===r||!r.value||null===(o=w.customer)||void 0===o||!o.value||0===w.items.length)return void alert("Please fill all required fields and add items!");const l={warehouse:w.warehouse.value,customer:w.customer.value,quotationCode:w.quotationCode,quotationDate:w.quotationDate,expiryDate:w.expiryDate||null,referenceNo:w.referenceNo,items:w.items.map((e=>({item:e.item,quantity:Number(e.quantity),unitPrice:Number(e.unitPrice),discount:Number(e.discount),taxAmount:Number(e.taxAmount),subtotal:Number(e.subtotal)}))),otherCharges:Number(w.otherCharges),note:w.note,status:w.status};if(a){await i.A.put(`api/quotation/${t}`,l,{headers:{Authorization:`Bearer ${s}`}});alert("Quotation updated successfully!")}else{await i.A.post("api/quotation",l,{headers:{Authorization:`Bearer ${s}`}});alert("Quotation created successfully!")}e("/quotation-list")}catch(u){var l,n;console.error("Error submitting quotation:",u),alert(`Error: ${(null===(l=u.response)||void 0===l||null===(n=l.data)||void 0===n?void 0:n.message)||u.message}`)}},className:"mt-4",children:[(0,c.jsxs)("div",{className:"grid grid-cols-1 gap-4 mb-4 sm:grid-cols-2",children:[(0,c.jsxs)("div",{className:"space-y-4",children:[(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{className:"block mb-2 font-medium",children:"Warehouse *"}),(0,c.jsx)(u.Ay,{options:h,onChange:e=>C({...w,warehouse:e}),value:w.warehouse,isRequired:!0,placeholder:"Select Warehouse",getOptionLabel:e=>e.label,getOptionValue:e=>e.value})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{className:"block mb-2 font-medium",children:"Customer *"}),(0,c.jsx)(u.Ay,{options:x,onChange:e=>C({...w,customer:e}),value:w.customer,isRequired:!0,placeholder:"Select Customer",getOptionLabel:e=>(null===e||void 0===e?void 0:e.label)||"",getOptionValue:e=>(null===e||void 0===e?void 0:e.value)||"",noOptionsMessage:()=>"No customers found"})]})]}),(0,c.jsxs)("div",{className:"space-y-4",children:[(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{className:"block mb-2 font-medium",children:"Quotation Date"}),(0,c.jsx)("input",{type:"date",value:w.quotationDate,onChange:e=>C({...w,quotationDate:e.target.value}),className:"w-full p-2 border rounded"})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{className:"block mb-2 font-medium",children:"Expiry Date"}),(0,c.jsx)("input",{type:"date",value:w.expiryDate,onChange:e=>C({...w,expiryDate:e.target.value}),className:"w-full p-2 border rounded"})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{className:"block mb-2 font-medium",children:"Reference No"}),(0,c.jsx)("input",{type:"text",value:w.referenceNo,onChange:e=>C({...w,referenceNo:e.target.value}),className:"w-full p-2 border rounded",placeholder:"Optional"})]})]})]}),(0,c.jsxs)("div",{className:"mb-4",children:[(0,c.jsx)("label",{className:"block mb-2 font-medium",children:"Add Items"}),(0,c.jsx)("div",{className:"flex gap-2",children:(0,c.jsx)(u.Ay,{options:v.map((e=>({value:e._id,label:e.itemName,unitPrice:e.salesPrice}))),onChange:e=>{const t=g.find((t=>t._id===e.value));if(!t)return;const a={item:t._id,quantity:1,unitPrice:t.salesPrice,discount:0,taxAmount:t.taxAmount||0,subtotal:1*t.salesPrice};C((e=>({...e,items:[...e.items,a],subtotal:e.subtotal+a.subtotal,grandTotal:e.grandTotal+a.subtotal})))},placeholder:w.warehouse?"Search items...":"Select warehouse first",className:"flex-grow",isDisabled:!w.warehouse,getOptionLabel:e=>e.label,getOptionValue:e=>e.value,filterOption:(e,t)=>{let{data:a}=e;return a.label.toLowerCase().includes(t.toLowerCase())||a.barcode&&a.barcode.includes(t)}})})]}),(0,c.jsx)("div",{className:"mb-4 overflow-x-auto",children:(0,c.jsxs)("table",{className:"w-full border",children:[(0,c.jsx)("thead",{className:"bg-gray-100",children:(0,c.jsxs)("tr",{children:[(0,c.jsx)("th",{className:"p-2 border",children:"Item"}),(0,c.jsx)("th",{className:"p-2 border",children:"Quantity"}),(0,c.jsx)("th",{className:"p-2 border",children:"Unit Price"}),(0,c.jsx)("th",{className:"p-2 border",children:"Discount"}),(0,c.jsx)("th",{className:"p-2 border",children:"Tax"}),(0,c.jsx)("th",{className:"p-2 border",children:"Total"}),(0,c.jsx)("th",{className:"p-2 border",children:"Action"})]})}),(0,c.jsx)("tbody",{children:w.items.map(((e,t)=>{const a=g.find((t=>t._id===e.item));return(0,c.jsxs)("tr",{children:[(0,c.jsx)("td",{className:"p-2 border",children:(null===a||void 0===a?void 0:a.itemName)||"N/A"}),(0,c.jsx)("td",{className:"p-2 border",children:(0,c.jsx)("input",{type:"number",value:e.quantity,onChange:e=>O(t,"quantity",Number(e.target.value)),className:"w-20 p-1 border rounded",min:"1"})}),(0,c.jsx)("td",{className:"p-2 border",children:(0,c.jsx)("input",{type:"number",value:e.unitPrice,onChange:e=>O(t,"unitPrice",Number(e.target.value)),className:"w-24 p-1 border rounded"})}),(0,c.jsx)("td",{className:"p-2 border",children:(0,c.jsx)("input",{type:"number",value:e.discount,onChange:e=>O(t,"discount",Number(e.target.value)),className:"w-20 p-1 border rounded"})}),(0,c.jsx)("td",{className:"p-2 border",children:(0,c.jsx)("input",{type:"number",value:e.taxAmount,onChange:e=>O(t,"taxAmount",Number(e.target.value)),className:"w-20 p-1 border rounded"})}),(0,c.jsxs)("td",{className:"p-2 border",children:["\u20b9",e.subtotal.toFixed(2)]}),(0,c.jsx)("td",{className:"p-2 border",children:(0,c.jsx)("button",{type:"button",onClick:()=>(e=>{const t=w.items[e];C((a=>({...a,items:a.items.filter(((t,a)=>a!==e)),subtotal:a.subtotal-t.subtotal,grandTotal:a.grandTotal-t.subtotal})))})(t),className:"text-red-600 hover:text-red-800",children:"Remove"})})]},t)}))})]})}),(0,c.jsxs)("div",{className:"grid grid-cols-1 gap-4 mb-4 sm:grid-cols-2",children:[(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{className:"block mb-2 font-medium",children:"Note"}),(0,c.jsx)("textarea",{value:w.note,onChange:e=>C({...w,note:e.target.value}),className:"w-full p-2 border rounded h-28",placeholder:"Add any additional notes..."})]}),(0,c.jsxs)("div",{className:"space-y-2",children:[(0,c.jsxs)("div",{className:"flex justify-between",children:[(0,c.jsx)("span",{children:"Subtotal:"}),(0,c.jsxs)("span",{children:["\u20b9",w.subtotal.toFixed(2)]})]}),(0,c.jsxs)("div",{className:"flex justify-between items-center",children:[(0,c.jsx)("span",{children:"Other Charges:"}),(0,c.jsx)("input",{type:"number",value:w.otherCharges,onChange:e=>C({...w,otherCharges:Number(e.target.value),grandTotal:w.subtotal+Number(e.target.value)-w.discountOnAll}),className:"w-32 p-1 border rounded"})]}),(0,c.jsxs)("div",{className:"flex justify-between items-center",children:[(0,c.jsx)("span",{children:"Discount on All:"}),(0,c.jsx)("input",{type:"number",value:w.discountOnAll,onChange:e=>C({...w,discountOnAll:Number(e.target.value),grandTotal:w.subtotal+w.otherCharges-Number(e.target.value)}),className:"w-32 p-1 border rounded"})]}),(0,c.jsxs)("div",{className:"flex justify-between font-bold border-t pt-2",children:[(0,c.jsx)("span",{children:"Grand Total:"}),(0,c.jsxs)("span",{children:["\u20b9",w.grandTotal.toFixed(2)]})]})]})]}),(0,c.jsxs)("div",{className:"flex gap-4 mt-6",children:[(0,c.jsx)("button",{type:"submit",className:"px-6 py-2 text-white bg-green-600 rounded hover:bg-green-700",children:a?"Update Quotation":"Save Quotation"}),(0,c.jsx)("button",{type:"button",onClick:()=>e("/quotation-list"),className:"px-6 py-2 text-white bg-gray-600 rounded hover:bg-gray-700",children:"Cancel"})]})]})]})]})]})}},82284:(e,t,a)=>{function s(e){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s(e)}a.d(t,{A:()=>s})}}]);
//# sourceMappingURL=8105.fb9e0e0a.chunk.js.map