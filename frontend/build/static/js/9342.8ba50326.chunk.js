"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[9342],{14840:(e,t,s)=>{s.d(t,{A:()=>o});var a=s(65043),l=s(21197),r=s(59255),n=s(70579);function o(){const[e,t]=(0,a.useState)(!1);return(0,n.jsxs)("div",{className:"flex flex-col h-screen",children:[(0,n.jsx)(l.A,{isSidebarOpen:e,setSidebarOpen:t}),(0,n.jsxs)("div",{className:"flex flex-grow mt-20",children:[(0,n.jsx)("div",{children:(0,n.jsx)(r.A,{isSidebarOpen:e})}),(0,n.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-white/80 backdrop-blur-sm",children:(0,n.jsxs)("div",{className:"flex flex-col items-center",children:[(0,n.jsx)("div",{className:"w-12 h-12 border-4 rounded-full border-cyan-500 border-t-transparent animate-spin"}),(0,n.jsx)("p",{className:"mt-3 text-lg font-semibold text-gray-700",children:"Loading..."})]})})]})]})}},89342:(e,t,s)=>{s.r(t),s.d(t,{default:()=>v});var a=s(65043),l=s(27473),r=s(33150),n=s(83910),o=s(97929),i=s(60184),d=s(66727),c=s(32916),x=s(21197),u=s(59255),m=s(86213),h=s(14840),p=s(37762),f=s(64857),g=s(70579);const v=()=>{const e=(0,d.Zp)(),[t,s]=(0,a.useState)([]),[v,j]=(0,a.useState)(!0),[N,b]=(0,a.useState)(""),[y,w]=(0,a.useState)(10),[S,A]=(0,a.useState)([]),[P,k]=(0,a.useState)(null),[C,D]=(0,a.useState)(0),[$,T]=(0,a.useState)(0),[L,_]=(0,a.useState)(!1),[F,B]=(0,a.useState)(null),[E,O]=(0,a.useState)([]);function I(e,t){return"admin"===(localStorage.getItem("role")||"guest").toLowerCase()||E.some((s=>s.module.toLowerCase()===e.toLowerCase()&&s.actions.map((e=>e.toLowerCase())).includes(t.toLowerCase())))}(0,a.useEffect)((()=>{const e=localStorage.getItem("permissions");if(e)try{O(JSON.parse(e))}catch{}}),[]),(0,a.useEffect)((()=>{window.innerWidth<768&&j(!1)}),[window.innerWidth]);const W=async()=>{const t=localStorage.getItem("token");if(_(!0),!t)return console.log("No token found redirecting..."),void e("/");try{const e=await m.A.get("api/purchases",{headers:{Authorization:`Bearer ${t}`}});if(console.log("Purchase List"),console.log(e.data),e.data.data){const t=e.data.data.sort(((e,t)=>new Date(t.purchaseDate)-new Date(e.purchaseDate)));A(t)}}catch(s){alert(s.message)}finally{_(!1)}},z=()=>{const e="all"!==P&&P?S.filter((e=>{var t;return(null===(t=e.warehouse)||void 0===t?void 0:t._id)===P})):S,t=e.reduce(((e,t)=>e+t.grandTotal),0),s=e.reduce(((e,t)=>{var s;return e+((null===(s=t.payments)||void 0===s?void 0:s.length)>0?parseFloat(t.payments[0].amount):0)}),0);D(t),T(s)};(0,a.useEffect)((()=>{D(0),z()}),[P,S]),(0,a.useEffect)((()=>{W(),(async()=>{_(!0);const t=localStorage.getItem("token");if(!t)return console.log("No token found redirecting..."),void e("/");try{const e=await m.A.get("api/warehouses",{headers:{Authorization:`Bearer ${t}`}});if(console.log("Warehouse"),console.log(e.data),e.data.data){const t=e.data.data.map((e=>({label:e.warehouseName,value:e._id})));s(t)}}catch(a){alert(a.message)}finally{_(!1)}})(),z()}),[]);return L?(0,g.jsx)(h.A,{}):(0,g.jsxs)("div",{className:"flex flex-col h-screen",children:[(0,g.jsx)(x.A,{isSidebarOpen:v,setSidebarOpen:j}),(0,g.jsxs)("div",{className:"box-border flex",children:[(0,g.jsx)("div",{className:"w-auto",children:(0,g.jsx)(u.A,{isSidebarOpen:v})}),(0,g.jsxs)("div",{className:"overflow-x-auto flex flex-col p-2 md:p-2 min-h-screen w-full",children:[(0,g.jsxs)("header",{className:"flex flex-col items-center justify-between p-4 mb-6 bg-gray-100 rounded-lg md:flex-row",children:[(0,g.jsxs)("h1",{className:"text-2xl font-semibold",children:["Purchase List ",(0,g.jsx)("span",{className:"text-gray-500 text-sm/6",children:"View/Search Purchase"})]}),(0,g.jsxs)("div",{className:"flex items-center space-x-2 text-blue-600",children:[(0,g.jsxs)(d.N_,{to:"/",className:"flex items-center text-gray-500 no-underline hover:text-cyan-600 text-sm/6",children:[(0,g.jsx)(i.$BV,{className:"mr-2 text-gray-500 hover:text-cyan-600"})," Home"]}),(0,g.jsx)("span",{className:"text-gray-400",children:">"}),(0,g.jsx)(d.N_,{to:"/brands",className:"text-gray-500 no-underline hover:text-cyan-600 text-sm/6",children:"Purchase List"})]})]}),(0,g.jsx)("div",{className:"flex flex-col gap-4",children:(0,g.jsxs)("div",{className:"grid grid-cols-1 gap-4 lg:grid-cols-2",children:[(0,g.jsxs)("div",{className:"flex items-center text-black bg-white rounded-lg shadow-md ",children:[(0,g.jsx)(l.A,{className:"w-16 text-white rounded bg-cyan-500"}),(0,g.jsxs)("div",{className:"flex flex-col justify-center ml-4",children:[(0,g.jsx)("h2",{className:"text-2xl",children:("all"!==P&&P?S.filter((e=>{var t;return(null===(t=e.warehouse)||void 0===t?void 0:t._id)===P})):S).length}),(0,g.jsx)("p",{children:"Total Invoices"})]})]}),(0,g.jsxs)("div",{className:"flex items-center text-black bg-white rounded-lg shadow-md",children:[(0,g.jsx)(i.Tsk,{className:"w-16 h-16 text-white rounded bg-cyan-500"}),(0,g.jsxs)("div",{className:"flex flex-col justify-center ml-4",children:[(0,g.jsxs)("h2",{className:"text-2xl",children:["\u20b9",$]}),(0,g.jsx)("p",{children:"Total Paid Amount"})]})]}),(0,g.jsxs)("div",{className:"flex items-center text-black bg-white rounded-lg shadow-md",children:[(0,g.jsx)(n.g,{icon:o.d0D,className:"w-16 h-16 text-white rounded bg-cyan-500"}),(0,g.jsxs)("div",{className:"flex flex-col justify-center ml-4",children:[(0,g.jsxs)("h2",{className:"text-2xl",children:["\u20b9",C]}),(0,g.jsx)("p",{children:"Total Invoices Amount"})]})]}),(0,g.jsxs)("div",{className:"flex items-center text-black bg-white rounded-lg shadow-md",children:[(0,g.jsx)(r.A,{className:"h-16 text-white rounded bg-cyan-500 w-18"}),(0,g.jsxs)("div",{className:"flex flex-col justify-center ml-4",children:[(0,g.jsxs)("h2",{className:"text-2xl font-medium",children:["\u20b9",C-$]}),(0,g.jsx)("p",{children:"Total Purchase Due"})]})]})]})}),(0,g.jsxs)("div",{className:"flex flex-col items-center justify-between w-full gap-4 mt-3 md:flex-row md:gap-28",children:[(0,g.jsx)("div",{className:"flex w-full px-4 py-2 bg-white border border-gray-300 rounded-md md:w-64",children:(0,g.jsxs)("div",{className:"flex items-center w-full gap-4",children:[(0,g.jsx)(n.g,{icon:c.URI,className:"w-5 h-5 text-red-500"}),(0,g.jsxs)("select",{className:"flex-grow text-gray-700 bg-transparent outline-none cursor-pointer",onChange:e=>k(e.target.value),children:[(0,g.jsx)("option",{value:"all",children:"All Warehouse"}),t.map(((e,t)=>(0,g.jsx)("option",{value:e.value,children:e.label},t)))]})]})}),I("Purchases","Add")&&(0,g.jsxs)("button",{className:"w-full px-2 py-2 text-white transition rounded-md md:w-auto bg-cyan-300 hover:bg-cyan-500",onClick:()=>e("/new-purchase"),children:[(0,g.jsx)("span",{className:"font-bold",children:"+ "}),"Create Purchase"]})]}),(0,g.jsxs)("div",{className:"flex flex-col justify-between mt-4 mb-4 space-y-2 md:flex-row md:space-y-0 md:items-center",children:[(0,g.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,g.jsx)("span",{className:"text-sm",children:"Show"}),(0,g.jsxs)("select",{className:"p-2 text-sm border border-gray-300 rounded-md",value:y,onChange:e=>w(Number(e.target.value)),children:[(0,g.jsx)("option",{value:10,children:"10"}),(0,g.jsx)("option",{value:20,children:"20"}),(0,g.jsx)("option",{value:50,children:"50"})]}),(0,g.jsx)("span",{className:"text-sm",children:"Entries"})]}),(0,g.jsxs)("div",{className:"flex flex-col gap-2 md:flex-row",children:[(0,g.jsxs)("div",{className:"flex items-center justify-between flex-1 gap-2",children:[(0,g.jsx)("button",{className:"px-3 py-2 text-sm text-white bg-cyan-500",children:"Copy"}),(0,g.jsx)("button",{className:"px-3 py-2 text-sm text-white bg-cyan-500",children:"Excel"}),(0,g.jsx)("button",{className:"px-3 py-2 text-sm text-white bg-cyan-500",children:"PDF"}),(0,g.jsx)("button",{className:"px-3 py-2 text-sm text-white bg-cyan-500",children:"Print"}),(0,g.jsx)("button",{className:"px-3 py-2 text-sm text-white bg-cyan-500",children:"CSV"})]}),(0,g.jsx)("input",{type:"text",placeholder:"Search",className:"w-full p-2 text-sm border border-gray-300",onChange:e=>b(e.target.value)})]})]}),(0,g.jsx)("div",{className:"mt-6 overflow-x-auto",children:(0,g.jsxs)("table",{className:"min-w-full bg-white border border-gray-300 shadow-sm",children:[(0,g.jsx)("thead",{className:"bg-gray-200",children:(0,g.jsx)("tr",{children:["Purchase Date","Purchase Code","Purchase Status","Reference No.","Supplier Name","Total","Paid Payment","Payment Status","Created by","Action"].map((e=>(0,g.jsx)("th",{className:"px-4 py-2 font-medium text-left border",children:e},e)))})}),(0,g.jsxs)("tbody",{children:[("all"!==P&&P?S.filter((e=>{var t;return(null===(t=e.warehouse)||void 0===t?void 0:t._id)===P})):S).length>0?("all"!==P&&P?S.filter((e=>{var t;return(null===(t=e.warehouse)||void 0===t?void 0:t._id)===P})):S).map((t=>{var s,a,l,r;const n=(null===(s=t.payments)||void 0===s?void 0:s.length)>0?t.grandTotal===t.payments[0].amount?"Paid":t.grandTotal>t.payments[0].amount?"Pending":"Overpaid":"Pending",o=(null===(a=t.supplier)||void 0===a?void 0:a.supplierName)||(null===(l=t.supplier)||void 0===l?void 0:l.email)||"No supplier";return(0,g.jsxs)("tr",{className:"font-bold bg-gray-100",children:[(0,g.jsx)("td",{className:"px-4 py-2 font-medium text-left border",children:new Date(t.purchaseDate).toLocaleDateString()}),(0,g.jsx)("td",{className:"px-4 py-2 font-medium text-left border",children:t.purchaseCode}),(0,g.jsx)("td",{className:"px-4 py-2 font-medium text-left border",children:t.status}),(0,g.jsx)("td",{className:"px-4 py-2 font-medium text-left border",children:t.referenceNo}),(0,g.jsx)("td",{className:"px-4 py-2 font-medium text-left border",children:o}),(0,g.jsx)("td",{className:"px-4 py-2 font-medium text-left border",children:t.grandTotal}),(0,g.jsx)("td",{className:"px-4 py-2 font-medium text-left border",children:(null===(r=t.payments)||void 0===r?void 0:r.length)>0?`${t.payments[0].amount.toFixed(2)}`:"No Payment"}),(0,g.jsx)("td",{className:"px-4 py-2 font-medium text-left border",children:n}),(0,g.jsx)("td",{className:"px-4 py-2 font-medium text-left border",children:t.createdByModel}),(0,g.jsxs)("td",{className:"relative px-4 py-2 font-medium text-center border",children:[(0,g.jsxs)("button",{className:"flex items-center gap-2 px-4 py-2 text-sm font-semibold text-white bg-cyan-600 rounded-full shadow-sm \n                                hover:bg-cyan-700 active:scale-95 transition-all duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-cyan-400",onClick:e=>{if(F===t._id)B(null);else{const s=e.currentTarget.getBoundingClientRect(),a=window.innerHeight-s.bottom,l=120;B({id:t._id,position:a<l?"above":"below"})}},children:[(0,g.jsx)("span",{children:"Action"}),(0,g.jsx)("svg",{className:"w-4 h-4 transition-transform duration-200 "+((null===F||void 0===F?void 0:F.id)===t._id?"rotate-180":""),fill:"none",stroke:"currentColor",strokeWidth:2,viewBox:"0 0 24 24",children:(0,g.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})]}),(null===F||void 0===F?void 0:F.id)===t._id&&(0,g.jsxs)("div",{className:"absolute right-0 z-40 bg-white border shadow-lg w-28",style:{top:"below"===F.position?"100%":"auto",bottom:"above"===F.position?"100%":"auto"},children:[I("Purchases","Edit")&&(0,g.jsx)("button",{className:"w-full px-1 py-0 text-left text-green-500 hover:bg-gray-100",onClick:()=>e(`/new-purchase?id=${t._id}`),children:"\u270f\ufe0f Edit"}),I("Purchases","View")&&(0,g.jsx)("button",{className:"w-full px-1 py-0 text-left text-blue-500 hover:bg-gray-100",onClick:()=>e(`/purchase-detail/${t._id}`),children:"\ud83d\udc41\ufe0f View"}),(0,g.jsx)("button",{className:"w-full px-1 py-0 text-left text-gray-500 hover:bg-gray-100",onClick:()=>(e=>{var t,s,a,l,r,n,o,i,d,c;const x=new p.uE;x.setFontSize(16),x.text("Purchase Details",10,10),(0,f.Ay)(x,{startY:20,head:[["Field","Value"]],body:[["Date",new Date(e.purchaseDate).toLocaleDateString()],["Code",e.purchaseCode||"N/A"],["Status",e.status||"N/A"],["Reference No",e.referenceNo||"N/A"],["Warehouse",(null===(t=e.warehouse)||void 0===t?void 0:t.warehouseName)||"N/A"],["Supplier",(null===(s=e.supplier)||void 0===s?void 0:s.supplierName)||(null===(a=e.supplier)||void 0===a?void 0:a.email)||"No supplier"],["Grand Total",`\u20b9${(e.grandTotal||0).toFixed(2)}`],["Other Charges",`\u20b9${(e.otherCharges||0).toFixed(2)}`],["Discount on All",`\u20b9${(e.discountOnAll||0).toFixed(2)}`],["Paid Amount",`\u20b9${((null===(l=e.payments)||void 0===l?void 0:l.length)>0?e.payments[0].amount:0).toFixed(2)}`],["Payment Status",(null===(r=e.payments)||void 0===r?void 0:r.length)>0?(e.grandTotal||0)===(e.payments[0].amount||0)?"Paid":(e.grandTotal||0)>(e.payments[0].amount||0)?"Pending":"Overpaid":"Pending"],["Payment Note",(null===(n=e.payments)||void 0===n||null===(o=n[0])||void 0===o?void 0:o.paymentNote)||"N/A"],["Created By",`${e.createdByModel} ${(null===(i=e.createdBy)||void 0===i?void 0:i.name)||`${null===(d=e.createdBy)||void 0===d?void 0:d.FirstName} ${null===(c=e.createdBy)||void 0===c?void 0:c.LastName}`||"N/A"}`],["Note",e.note||"N/A"]]});const u=e.items||[];u.length>0&&(0,f.Ay)(x,{startY:x.lastAutoTable.finalY+10,head:[["Item Name","Quantity","Purchase Price","MRP","Discount","Total Amount"]],body:u.map((e=>{var t,s;return[(null===(t=e.item)||void 0===t?void 0:t.itemName)||(null===(s=e.item)||void 0===s?void 0:s.name)||"N/A",e.quantity||"N/A",`\u20b9${(e.purchasePrice||0).toFixed(2)}`,`\u20b9${(e.mrp||0).toFixed(2)}`,`\u20b9${(e.discount||0).toFixed(2)}`,`\u20b9${(e.totalAmount||0).toFixed(2)}`]}))}),x.save(`purchase_${e.purchaseCode||"details"}_${(new Date).toISOString().split("T")[0]}.pdf`)})(t),children:"\ud83d\udda8\ufe0f Print"}),I("Purchases","Delete")&&(0,g.jsx)("button",{className:"w-full px-1 py-0 text-left text-red-500 hover:bg-gray-100",onClick:()=>(async e=>{if(window.confirm("Do you want to delete this purchase?")){_(!0);try{if(!(await fetch(`/api/purchases/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}})).ok)throw new Error("Failed to delete supplier");console.log("Purchase deleted successfully!"),W()}catch(t){console.error("Error deleting purchase:",t.message)}finally{_(!1)}}})(t._id),children:"\ud83d\uddd1\ufe0f Delete"})]})]})]},t._id)})):(0,g.jsx)("tr",{children:(0,g.jsx)("td",{colSpan:"10",className:"py-4 font-semibold text-center border",children:"No Data Available"})}),("all"!==P&&P?S.filter((e=>{var t;return(null===(t=e.warehouse)||void 0===t?void 0:t._id)===P})):S).length>0&&(0,g.jsxs)("tr",{className:"font-bold bg-gray-100",children:[(0,g.jsx)("td",{colSpan:"5",className:"text-center border",children:"Total"}),(0,g.jsx)("td",{className:"text-center border",children:C}),(0,g.jsx)("td",{className:"text-center border",children:$}),(0,g.jsx)("td",{className:"text-center border"}),(0,g.jsx)("td",{className:"text-center border"}),(0,g.jsx)("td",{className:"text-center border"})]})]})]})}),(0,g.jsx)("div",{className:"flex flex-col items-start justify-between gap-2 p-2 md:justify-between md:flex-row",children:(0,g.jsxs)("div",{className:"flex justify-between w-full md:w-auto md:gap-2",children:[(0,g.jsxs)("button",{className:"flex items-center gap-2 px-4 py-2 text-sm font-semibold rounded-lg transition-all duration-200 shadow-md",children:[(0,g.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",strokeWidth:2,viewBox:"0 0 24 24",children:(0,g.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})}),"Previous"]}),(0,g.jsxs)("button",{className:"flex items-center gap-2 px-4 py-2 text-sm font-semibold rounded-lg transition-all duration-200 shadow-md",children:["Next",(0,g.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",strokeWidth:2,viewBox:"0 0 24 24",children:(0,g.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})]})]})})]})]})]})}}}]);
//# sourceMappingURL=9342.8ba50326.chunk.js.map